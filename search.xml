<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Flutter å…¥é—¨æŒ‡åŒ—</title>
      <link href="/2023/09/10/20230910-flutter/"/>
      <url>/2023/09/10/20230910-flutter/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€Flutter-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä¸€ã€Flutter-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¸€ã€Flutter æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä¸€ã€Flutter æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>Flutter æ˜¯ Google æ¨å‡ºçš„ UI æ¡†æ¶ï¼Œå¸®åŠ©å¼€å‘è€…é€šè¿‡ä¸€å¥—ä»£ç åŒæ—¶è¿è¡Œåœ¨ iOS å’Œ Android ä¸Šï¼Œæ„å»ºåª²ç¾åŸç”Ÿä½“éªŒçš„ç²¾ç¾åº”ç”¨ï¼å®é™…ä¸Š Flutter ä¸æ­¢äºç§»åŠ¨å¹³å°ï¼Œæ­£é€æ¸ä»ç§»åŠ¨è®¾å¤‡æ‰©å±•åˆ°å¤šä¸ªå¹³å°ï¼Œä¾‹å¦‚ Webã€macOSã€Windowsã€Linuxã€åµŒå…¥å¼è®¾å¤‡ç­‰ï¼Œå› æ­¤ Flutter æ˜¯é€‚ç”¨äºæ‰€æœ‰å±å¹•çš„ä¾¿æºå¼ç•Œé¢æ¡†æ¶ï¼ŒFlutter ä¸€åˆ‡çš†æ˜¯ Widgetï¼›è‡ªç»˜ UIï¼›Flutter åªæ¥ç®¡ UI å±‚ï¼Œè“ç‰™ç­‰ç³»ç»ŸåŠŸèƒ½é€šè¿‡æ’ä»¶çš„å½¢å¼æä¾›ã€‚</p><h2 id="äºŒã€Flutter-æœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿ"><a href="#äºŒã€Flutter-æœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿ" class="headerlink" title="äºŒã€Flutter æœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿ"></a>äºŒã€Flutter æœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿ</h2><ol><li>ç¾è§‚ï¼šå¯å¯¹ UI å®ç°åƒç´ çº§çš„æ§åˆ¶ï¼Œä¸”å†…ç½® UI åº“ ( Materialã€Cupertino )</li><li>å¿«é€Ÿï¼šç¡¬ä»¶åŠ é€Ÿå›¾å½¢å¼•æ“ã€ä»£ç è¢«ç¼–è¯‘æˆæœºå™¨ç </li><li>é«˜æ•ˆï¼šä¿æŒåº”ç”¨çŠ¶æ€çš„çƒ­é‡è½½ ( hot reload )</li><li>å¼€æ”¾ï¼šå®Œå…¨å¼€æºçš„é¡¹ç›® ( BSD å¼€æºåè®® )</li></ol><h2 id="ä¸‰ã€Flutter-ç³»ç»Ÿæ¶æ„"><a href="#ä¸‰ã€Flutter-ç³»ç»Ÿæ¶æ„" class="headerlink" title="ä¸‰ã€Flutter ç³»ç»Ÿæ¶æ„"></a>ä¸‰ã€Flutter ç³»ç»Ÿæ¶æ„</h2><p>Flutter ä½¿ç”¨ Cã€C++ã€Dart å’Œ Skia ( 2D æ¸²æŸ“å¼•æ“ ) æ„å»ºï¼Œè¯¦æƒ…è§ Flutter ç³»ç»Ÿæ¶æ„</p><table><thead><tr><th align="left">Flutter ( Android / iOS )</th><th align="left">Flutter Web</th></tr></thead><tbody><tr><td align="left"><img src="/assets/20230910-flutter/640.jpg" alt="å›¾ç‰‡"></td><td align="left"><img src="/assets/20230910-flutter/640.png" alt="å›¾ç‰‡"></td></tr></tbody></table><h2 id="å››ã€Flutter-ä¸å‰ç«¯çš„ä¸€äº›å¯¹æ¯”"><a href="#å››ã€Flutter-ä¸å‰ç«¯çš„ä¸€äº›å¯¹æ¯”" class="headerlink" title="å››ã€Flutter ä¸å‰ç«¯çš„ä¸€äº›å¯¹æ¯”"></a>å››ã€Flutter ä¸å‰ç«¯çš„ä¸€äº›å¯¹æ¯”</h2><p>æŠ€æœ¯éƒ½æ˜¯ç›¸é€šçš„ï¼Œå¯»æ‰¾ç›¸ä¼¼ç‚¹èƒ½è®©æˆ‘ä»¬å¿«é€Ÿä¸Šæ‰‹ä¸€é—¨æ–°æŠ€æœ¯ã€‚</p><p>Flutter ä¸å‰ç«¯æœ‰ä¸å°‘ç›¸ä¼¼ç‚¹ï¼Œæ¯”å¦‚ Flutter å€Ÿé‰´äº† React å“åº”å¼ UI ç¼–ç¨‹çš„æ€æƒ³ï¼ŒFlutter ä¹Ÿæœ‰ Flexboxã€Grid å¸ƒå±€ï¼Œæ­¤å¤– Dart ä¸ JavaScript çš„è¯­æ³•æœ‰ä¸å°‘ç›¸ä¼¼ç‚¹ã€‚</p><p>å®é™…ä¸Šï¼ŒFlutter é¡¹ç›®æ­£æ˜¯è¯ç”Ÿäº Chrome å›¢é˜Ÿï¼Œè¯¦æƒ…è§ â€œå¬ Flutter åˆ›å§‹äºº Eric ä¸ºä½ è®²è¿° Flutter çš„æ•…äº‹â€ã€‚æ­¤å¤–ï¼ŒDart è®¾è®¡ä¹‹åˆæ˜¯ä¸ºäº†å–ä»£ JavaScriptï¼Œåªä¸è¿‡æœ€ç»ˆå–ä»£å¤±è´¥ï¼Œå› è€Œè½¬æ¢å®šä½ï¼ŒæœåŠ¡äº Flutterã€‚</p><table><thead><tr><th align="left"></th><th align="left"><strong>Flutter</strong></th><th align="left"><strong>å‰ç«¯</strong></th></tr></thead><tbody><tr><td align="left"><strong>ç¼–ç¨‹è¯­è¨€</strong></td><td align="left">Dart</td><td align="left">JavaScript</td></tr><tr><td align="left"><strong>å“åº”å¼ UI ç¼–ç¨‹</strong></td><td align="left">å€Ÿé‰´ React</td><td align="left">Reactã€Vueã€Angular</td></tr><tr><td align="left"><strong>çŠ¶æ€ç®¡ç†</strong></td><td align="left">Providerã€Reduxã€Mobx</td><td align="left">Reduxã€Mobxã€Vuex</td></tr><tr><td align="left"><strong>é¡µé¢æ ·å¼</strong></td><td align="left">Widgets</td><td align="left">CSSã€styled-component</td></tr><tr><td align="left"><strong>UI åº“</strong></td><td align="left">å®˜æ–¹å†…ç½® Material Designã€Cupertino</td><td align="left">ç¤¾åŒº Ant Designã€Element</td></tr><tr><td align="left"><strong>å†…åµŒè§†å›¾</strong></td><td align="left">PlatformView</td><td align="left">iframe</td></tr><tr><td align="left"><strong>å¼€å‘å’Œè°ƒè¯•å·¥å…·</strong></td><td align="left">Dart DevTools</td><td align="left">Chrome DevTools</td></tr><tr><td align="left"><strong>ç¼–è¾‘å™¨</strong></td><td align="left">VS Codeã€Android Studio</td><td align="left">VS Codeã€Sublime Text</td></tr><tr><td align="left"><strong>åœ¨çº¿ç¼–è¾‘å™¨</strong></td><td align="left">DartPadã€CodePen</td><td align="left">CodePenã€JSFiddle</td></tr><tr><td align="left"><strong>åŒ…ç®¡ç†å·¥å…·</strong></td><td align="left">pub</td><td align="left">npmã€yarn</td></tr></tbody></table><table><thead><tr><th align="left"></th><th align="left"><strong>Dart</strong></th><th align="left"><strong>JavaScript</strong></th></tr></thead><tbody><tr><td align="left"><strong>ç¼–è¯‘</strong></td><td align="left">å³æ—¶ç¼–è¯‘ (JIT) æˆ–æå‰ç¼–è¯‘ (AOT)</td><td align="left">å³æ—¶ç¼–è¯‘ ( JIT )</td></tr><tr><td align="left"><strong>å¼‚æ­¥éé˜»å¡</strong></td><td align="left">å•çº¿ç¨‹ã€äº‹ä»¶å¾ªç¯ã€å¾®ä»»åŠ¡ã€å®ä»»åŠ¡</td><td align="left">å•çº¿ç¨‹ã€äº‹ä»¶å¾ªç¯ã€å¾®ä»»åŠ¡ã€å®ä»»åŠ¡</td></tr><tr><td align="left"><strong>å¼‚æ­¥ç¼–ç¨‹</strong></td><td align="left">Futureã€asyncã€await</td><td align="left">Promiseã€asyncã€await</td></tr><tr><td align="left"><strong>ç±»å‹ç³»ç»Ÿ</strong></td><td align="left">type safestatic type checking and runtime checks</td><td align="left">TypeScriptstatic type definitions</td></tr><tr><td align="left"><strong>ç»§æ‰¿</strong></td><td align="left">Class</td><td align="left">åŸå‹é“¾</td></tr><tr><td align="left"><strong>å¯†é›†å‹è®¡ç®—</strong></td><td align="left">Isolate</td><td align="left">Web Worker</td></tr></tbody></table><table><thead><tr><th align="left"></th><th align="left"><strong>Flutter</strong></th><th align="left"><strong>CSS</strong></th></tr></thead><tbody><tr><td align="left"><strong>æ ·å¼åŒ–æ–‡æœ¬</strong></td><td align="left">Textã€RichText</td><td align="left">font-sizeã€font-weightã€font-familyâ€¦</td></tr><tr><td align="left"><strong>ç›’æ¨¡å‹</strong></td><td align="left">åªæœ‰ border-box</td><td align="left">box-sizing: content-boxã€border-box;</td></tr><tr><td align="left"><strong>å¼¹æ€§ç›’å­å¸ƒå±€</strong></td><td align="left">Rowã€Column</td><td align="left">display: flexã€inline-flex;flex-direction: rowã€column;</td></tr><tr><td align="left"><strong>ç½‘æ ¼å¸ƒå±€</strong></td><td align="left">Grid</td><td align="left">display: grid;</td></tr><tr><td align="left"><strong>å®šä½æ–¹å¼</strong></td><td align="left">Aliginã€Stack &amp; Positionedã€Slivers</td><td align="left">position: staticã€relativeã€absoluteã€stickyã€fixed</td></tr><tr><td align="left"><strong>å˜æ¢ ( æ—‹è½¬ ç¼©æ”¾ å€¾æ–œ å¹³ç§»ç­‰ )</strong></td><td align="left">Transform</td><td align="left">transform</td></tr></tbody></table><hr><p>ä¸¾ä¸ª ğŸŒ°</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;greybox&quot;</span>&gt;</span></span><br><span class="line">  Lorem ipsum</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">.greybox &#123; background-color: #e0e0e0; /* grey 300 */ width: 320px; height: 240px; font: 900 24px Georgia; display: flex; align-items: center; justify-content: center; &#125; // Flutter Dart var container = Container( // grey box color: Colors.grey[300], width: 320, height: 240, child: Center( child: Text( &quot;Lorem ipsum&quot;, style: TextStyle( fontWeight: FontWeight.w900, fontSize: 24, fontFamily: &quot;Georgia&quot;, ), ), ), );</span><br></pre></td></tr></table></figure><h2 id="äº”ã€ç¯å¢ƒæ­å»º"><a href="#äº”ã€ç¯å¢ƒæ­å»º" class="headerlink" title="äº”ã€ç¯å¢ƒæ­å»º"></a>äº”ã€ç¯å¢ƒæ­å»º</h2><p>å‚è€ƒ<strong>å®˜ç½‘</strong>[1]ï¼Œæœ‰éå¸¸è¯¦ç»†çš„æ•™ç¨‹ã€‚</p><p>å…³é”®æ­¥éª¤ï¼Œå®‰è£… Flutter SDKã€‚</p><p>IDE æ¨èä½¿ç”¨ Android Studioï¼Œå½“ç„¶ VS CODE è£…ä¸Šå¯¹åº”æ’ä»¶ä¹Ÿ OKã€‚</p><h2 id="å…­ã€ä»£ç å¯¹æ¯”"><a href="#å…­ã€ä»£ç å¯¹æ¯”" class="headerlink" title="å…­ã€ä»£ç å¯¹æ¯”"></a>å…­ã€ä»£ç å¯¹æ¯”</h2><ol><li><h3 id="å…¥å£æ–‡ä»¶"><a href="#å…¥å£æ–‡ä»¶" class="headerlink" title="å…¥å£æ–‡ä»¶"></a>å…¥å£æ–‡ä»¶</h3></li></ol><p>main.dart ä½œä¸ºå…¥å£æ–‡ä»¶ä¸»è¦æœ‰ä¸€ä¸ªä¸»å‡½æ•° mainï¼ŒåŒæ—¶è¿™ä¸ªä¸»å‡½æ•°ä¹Ÿæ˜¯ä½œä¸ºæ•´ä¸ªåº”ç”¨çš„å…¥å£å‡½æ•°ï¼Œå…¶ä¸­ main é‡Œé¢èµ·åˆ°å…³é”®ä½œç”¨çš„å°±æ˜¯ runApp å‡½æ•°ï¼Œè¿™ä¸ React çš„ ReactDOM.render ä½œç”¨ç±»ä¼¼ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>; <span class="comment">// è°·æ­Œå®˜æ–¹ç»„ä»¶åº“ï¼Œç±»æ¯”antd</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;app.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  runApp(App());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹æ¯”çš„ React ä»£ç </p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;./App&quot;</span>;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;App /&gt;,</span><br><span class="line"></span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="Model-å±‚è®¾è®¡"><a href="#Model-å±‚è®¾è®¡" class="headerlink" title="Model å±‚è®¾è®¡"></a>Model å±‚è®¾è®¡</h3><p>Todo List åº”ç”¨æœ‰åˆ—è¡¨ä»¥åŠ todo è¯¦æƒ…ï¼Œå› æ­¤æˆ‘ä»¬è¿™ä¸€å—è®¾è®¡ä¸¤ä¸ªç±»ï¼Œä¸€ä¸ª TodoList ç±»å¯¹åº”åˆ—è¡¨ï¼Œä¸€ä¸ª Todo ç±»å¯¹åº” todo è¯¦æƒ…ã€‚</p><p>è‡³äº React é¡¹ç›®é‚£è¾¹ï¼Œå¯èƒ½è¿™ç§è®¾è®¡ä¸æ˜¯å¾ˆå¸¸è§ï¼Œä½†æ˜¯ä¸ºäº†æ–¹ä¾¿å¯¹æ¯”ï¼Œè®¾è®¡å’Œ Flutter ä¿æŒäº†ä¸€è‡´ã€‚</p><p>Flutter Todo ç±»ä»£ç ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:uuid/uuid.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todo</span> </span>&#123;</span><br><span class="line">  <span class="built_in">bool</span> complete; <span class="comment">// todoçš„å®ŒæˆçŠ¶æ€</span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> id; <span class="comment">// todoçš„å”¯ä¸€id</span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">DateTime</span> time; <span class="comment">// todoåˆ›å»ºæ—¶é—´</span></span><br><span class="line">  <span class="built_in">String</span> task; <span class="comment">// todoçš„å…·ä½“ä»»åŠ¡</span></span><br><span class="line"></span><br><span class="line">  Todo(&#123;</span><br><span class="line">    <span class="keyword">this</span>.task,</span><br><span class="line">    <span class="keyword">this</span>.complete = <span class="keyword">false</span>,</span><br><span class="line">    <span class="built_in">DateTime</span> time,</span><br><span class="line">    <span class="built_in">String</span> id</span><br><span class="line">  &#125;) : <span class="keyword">this</span>.time = time ?? <span class="built_in">DateTime</span>.now(), <span class="keyword">this</span>.id = id ?? Uuid().v4();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>React å¯¹æ¯”ä»£ç ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; v4 &#125; <span class="keyword">from</span> <span class="string">&quot;uuid&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todo</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(task, id = v4(), complete = false, time = new Date().toLocaleString()) &#123;</span><br><span class="line">    <span class="built_in">this</span>.id = id;</span><br><span class="line">    <span class="built_in">this</span>.task = task;</span><br><span class="line">    <span class="built_in">this</span>.complete = complete;</span><br><span class="line">    <span class="built_in">this</span>.time = time;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Todo;</span><br></pre></td></tr></table></figure><h3 id="é¡µé¢è·¯ç”±"><a href="#é¡µé¢è·¯ç”±" class="headerlink" title="é¡µé¢è·¯ç”±"></a>é¡µé¢è·¯ç”±</h3><p>Flutter çš„è·¯ç”±è·³è½¬ä¸»è¦ç”¨åˆ° Navigatorï¼ŒReact é‚£è¾¹å¯¹åº”çš„å°±æ˜¯ historyã€‚</p><p>é¡µé¢è·¯ç”±æœ‰å‡ ç§æ–¹å¼ï¼Œè¯¦ç»†å‚è€ƒå®˜ç½‘ã€‚è¿™é‡Œä¸ºäº†ä¸ React å¯¹æ¯”ä¸»è¦ä»‹ç»å‘½åè·¯ç”±ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;pages/detail/index.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;pages/list/index.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;models/todo_list.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:provider/provider.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> App(&#123;Key key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MultiProvider(</span><br><span class="line">      providers: [</span><br><span class="line">        ChangeNotifierProvider(create: (_) =&gt; TodoList()),</span><br><span class="line">      ],</span><br><span class="line"></span><br><span class="line">      child: MaterialApp(</span><br><span class="line">        title: <span class="string">&#x27;flutter todo list&#x27;</span>,</span><br><span class="line">        initialRoute: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">        routes: &#123;</span><br><span class="line"></span><br><span class="line">          <span class="string">&#x27;/&#x27;</span>: (context) =&gt; ListPage(),</span><br><span class="line"></span><br><span class="line">          <span class="string">&#x27;/list&#x27;</span>: (context) =&gt; ListPage(),</span><br><span class="line"></span><br><span class="line">          <span class="string">&#x27;/detail&#x27;</span>: (context) =&gt; DetailPage(<span class="keyword">false</span>),</span><br><span class="line"></span><br><span class="line">          <span class="string">&#x27;/edit&#x27;</span>: (context) =&gt; DetailPage(<span class="keyword">true</span>),</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>React ä»£ç </p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; BrowserRouter, Switch, Route &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> TodoListContext, &#123; todoList &#125; <span class="keyword">from</span> <span class="string">&quot;./models/todoList&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> DetailPage <span class="keyword">from</span> <span class="string">&quot;./pages/detail&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ListPage <span class="keyword">from</span> <span class="string">&quot;./pages/list&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./App.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;antd-mobile/dist/antd-mobile.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;TodoListContext.Provider value=&#123;todoList&#125;&gt;</span><br><span class="line">      &lt;BrowserRouter&gt;</span><br><span class="line">        &lt;Switch&gt;</span><br><span class="line">          &lt;Route exact path=<span class="string">&quot;/&quot;</span> component=&#123;ListPage&#125; /&gt;</span><br><span class="line">          &lt;Route exact path=<span class="string">&quot;/list&quot;</span> component=&#123;ListPage&#125; /&gt;</span><br><span class="line">          &lt;Route exact path=<span class="string">&quot;/detail&quot;</span> component=&#123;DetailPage&#125; /&gt;</span><br><span class="line">          &lt;Route exact path=<span class="string">&quot;/edit&quot;</span> component=&#123;DetailPage&#125; /&gt;</span><br><span class="line">        &lt;/Switch&gt;</span><br><span class="line">      &lt;/BrowserRouter&gt;</span><br><span class="line">    &lt;/TodoListContext.Provider&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure><h2 id="ä¸ƒã€Flutter-ä¸ºä»€ä¹ˆé€‰æ‹©-Dart"><a href="#ä¸ƒã€Flutter-ä¸ºä»€ä¹ˆé€‰æ‹©-Dart" class="headerlink" title="ä¸ƒã€Flutter ä¸ºä»€ä¹ˆé€‰æ‹© Dart ?"></a>ä¸ƒã€Flutter ä¸ºä»€ä¹ˆé€‰æ‹© Dart ?</h2><ol><li>Flutter é€‰æ‹©å¼€å‘è¯­è¨€æ—¶ï¼Œä½¿ç”¨ 4 ä¸ªä¸»è¦ç»´åº¦è¿›è¡Œè¯„ä¼°ï¼ŒDart åœ¨æ‰€æœ‰è¯„ä¼°ç»´åº¦ä¸Šéƒ½å–å¾—é«˜åˆ†</li></ol><ul><li>å¼€å‘è€…çš„ç”Ÿäº§åŠ›</li><li>é¢å‘å¯¹è±¡</li><li>ç¨³å®šå¯æœŸçš„é«˜æ€§èƒ½è¡¨ç°</li><li>å¿«é€Ÿå†…å­˜åˆ†é…</li></ul><ol><li>Dart çš„è¿è¡Œæ—¶å’Œç¼–è¯‘å™¨æ”¯æŒ Flutter çš„ä¸¤ä¸ªå…³é”®ç‰¹æ€§</li></ol><ul><li>åŸºäº JIT ( å³æ—¶ç¼–è¯‘ ) çš„å¿«é€Ÿå¼€å‘å‘¨æœŸï¼Œå…è®¸åœ¨å¸¦ç±»å‹çš„è¯­è¨€ä¸­æ”¯æŒå½¢å˜å’Œæœ‰çŠ¶æ€çƒ­é‡è½½</li><li>ä¸€ä¸ªèƒ½äº§å‡ºé«˜æ•ˆç‡ ARM ä»£ç çš„ AOT (Ahead of time æå‰ç¼–è¯‘) ç¼–è¯‘å™¨ï¼Œä»è€Œç¡®ä¿å¿«é€Ÿå¯åŠ¨çš„èƒ½åŠ›å’Œå¯é¢„æœŸçš„ç”Ÿäº§ç‰ˆæœ¬è¿è¡Œæ€§èƒ½</li></ul><ol><li>Dart å›¢é˜Ÿå°±åœ¨ä½ èº«è¾¹ï¼šä¸ Dart ç¤¾åŒºå±•å¼€äº†å¯†åˆ‡åˆä½œï¼ŒDart ç¤¾åŒºç§¯ææŠ•å…¥èµ„æºæ”¹è¿› Dartï¼Œä»¥ä¾¿åœ¨ Flutter ä¸­æ›´æ˜“ä½¿ç”¨</li></ol><h2 id="å…«ã€Flutter-æ€§èƒ½ä¸ºä½•èƒ½å¤Ÿåª²ç¾åŸç”Ÿåº”ç”¨ï¼Ÿ"><a href="#å…«ã€Flutter-æ€§èƒ½ä¸ºä½•èƒ½å¤Ÿåª²ç¾åŸç”Ÿåº”ç”¨ï¼Ÿ" class="headerlink" title="å…«ã€Flutter æ€§èƒ½ä¸ºä½•èƒ½å¤Ÿåª²ç¾åŸç”Ÿåº”ç”¨ï¼Ÿ"></a>å…«ã€Flutter æ€§èƒ½ä¸ºä½•èƒ½å¤Ÿåª²ç¾åŸç”Ÿåº”ç”¨ï¼Ÿ</h2><p><img src="/assets/20230910-flutter/640-1.jpg" alt="å›¾ç‰‡"></p><h2 id="ä¹ã€Flutter-ä¸åŸç”Ÿäº¤äº’"><a href="#ä¹ã€Flutter-ä¸åŸç”Ÿäº¤äº’" class="headerlink" title="ä¹ã€Flutter ä¸åŸç”Ÿäº¤äº’"></a>ä¹ã€Flutter ä¸åŸç”Ÿäº¤äº’</h2><ol><li><h3 id="PlatformChannel"><a href="#PlatformChannel" class="headerlink" title="PlatformChannel"></a>PlatformChannel</h3></li></ol><p>é€‚ç”¨äºä¸å¸¦ UI çš„åŠŸèƒ½ï¼ŒFlutter ä¸åŸç”Ÿçº¦å®šé€šé“æ–¹æ³•ï¼ŒåŸç”Ÿé€šè¿‡ API çš„å½¢å¼æä¾›å®šä½ã€è“ç‰™ã€ä¼ æ„Ÿå™¨ç­‰ç³»ç»ŸåŠŸèƒ½ï¼Œæˆ–è€…å¤ç”¨å®¢æˆ·ç«¯ SDKï¼Œæä¾›è¯·æ±‚ã€ä¸Šä¼ ã€ç¾é¢œã€äººè„¸è¯†åˆ«ã€æ¨é€ã€ IM ç­‰åŸºç¡€åŠŸèƒ½</p><p><img src="/assets/20230910-flutter/640-1.png" alt="å›¾ç‰‡"></p><ol><li><h3 id="PlatformView"><a href="#PlatformView" class="headerlink" title="PlatformView"></a>PlatformView</h3></li></ol><p>é€‚ç”¨äºå¸¦ UI çš„åŠŸèƒ½ï¼ŒFlutter å†…åµŒåŸç”Ÿè§†å›¾ï¼Œä¾‹å¦‚åœ°å›¾ã€WebView ç­‰</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Widget build(BuildContext context) &#123;</span><br><span class="line">  <span class="keyword">if</span> (defaultTargetPlatform == TargetPlatform.android) &#123;</span><br><span class="line">      <span class="keyword">return</span> AndroidView(</span><br><span class="line">        viewType: <span class="string">&#x27;plugins.flutter.io/google_maps&#x27;</span>,</span><br><span class="line">        onPlatformViewCreated: onPlatformViewCreated,</span><br><span class="line">        gestureRecognizers: gestureRecognizers,</span><br><span class="line">        creationParams: creationParams,</span><br><span class="line">        creationParamsCodec: <span class="keyword">const</span> StandardMessageCodec(),</span><br><span class="line">      );</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (defaultTargetPlatform == TargetPlatform.iOS) &#123;</span><br><span class="line">      <span class="keyword">return</span> UiKitView(</span><br><span class="line">        viewType: <span class="string">&#x27;plugins.flutter.io/google_maps&#x27;</span>,</span><br><span class="line">        onPlatformViewCreated: onPlatformViewCreated,</span><br><span class="line">        gestureRecognizers: gestureRecognizers,</span><br><span class="line">        creationParams: creationParams,</span><br><span class="line">        creationParamsCodec: <span class="keyword">const</span> StandardMessageCodec(),</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Text(</span><br><span class="line"><span class="string">&#x27;<span class="subst">$defaultTargetPlatform</span> is not yet supported by the maps plugin&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åã€Flutter-å¼€å‘ä½“éªŒï¼šâ€UI-as-Codeâ€"><a href="#åã€Flutter-å¼€å‘ä½“éªŒï¼šâ€UI-as-Codeâ€" class="headerlink" title="åã€Flutter å¼€å‘ä½“éªŒï¼šâ€UI as Codeâ€"></a>åã€Flutter å¼€å‘ä½“éªŒï¼šâ€UI as Codeâ€</h2><p>Flutter çš„ UI ä»£ç ä½¿ç”¨ Dart è¯­è¨€ï¼Œå…¶ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p><ul><li>Flutter çš„å£°æ˜å¼ UI ç¼–å†™æ–¹æ³•èƒ½å¤Ÿç›´è§‚åœ°æè¿° UI ç»“æ„ ( å€Ÿé‰´ React )</li><li>ä¸éœ€è¦ä¸º UI å¸ƒå±€å­¦ä¹ é¢å¤–çš„è¯­æ³•</li><li>ä¸éœ€è¦ç»´æŠ¤ä»£ç ä¹‹å¤–çš„ UI å®šä¹‰æ–‡ä»¶</li></ul><hr><p>ä½†æ˜¯ï¼Œä¹Ÿå­˜åœ¨å‡ ä¸ªé—®é¢˜ï¼š</p><p>é—®é¢˜ä¸€ï¼šå¤æ‚ UI é€»è¾‘ä¼šä½¿ç”¨å‘½ä»¤å¼è¯­æ³•ï¼Œæ‰“ç ´ä»£ç ç»“æ„å’Œ UI è§†è§‰ç»“æ„çš„ä¸€è‡´æ€§ ( ä»£ç çœ‹èµ·æ¥æ›´åƒæ˜¯å‘½ä»¤å¼çš„è€Œä¸æ˜¯å£°æ˜å¼çš„ )</p><p><img src="/assets/20230910-flutter/640-2.png" alt="å›¾ç‰‡"></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Widget build(BuildContext context) &#123;</span><br><span class="line">  <span class="built_in">List</span>&lt;SegmentedTabBarItem&gt; items = [];</span><br><span class="line">  <span class="built_in">List</span> genders = [<span class="string">&quot;ç”·ç”Ÿ&quot;</span>, <span class="string">&quot;å¥³ç”Ÿ&quot;</span>, <span class="string">&quot;ä¸é™&quot;</span>];</span><br><span class="line">  <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; genders.length; i++) &#123;</span><br><span class="line">      items.add(SegmentedTabBarItem(</span><br><span class="line">          text: genders[i],</span><br><span class="line">          width: <span class="number">102</span>,</span><br><span class="line">          radius: <span class="number">8</span>,</span><br><span class="line">          fontWeight: FontWeight.w500,</span><br><span class="line">          selectedTextColor: Colors.white,</span><br><span class="line">          duration: <span class="built_in">Duration</span>(milliseconds: <span class="number">0</span>),</span><br><span class="line">      ));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> SegmentedTabBar(</span><br><span class="line">      tabItemSpacing: <span class="number">6.5</span>,</span><br><span class="line">      tabBarRadius: $rem(<span class="number">12</span>),</span><br><span class="line">      tabIndex: genderIndex,</span><br><span class="line">      padding: EdgeInsets.symmetric(horizontal: <span class="number">0</span>),</span><br><span class="line">      selectedItemBackgroundColor: Colors.purple,</span><br><span class="line">      duration: <span class="built_in">Duration</span>(milliseconds: <span class="number">0</span>),</span><br><span class="line">      children: items,</span><br><span class="line">      onSelected: (<span class="built_in">int</span> index) &#123;</span><br><span class="line">          setState(() &#123;</span><br><span class="line">              genderIndex = index;</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>SegmentedTabBar åœ¨æ¦‚å¿µå’Œè§†è§‰ä¸Šéƒ½åº”è¯¥å…ˆäº items å‡ºç°ã€‚ä½†æ˜¯ç”±äºè¯­æ³•å±€é™ï¼Œè¿™ä¸ªç©ºé—´å…³ç³»è¢«åäº†è¿‡æ¥ã€‚ä»£ç çœ‹èµ·æ¥æ›´åƒæ˜¯å‘½ä»¤å¼è€Œä¸æ˜¯å£°æ˜å¼ã€‚</p><hr><p>è§£å†³æ–¹æ¡ˆï¼šåœ¨ Dart 2.3 ä¸­åŠ å…¥äº†é’ˆå¯¹ UI ç¼–ç¨‹ä¼˜åŒ–çš„æ–°è¯­æ³•å…ƒç´ ï¼Œå³å¯ä»¥åœ¨é›†åˆæ•°æ®ç±»å‹çš„å®šä¹‰ä¸­ä½¿ç”¨ if å’Œ for è¿™æ ·çš„æµç¨‹æ§åˆ¶å…ƒç´ ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Widget build(BuildContext context) &#123;</span><br><span class="line">  <span class="keyword">return</span> SegmentedTabBar(</span><br><span class="line">      tabItemSpacing: <span class="number">6.5</span>,</span><br><span class="line">      tabBarRadius: $rem(<span class="number">12</span>),</span><br><span class="line">      tabIndex: genderIndex,</span><br><span class="line">      padding: EdgeInsets.symmetric(horizontal: <span class="number">0</span>),</span><br><span class="line">      selectedItemBackgroundColor: Colors.purple,</span><br><span class="line">      duration: <span class="built_in">Duration</span>(milliseconds: <span class="number">0</span>),</span><br><span class="line">      children: &lt;SegmentedTabBarItem&gt;[</span><br><span class="line">          <span class="keyword">for</span> (<span class="built_in">String</span> label <span class="keyword">in</span> [<span class="string">&quot;ç”·ç”Ÿ&quot;</span>, <span class="string">&quot;å¥³ç”Ÿ&quot;</span>, <span class="string">&quot;ä¸é™&quot;</span>])</span><br><span class="line">              SegmentedTabBarItem(</span><br><span class="line">                  text: label,</span><br><span class="line">                  width: <span class="number">102</span>,</span><br><span class="line">                  radius: <span class="number">8</span>,</span><br><span class="line">                  fontWeight: FontWeight.w500,</span><br><span class="line">                  selectedTextColor: Colors.white,</span><br><span class="line">                  duration: <span class="built_in">Duration</span>(milliseconds: <span class="number">0</span>),</span><br><span class="line">              ),</span><br><span class="line">      ],</span><br><span class="line">      onSelected: (<span class="built_in">int</span> index) &#123;</span><br><span class="line">          setState(() &#123;</span><br><span class="line">              genderIndex = index;</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>é—®é¢˜äºŒï¼šå¤šå±‚åµŒå¥—ä¹‹åä¸å®¹æ˜“å¯¹ UI çš„æ„æˆåšåˆ°ä¸€ç›®äº†ç„¶</p><p>è§£å†³æ–¹æ¡ˆï¼šIDE ä¸­åŠ å…¥äº† Editor UI Guides</p><p><img src="/assets/20230910-flutter/640-3.png" alt="å›¾ç‰‡"></p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p>å‰ç«¯ Flutter å…¥é—¨æŒ‡å— <a href="https://mp.weixin.qq.com/s/mgSIu_xcHzU1-Ku218Pjmg">https://mp.weixin.qq.com/s/mgSIu_xcHzU1-Ku218Pjmg</a></p>]]></content>
      
      
      <categories>
          
          <category> åšå®¢ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> serverless </tag>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»0åˆ°1æ­å»ºä¸ªäººåšå®¢</title>
      <link href="/2023/08/15/20230815-blog/"/>
      <url>/2023/08/15/20230815-blog/</url>
      
        <content type="html"><![CDATA[<h2 id="ç›®çš„"><a href="#ç›®çš„" class="headerlink" title="ç›®çš„"></a>ç›®çš„</h2><p>æœ¬æ–‡æ„åœ¨å¸®åŠ©å¼€å‘åŒå­¦å¿«é€Ÿã€é«˜æ•ˆçš„æ­å»ºä¸ªäººåšå®¢ï¼›</p><h2 id="æŠ€æœ¯æ ˆ"><a href="#æŠ€æœ¯æ ˆ" class="headerlink" title="æŠ€æœ¯æ ˆ"></a>æŠ€æœ¯æ ˆ</h2><p>nodeã€hexoã€è…¾è®¯äº‘ Serverless Frameworkï¼ˆssrã€äº‘å‡½æ•°ã€äº‘æ‰˜ç®¡ã€cos ç­‰ï¼‰ï¼›</p><h2 id="èµ·æ­¥"><a href="#èµ·æ­¥" class="headerlink" title="èµ·æ­¥"></a>èµ·æ­¥</h2><blockquote><p>é¦–å…ˆåœ¨è‡ªå·±çš„ github ä¸­åˆ›å»ºä¸€ä¸ªåŒåçš„.github.io çš„ä»“åº“ï¼ˆå¦‚ï¼šgithub åä¸º testï¼Œå°±éœ€è¦åˆ›å»ºä¸€ä¸ªåä¸º test.github.io çš„ä»“åº“ï¼‰ï¼›</p></blockquote><p>å…¨å±€å®‰è£… hexo å‘½ä»¤è¡Œå·¥å…·ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-cli -g</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–é¡¹ç›®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ hexo init <span class="built_in">test</span> <span class="comment"># testæ˜¯é¡¹ç›®çš„åç§°ï¼Œè‡ªå®šä¹‰ï¼›</span></span><br><span class="line">$ <span class="built_in">cd</span> <span class="built_in">test</span> <span class="comment"># testæ˜¯é¡¹ç›®çš„åç§°ï¼Œè‡ªå®šä¹‰ï¼›</span></span><br><span class="line">$ npm install</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–å®Œæˆåï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªé¡¹ç›®ï¼Œç›®å½•ç»“æ„é•¿è¿™æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ _config.yml &#x2F;&#x2F; é¡¹ç›®é…ç½®æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ package.json</span><br><span class="line">â”œâ”€â”€ scaffolds &#x2F;&#x2F; åšå®¢æ¨¡æ¿æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ source &#x2F;&#x2F; åä½œä¸»ä½“æ–‡ä»¶</span><br><span class="line">|   â”œâ”€â”€ _drafts &#x2F;&#x2F; è‰ç¨¿æ–‡ä»¶</span><br><span class="line">|   â””â”€â”€ _posts &#x2F;&#x2F; æ–‡ç« æ–‡ä»¶ï¼Œæ‰€æœ‰æ–‡ç« éƒ½æ”¾åœ¨è¿™é‡Œé¢å³å¯</span><br><span class="line">â””â”€â”€ themes &#x2F;&#x2F; åšå®¢çš®è‚¤ä¸»ä½“æ–‡ä»¶ï¼Œæ›´æ¢åšå®¢çš®è‚¤æ—¶ç”¨åˆ°</span><br></pre></td></tr></table></figure><p>é…ç½®</p><p>æˆ‘ä»¬å¯ä»¥åœ¨_config.yml æ–‡ä»¶ä¸­<a href="https://hexo.io/zh-cn/docs/configuration">é…ç½®</a>åšå®¢çš„åŸºæœ¬ä¿¡æ¯ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Site</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">&quot;è¾°æ€»çš„blog&quot;</span></span><br><span class="line"><span class="attr">subtitle:</span> <span class="string">&quot;ä¸ªäººåšå®¢ï¼ŒæŠ€æœ¯æ–‡ç« ï¼Œç”Ÿæ´»éšç¬”ï¼Œè®°å½•ä¼˜ç§€çš„æ–‡ç« &quot;</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">&quot;JavaScriptã€Nodeã€Vueã€Reactã€ç”Ÿæ´»éšç¬”ã€è®°å½•ä¼˜ç§€çš„æ–‡ç« &quot;</span></span><br><span class="line"><span class="attr">keywords:</span> <span class="string">&quot;JavaScriptã€Nodeã€Vueã€Reactã€ç”Ÿæ´»éšç¬”ã€è®°å½•ä¼˜ç§€çš„æ–‡ç« &quot;</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">lgc</span></span><br><span class="line"><span class="attr">language:</span> <span class="string">zh-cmn-Hans</span></span><br><span class="line"><span class="attr">timezone:</span> <span class="string">&quot;Asia/Shanghai&quot;</span></span><br></pre></td></tr></table></figure><h2 id="å†™ä½œ"><a href="#å†™ä½œ" class="headerlink" title="å†™ä½œ"></a>å†™ä½œ</h2><p>æˆ‘ä»¬å†™æ–‡ç« ä¸»è¦æ˜¯åœ¨_posts ç›®å½•ä¸‹,_drafts æ˜¯è‰ç¨¿ç›®å½•ï¼Œå¦‚æœæ–‡ç« ä¸æƒ³è¢«å‘è¡¨ï¼Œå¯æš‚æ—¶å­˜æ”¾åˆ°è¿™é‡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ source &#x2F;&#x2F; åä½œä¸»ä½“æ–‡ä»¶</span><br><span class="line">|   â”œâ”€â”€ _drafts &#x2F;&#x2F; è‰ç¨¿æ–‡ä»¶</span><br><span class="line">|   â””â”€â”€ _posts &#x2F;&#x2F; æ–‡ç« æ–‡ä»¶ï¼Œæ‰€æœ‰æ–‡ç« éƒ½æ”¾åœ¨è¿™é‡Œé¢å³å¯</span><br></pre></td></tr></table></figure><p>layout å¸ƒå±€æ–‡ä»¶å¤¹ã€‚ç”¨äºå­˜æ”¾ä¸»é¢˜çš„æ¨¡æ¿æ–‡ä»¶ï¼Œå†³å®šäº†ç½‘ç«™å†…å®¹çš„å‘ˆç°æ–¹å¼ï¼ŒHexo å†…å»º <a href="https://github.com/node-swig/swig-templates">Swig</a> æ¨¡æ¿å¼•æ“ï¼Œæ‚¨å¯ä»¥å¦å¤–å®‰è£…æ’ä»¶æ¥è·å¾— <a href="https://github.com/hexojs/hexo-renderer-ejs">EJS</a>ã€<a href="https://github.com/hexojs/hexo-renderer-haml">Haml</a>ã€<a href="https://github.com/hexojs/hexo-renderer-jade">Jade</a> æˆ– <a href="https://github.com/maxknee/hexo-render-pug">Pug</a> æ”¯æŒï¼ŒHexo æ ¹æ®æ¨¡æ¿æ–‡ä»¶çš„æ‰©å±•åæ¥å†³å®šæ‰€ä½¿ç”¨çš„æ¨¡æ¿å¼•æ“ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">layout.ejs   - ä½¿ç”¨ EJS</span><br><span class="line">layout.swig  - ä½¿ç”¨ Swig</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ hexo server å¯åŠ¨ hexo æœ¬åœ°æœåŠ¡å™¨ï¼Œå¯ä»¥çœ‹åˆ°é¡¹ç›®ç”Ÿæˆäº†ä¸€ä¸ª demo æ–‡ç« ï¼ˆhexo server -p xxxxï¼Œå¯è‡ªå®šä¹‰ç«¯å£ï¼‰ï¼š</p><p><em>æ‰€æœ‰æ–‡ç« çš„å†™ä½œä½¿ç”¨çš„æ˜¯<a href="https://www.runoob.com/markdown/md-tutorial.html">markdown</a>è¯­æ³•ï¼Œæ–‡ä»¶åæœ€å¥½æ˜¯æ—¥æœŸ-æ–‡ç« å†…å®¹çš„æ–¹å¼ï¼ˆå¦‚ï¼š20200915-blog.mdï¼‰ï¼Œåç¼€åæ˜¯.mdï¼›</em></p><p><img src="/assets/20200915-blog/img1.png" alt="image-20200911172630511"></p><p>Front-matter</p><p>Front-matter æ˜¯æ–‡ä»¶æœ€ä¸Šæ–¹ä»¥ â€” åˆ†éš”çš„åŒºåŸŸï¼Œç”¨äºæŒ‡å®šä¸ªåˆ«æ–‡ä»¶çš„å˜é‡ï¼Œä¸¾ä¾‹æ¥è¯´ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">å¤§å®¶å¥½</span> <span class="string">//</span> <span class="string">é¡µé¢çš„æ ‡é¢˜</span></span><br><span class="line"><span class="attr">categories:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">aaa</span> <span class="string">//</span> <span class="string">æ–‡ç« åˆ†ç±»</span></span><br><span class="line"><span class="attr">tags:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">bbb</span> <span class="string">//</span> <span class="string">æ–‡ç« æ ‡ç­¾</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ccc</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">...other</span> <span class="string">code</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°é¡µé¢ä¸­çš„æ ‡é¢˜ï¼Œåˆ†ç±»éƒ½åŠ ä¸Šäº†</p><p><img src="/assets/20200915-blog/img2.png" alt="image-20200911172630511"></p><p>å¸¸ç”¨çš„å˜é‡åˆ—è¡¨å¦‚ä¸‹ï¼š</p><table><thead><tr><th align="center">å‚æ•°</th><th align="center">æè¿°</th><th align="center">é»˜è®¤å€¼</th></tr></thead><tbody><tr><td align="center">layout</td><td align="center">å¸ƒå±€</td><td align="center"></td></tr><tr><td align="center">title</td><td align="center">æ ‡é¢˜</td><td align="center">æ–‡ç« çš„æ–‡ä»¶å</td></tr><tr><td align="center">date</td><td align="center">å»ºç«‹æ—¥æœŸ</td><td align="center">æ–‡ä»¶å»ºç«‹æ—¥æœŸ</td></tr><tr><td align="center">updated</td><td align="center">æ›´æ–°æ—¥æœŸ</td><td align="center">æ–‡ä»¶æ›´æ–°æ—¥æœŸ</td></tr><tr><td align="center">comments</td><td align="center">å¼€å¯æ–‡ç« çš„è¯„è®ºåŠŸèƒ½</td><td align="center">true</td></tr><tr><td align="center">tags</td><td align="center">æ ‡ç­¾ï¼ˆä¸é€‚ç”¨äºåˆ†é¡µï¼‰</td><td align="center"></td></tr><tr><td align="center">categories</td><td align="center">åˆ†ç±»ï¼ˆä¸é€‚ç”¨äºåˆ†é¡µï¼‰</td><td align="center"></td></tr><tr><td align="center">permalink</td><td align="center">è¦†ç›–æ–‡ç« ç½‘å€</td><td align="center"></td></tr></tbody></table><h2 id="ä¸»é¢˜"><a href="#ä¸»é¢˜" class="headerlink" title="ä¸»é¢˜"></a>ä¸»é¢˜</h2><p>hexo æä¾›äº†å¾ˆå¤šç°æˆçš„<a href="https://hexo.io/themes/">ä¸»é¢˜</a>ä¾›å¤§å®¶é€‰æ‹©,å¤§å®¶é€‰æ‹©è‡ªå·±å–œæ¬¢çš„å³å¯ï¼Œè¿™é‡Œé€‰æ‹©<a href="https://github.com/probberechts/hexo-theme-cactus/blob/master/README.md">cactus</a>-ä¸€æ¬¾æ¯”è¾ƒç»å…¸çš„ hexo ä¸»é¢˜æ¼”ç¤ºï¼š</p><p>åœ¨é¡¹ç›®æ ¹ç›®å½• clone é¡¹ç›®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/probberechts/hexo-theme-cactus.git themes/cactus</span><br></pre></td></tr></table></figure><p>åœ¨_config.yml ä¸­é…ç½®åšå®¢çš„ä¸»é¢˜å³å¯ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># theme: landscape</span></span><br><span class="line"><span class="attr">theme:</span> <span class="string">cactus</span></span><br></pre></td></tr></table></figure><p>é‡æ–° hexo server åå¯ä»¥çœ‹åˆ°æ–°çš„ä¸»é¢˜äº†ï¼š</p><p><img src="/assets/20200915-blog/img3.png" alt="image-20200911172630511"></p><p><img src="/assets/20200915-blog/img4.png" alt="image-20200911172630511"></p><p>è‡ªå®šä¹‰é¡¶éƒ¨å¯¼èˆªä¿¡æ¯<br>é»˜è®¤ä¸»é¢˜ä¼šæä¾›ä»¥ä¸‹å¯¼èˆªä¿¡æ¯</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">nav:</span></span><br><span class="line">  <span class="attr">Home:</span> <span class="string">/</span></span><br><span class="line">  <span class="attr">About:</span> <span class="string">/about/</span></span><br><span class="line">  <span class="attr">Writing:</span> <span class="string">/archives/</span></span><br><span class="line">  <span class="attr">Projects:</span> <span class="string">http://github.com/probberechts</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬è¦å¢åŠ åªè¦åœ¨ä¸‹é¢å¢åŠ ä¸€ä¸ªå˜é‡ï¼Œé…ç½®ä¸€ä¸‹è·¯ç”±å³å¯</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">nav:</span> <span class="string">...</span></span><br><span class="line">  <span class="string">haha:/</span></span><br></pre></td></tr></table></figure><p><img src="/assets/20200915-blog/img5.png" alt="image-20200911172630511"></p><p>æ·»åŠ <a href="https://tongji.baidu.com/">ç™¾åº¦ç»Ÿè®¡</a>,æŒ‰ç…§æŒ‡å¼•å¼€é€šç»‘å®šé¡¹ç›®ï¼šç„¶åä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Fill in your Baidu Analytics tracking ID to enable Baidu Analytics.</span></span><br><span class="line"><span class="attr">baidu_analytics:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">id:</span> <span class="string">2e6da3c375c8a87f5b664cexxx</span> <span class="comment"># id=ç™¾åº¦ç»Ÿè®¡ä¸ºåº”ç”¨åˆ†é…çš„id</span></span><br></pre></td></tr></table></figure><p>æ·»åŠ è¯„è®ºç³»ç»Ÿ</p><p>æœ¬æ•™ç¨‹ä½¿ç”¨çš„æ˜¯<a href="https://valine.js.org/quickstart.html">valine</a>-ä¸€æ¬¾æ— éœ€ç™»å½•ã€é…ç½®æ–¹ä¾¿çš„è¯„è®ºç³»ç»Ÿï¼›</p><p>å…ˆ<a href="https://leancloud.cn/dashboard/login.html#/signin">ç™»å½•</a>æˆ–<a href="https://leancloud.cn/dashboard/login.html#/signup">æ³¨å†Œ</a> <code>LeanCloud</code>, è¿›å…¥<a href="https://leancloud.cn/dashboard/applist.html#/apps">æ§åˆ¶å°</a>åç‚¹å‡»å·¦ä¸‹è§’<a href="https://leancloud.cn/dashboard/applist.html#/newapp">åˆ›å»ºåº”ç”¨</a>ï¼š</p><p><img src="/assets/20200915-blog/img6.webp" alt="image-20200911172630511"></p><p>åº”ç”¨åˆ›å»ºå¥½ä»¥åï¼Œè¿›å…¥åˆšåˆšåˆ›å»ºçš„åº”ç”¨ï¼Œé€‰æ‹©å·¦ä¸‹è§’çš„<code>è®¾ç½®</code>&gt;<code>åº”ç”¨Key</code>ï¼Œç„¶åå°±èƒ½çœ‹åˆ°ä½ çš„<code>APP ID</code>å’Œ<code>APP Key</code>äº†ï¼š</p><p><img src="/assets/20200915-blog/img7.webp" alt="image-20200911172630511"></p><p>æ·»åŠ é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">valine:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">app_id:</span> <span class="string">0AQiakktufEkOkBGRTG7OMOA-xxx</span></span><br><span class="line">  <span class="attr">app_key:</span> <span class="string">K7A8Rj80r3C59gYyLjJ9Bxxx</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="literal">false</span> <span class="comment">#é‚®ä»¶æé†’è®¾ç½®</span></span><br><span class="line">  <span class="attr">verify:</span> <span class="literal">false</span> <span class="comment">#éªŒè¯ç è®¾ç½®</span></span><br><span class="line">  <span class="attr">placeholder:</span> <span class="string">ãƒ¾ï¾‰â‰§âˆ€â‰¦)oå¿«æ¥è¯„è®ºä¸€ä¸‹å§!</span> <span class="comment">#placeholder</span></span><br><span class="line">  <span class="attr">avatar:</span> <span class="comment">#å¤´åƒè®¾ç½®</span></span><br><span class="line">  <span class="attr">pageSize:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">visitor:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>ç„¶åè¿›å…¥ä¸»é¢˜çš„ layout=&gt;_partial=&gt;comments.ejsï¼ŒåŠ å…¥ä»¥ä¸‹ä»£ç ï¼Œä½¿å…¶æ”¯æŒè¯„è®ºç³»ç»Ÿ</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%if</span> (<span class="attr">theme.valine.app_id</span> &amp;&amp; <span class="attr">theme.valine.app_key</span>) &#123;%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//cdn1.lncld.net/static/js/3.0.4/av-min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//unpkg.com/valine/dist/Valine.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;script src=&quot;//cdn.jsdelivr.net/npm/leancloud-storage@latest/dist/av-min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="comment">&lt;script src=&#x27;//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js&#x27;&gt;&lt;/script&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;vcomments&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> notify = &lt;%= theme.valine.notify %&gt; == <span class="literal">true</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> verify = &lt;%= theme.valine.verify %&gt; == <span class="literal">true</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> visitor = &lt;%= theme.valine.visitor %&gt; == <span class="literal">true</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">new</span> Valine(&#123;</span></span><br><span class="line"><span class="javascript">    el: <span class="string">&#x27;#vcomments&#x27;</span>,</span></span><br><span class="line">              notify: notify,</span><br><span class="line">              verify: verify,</span><br><span class="line"><span class="javascript">      app_id: <span class="string">&#x27;&lt;%= theme.valine.app_id %&gt;&#x27;</span>,</span></span><br><span class="line"><span class="javascript">    app_key: <span class="string">&#x27;&lt;%= theme.valine.app_key %&gt;&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          lang: <span class="string">&#x27;en&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          placeholder: <span class="string">&#x27;&lt;%= theme.valine.placeholder %&gt;&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          avatar: <span class="string">&#x27;&lt;%= theme.valine.avatar %&gt;&#x27;</span>,</span></span><br><span class="line"><span class="handlebars"><span class="xml">          pageSize: <span class="tag">&lt;<span class="name">%=</span> <span class="attr">theme.valine.pageSize</span> %&gt;</span>,</span></span></span><br><span class="line">          visitor: visitor</span><br><span class="line">      &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span> &#125;%&gt;</span></span><br></pre></td></tr></table></figure><p>æ·»åŠ å®Œæœ€ç»ˆé•¿è¿™æ ·ï¼š</p><p><img src="/assets/20200915-blog/img8.webp" alt="image-20200911172630511"></p><p>æ·»åŠ <a href="https://github.com/wzpan/hexo-generator-search"><u><em>ç«™å†…æœç´¢</em></u></a>ä»¥åŠ<a href="https://github.com/hexojs/hexo-generator-feed"><u><em>RSS</em></u></a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-generator-search hexo-generator-feed --save</span><br></pre></td></tr></table></figure><p>åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­æ·»åŠ </p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">nav:</span></span><br><span class="line">  <span class="string">other</span> <span class="string">code</span></span><br><span class="line">  <span class="attr">RSS:</span> <span class="string">/atom.xml</span></span><br><span class="line">  <span class="attr">search:</span> <span class="string">/search/</span></span><br><span class="line"><span class="attr">rss:</span> <span class="string">/atom.xml</span></span><br></pre></td></tr></table></figure><p>åœ¨æ ¹é…ç½®ä¸­æ·»åŠ </p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">plugin:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">hexo-generator-feed</span></span><br><span class="line">  <span class="comment">#Feed Atom</span></span><br><span class="line"><span class="attr">feed:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">atom</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">atom.xml</span></span><br><span class="line">  <span class="attr">limit:</span> <span class="number">20</span></span><br></pre></td></tr></table></figure><p><img src="/assets/20200915-blog/img9.webp" alt="image-20200911172630511"></p><p>æ·»åŠ <a href="https://github.com/purplemysticx/hexo-pwa.git">PWA</a>æ”¯æŒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save hexo-pwa</span><br></pre></td></tr></table></figure><p>åœ¨æ ¹é…ç½®ä¸­æ·»åŠ </p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pwa:</span></span><br><span class="line">  <span class="attr">manifest:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/manifest.json</span> <span class="comment"># PWAé…ç½®æ–‡ä»¶</span></span><br><span class="line">    <span class="attr">body:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">è¾°æ€»çš„blog</span></span><br><span class="line">      <span class="attr">short_name:</span> <span class="string">è¾°æ€»çš„blog</span></span><br><span class="line">      <span class="attr">icons:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">src:</span> <span class="string">/assets/avatar.jpeg</span> <span class="comment"># å¤´åƒåœ°å€</span></span><br><span class="line">          <span class="attr">sizes:</span> <span class="string">192x192</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">image/png</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">src:</span> <span class="string">/assets/avatar.jpeg</span></span><br><span class="line">          <span class="attr">sizes:</span> <span class="string">512x512</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">image/png</span></span><br><span class="line">      <span class="attr">start_url:</span> <span class="string">/index.html</span> <span class="comment"># å¯åŠ¨é¡µé¢</span></span><br><span class="line">      <span class="attr">theme_color:</span> <span class="string">&quot;#000000&quot;</span></span><br><span class="line">      <span class="attr">background_color:</span> <span class="string">&quot;#000000&quot;</span> <span class="comment"># æ·»åŠ åˆ°æœ¬åœ°åèƒŒæ™¯é¢œè‰²</span></span><br><span class="line">      <span class="attr">display:</span> <span class="string">standalone</span></span><br><span class="line">  <span class="attr">serviceWorker:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/sw.js</span> <span class="comment"># serviceWorkeråœ°å€</span></span><br><span class="line">    <span class="attr">preload:</span></span><br><span class="line">      <span class="attr">urls:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/</span></span><br><span class="line">      <span class="attr">posts:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">opts:</span></span><br><span class="line">      <span class="attr">networkTimeoutSeconds:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">pattern:</span> <span class="type">!!js/regexp</span> <span class="string">/hm.baidu.com/</span></span><br><span class="line">        <span class="attr">strategy:</span> <span class="string">networkOnly</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">pattern:</span> <span class="type">!!js/regexp</span> <span class="string">/.*\.(js|css|jpg|jpeg|png|gif)$/</span></span><br><span class="line">        <span class="attr">strategy:</span> <span class="string">cacheFirst</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">pattern:</span> <span class="type">!!js/regexp</span> <span class="string">/\//</span></span><br><span class="line">        <span class="attr">strategy:</span> <span class="string">networkFirst</span></span><br><span class="line">  <span class="attr">priority:</span> <span class="number">5</span></span><br></pre></td></tr></table></figure><p>æœ€ç»ˆå±•ç°ä¸º<br><img src="/assets/20200915-blog/img10.webp" alt="image-20200911172630511"></p><h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><h3 id="guthub-page"><a href="#guthub-page" class="headerlink" title="guthub page"></a>guthub page</h3><p>åœ¨æ ¹é…ç½®ä¸­ä¿®æ”¹éƒ¨ç½²åœ°å€ä¿¡æ¯</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/one-command-deployment</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">&quot;git&quot;</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">&quot;https://github.com/YOMXXX/YOMXXX.github.io&quot;</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm run clean &amp;&amp; npm run build &amp;&amp; npm run deploy</span><br></pre></td></tr></table></figure><p>ç¨ç­‰å‡ åˆ†é’Ÿï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°éƒ¨ç½²æˆåŠŸäº†</p><p><img src="/assets/20200915-blog/img15.png" alt="image-20200911172630511"></p><p>ç„¶åç›´æ¥è®¿é—®çº¿ä¸Šåœ°å€ï¼š<a href="https://github.com/YOMXXX/YOMXXX.github.io">https://github.com/YOMXXX/YOMXXX.github.io</a></p><h3 id="è…¾è®¯äº‘-Serverless-Frameworkï¼ˆhttps-console-cloud-tencent-com-slsï¼‰"><a href="#è…¾è®¯äº‘-Serverless-Frameworkï¼ˆhttps-console-cloud-tencent-com-slsï¼‰" class="headerlink" title="è…¾è®¯äº‘ Serverless Frameworkï¼ˆhttps://console.cloud.tencent.com/slsï¼‰"></a>è…¾è®¯äº‘ Serverless Frameworkï¼ˆ<a href="https://console.cloud.tencent.com/sls%EF%BC%89">https://console.cloud.tencent.com/slsï¼‰</a></h3><blockquote><p>Serverless Framework æ˜¯ä¸šç•Œéå¸¸å—æ¬¢è¿çš„æ— æœåŠ¡å™¨åº”ç”¨æ¡†æ¶ï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒåº•å±‚èµ„æºå³å¯éƒ¨ç½²å®Œæ•´å¯ç”¨çš„ Serverless åº”ç”¨æ¶æ„ã€‚Serverless Framework å…·æœ‰èµ„æºç¼–æ’ã€è‡ªåŠ¨ä¼¸ç¼©ã€äº‹ä»¶é©±åŠ¨ç­‰èƒ½åŠ›ï¼Œè¦†ç›–ç¼–ç ã€è°ƒè¯•ã€æµ‹è¯•ã€éƒ¨ç½²ç­‰å…¨ç”Ÿå‘½å‘¨æœŸï¼Œå¸®åŠ©å¼€å‘è€…é€šè¿‡è”åŠ¨äº‘èµ„æºï¼Œè¿…é€Ÿæ„å»º Serverless åº”ç”¨ã€‚</p></blockquote><p><a href="https://cloud.tencent.com/document/product/1154">æ–‡æ¡£åœ°å€</a></p><p>é¦–å…ˆå¼€é€šæœåŠ¡ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªé¡¹ç›®=&gt;é€‰æ‹©å¿«é€Ÿéƒ¨ç½²ä¸€ä¸ª Vue é¡¹ç›®ï¼›</p><p><img src="/assets/20200915-blog/img11.png" alt="image-20200911172630511"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…</span></span><br><span class="line">$ npm install -g serverless</span><br><span class="line">$ serverless init vue-starter --name my-vue.js-app</span><br><span class="line"><span class="comment"># éƒ¨ç½²</span></span><br><span class="line">$ <span class="built_in">cd</span> my-vue.js-app &amp;&amp; serverless deploy</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆ›å»ºå®ŒæˆåæŠŠé¡¹ç›®ä¸­çš„è¿™ä¸¤ä¸ªæ–‡ä»¶ç²˜è´´åˆ°åšå®¢é¡¹ç›®çš„æ ¹ç›®å½•ä¸­</p><p><img src="/assets/20200915-blog/img13.png" alt="image-20200911172630511"></p><p>serverless.yml æ˜¯éƒ¨ç½²åˆ°è…¾è®¯äº‘çš„é…ç½®æ–‡ä»¶</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Blog</span></span><br><span class="line"><span class="attr">component:</span> <span class="string">website</span></span><br><span class="line"><span class="attr">org:</span> <span class="string">&quot;Tencent Cloud, Inc.&quot;</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">&quot;è¾°æ€»&quot;</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">ä¸ªäººåšå®¢ï¼ŒæŠ€æœ¯æ–‡ç« ï¼Œç”Ÿæ´»éšç¬”ï¼Œè®°å½•ä¼˜ç§€çš„æ–‡ç« </span></span><br><span class="line"><span class="attr">keywords:</span> <span class="string">&quot;ä¸ªäººåšå®¢ï¼ŒæŠ€æœ¯æ–‡ç« ï¼Œç”Ÿæ´»éšç¬”ï¼Œè®°å½•ä¼˜ç§€çš„æ–‡ç« &quot;</span></span><br><span class="line"><span class="attr">repo:</span> <span class="string">&quot;https://github.com/serverless-components/tencent-vue-starter&quot;</span></span><br><span class="line"><span class="attr">readme:</span> <span class="string">&quot;https://github.com/serverless-components/tencent-vue-starter/master/README.md&quot;</span></span><br><span class="line"><span class="attr">license:</span> <span class="string">MIT</span></span><br><span class="line"><span class="attr">stage:</span> <span class="string">pro</span> <span class="comment"># (å¯é€‰) ç”¨äºåŒºåˆ†ç¯å¢ƒä¿¡æ¯ï¼Œé»˜è®¤å€¼æ˜¯ dev</span></span><br><span class="line"><span class="attr">inputs:</span></span><br><span class="line">  <span class="attr">src:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">./</span> <span class="comment"># æ‰“åŒ…çš„æ ¹è·¯å¾„</span></span><br><span class="line">    <span class="attr">hook:</span> <span class="string">sudo</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">clean</span> <span class="string">&amp;&amp;</span> <span class="string">sudo</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">build</span> <span class="string">&amp;&amp;</span> <span class="string">sudo</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">deploy</span> <span class="comment"># æ‰“åŒ…å‰æ‰§è¡Œçš„é’©å­script</span></span><br><span class="line">    <span class="attr">dist:</span> <span class="string">./public</span> <span class="comment"># æ‰“åŒ…çš„ç›®å½•</span></span><br><span class="line"><span class="attr">src:</span></span><br><span class="line">  <span class="attr">src:</span> <span class="string">./</span></span><br><span class="line">  <span class="attr">exclude:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">.env</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">.git/**</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;**/node_modules&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;**/package-lock.json&quot;</span></span><br><span class="line"><span class="attr">app:</span> <span class="string">è¾°æ€»çš„Blog</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œ serverless deploy ç¨ç­‰å‡ åˆ†é’Ÿæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸Šä¼ æˆåŠŸäº†</p><p><img src="/assets/20200915-blog/img14.png" alt="image-20200911172630511"></p>]]></content>
      
      
      <categories>
          
          <category> åšå®¢ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> serverless </tag>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»0åˆ°1æ­å»ºèˆ’é€‚çš„dockerå‰ç«¯å¼€å‘ç¯å¢ƒ</title>
      <link href="/2020/11/20/20201120-docker-web/"/>
      <url>/2020/11/20/20201120-docker-web/</url>
      
        <content type="html"><![CDATA[<h2 id="ç›®çš„"><a href="#ç›®çš„" class="headerlink" title="ç›®çš„"></a>ç›®çš„</h2><p>æœ¬æ–‡æ„åœ¨ä½¿ç”¨ docker å¸®åŠ©å‰ç«¯åŒå­¦æ­å»º<code>ç»Ÿä¸€çš„å‰ç«¯å¼€å‘ç¯å¢ƒ</code>â€”è§£å†³å› ä¸ºä¸åŒçš„å¼€å‘ç¯å¢ƒï¼ˆmacã€windowsã€linuxï¼‰å¯¼è‡´çš„å„ç§ä¾èµ–ç›¸å…³æˆ–è€…è¿è¡Œä¸­ä¸¢å¤±æŸäº›æ–‡ä»¶çš„é—®é¢˜ï¼›</p><h2 id="æŠ€æœ¯æ ˆ"><a href="#æŠ€æœ¯æ ˆ" class="headerlink" title="æŠ€æœ¯æ ˆ"></a>æŠ€æœ¯æ ˆ</h2><p>docker docker-compose node nginx ä»¥åŠå‰ç«¯çš„é¡¹ç›®ï¼ˆvue é¡¹ç›®ï¼‰</p><h2 id="èµ·æ­¥"><a href="#èµ·æ­¥" class="headerlink" title="èµ·æ­¥"></a>èµ·æ­¥</h2><blockquote><p>é¦–å…ˆå…¨å±€å®‰è£…<a href="https://www.docker.com/get-started">docker å®¢æˆ·ç«¯</a>ä»¥ mac ç³»ç»Ÿä¸ºä¾‹ï¼›</p></blockquote><p>çœ‹åˆ°è¿™ä¸ªå°±ä»£è¡¨å®‰è£…æˆåŠŸäº†</p><p><img src="/assets/20201120-docker/img1.png"></p><p><img src="/assets/20201120-docker/img2.png"></p><p>æ‰“å¼€ docker è®¾ç½®æ‰¾åˆ° docker engine é…ç½®ä¸€ä¸‹å›½å†…ä»£ç†åŠ é€Ÿ</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;features&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;buildkit&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;experimental&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span>, <span class="string">&quot;https://hub-mirror.c.163.com&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/assets/20201120-docker/img3.jpg"></p><p>å®‰è£… vscode çš„ Docker æ’ä»¶-ç”¨äºå¸®åŠ©æˆ‘ä»¬ç®¡ç†æˆ‘ä»¬çš„ docker é•œåƒä»¥åŠå®¹å™¨ç­‰ï¼›</p><p><img src="/assets/20201120-docker/img11.png"></p><p>ä¸‹é¢åˆå§‹åŒ–ä¸€ä¸ª vue é¡¹ç›®ä½œä¸º demoï¼ˆvue-cliï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue create vue-docker</span><br></pre></td></tr></table></figure><h2 id="å¼€å‘"><a href="#å¼€å‘" class="headerlink" title="å¼€å‘"></a>å¼€å‘</h2><p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸º Dockerfile çš„æ–‡ä»¶ï¼Œç”¨äº docker ç›¸å…³çš„é…ç½®ï¼›</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è®¾ç½®æ„å»ºçš„åŸºç¡€é•œåƒ</span></span><br><span class="line"><span class="keyword">FROM</span> node</span><br><span class="line"><span class="comment">#åˆ›å»ºä¸€ä¸ªåä¸ºvue-dockerçš„æ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash">  mkdir -p  /vue-docker</span></span><br><span class="line"><span class="comment">#è¿›å…¥åˆ°è¿™ä¸ªç›®å½•ä¸­ï¼ˆå½“æˆ‘ä»¬æ‰“å¼€é•œåƒç»ˆç«¯çš„æ—¶å€™ä¼šè‡ªåŠ¨è¿›å…¥è¿™ä¸ªç›®å½•ä¸­å»ï¼‰</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /vue-docker</span></span><br><span class="line"><span class="comment">#æ‹·è´å½“å‰ç›®å½•ä¸‹æ‰€æœ‰ä¸œè¥¿åˆ°vue-dockerç›®å½•ä¸­</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . .</span></span><br><span class="line"><span class="comment">#è®¾ç½®npmä¸‹è½½ä¾èµ–æ¥æºä¸ºæ·˜å®æº</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org</span></span><br><span class="line"><span class="comment">#å®‰è£…é¡¹ç›®ä¾èµ–</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm i</span></span><br><span class="line"><span class="comment">#åœ¨å¯åŠ¨é•œåƒæ—¶æ‰§è¡Œå¯åŠ¨é¡¹ç›®çš„å‘½ä»¤</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> npm run serve</span></span><br><span class="line"><span class="comment">#æš´éœ²ç«¯å£ç”¨äºå¤–éƒ¨è®¿é—®</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨æ ¹ç›®å½•ä¸­æ‰§è¡Œæ„å»ºå‘½ä»¤<br>-t: è®¾ç½®å®¹å™¨çš„åç§°<br>.:æ˜¯æ‰“åŒ…å½“å‰ç›®å½•æ‰€æœ‰ä¸œè¥¿ï¼ˆä¸åŒ…æ‹¬.dockerignore ä¸­çš„æ–‡ä»¶ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t vue-docker .</span><br></pre></td></tr></table></figure><p>æ„å»ºè¿‡ç¨‹é•¿è¿™æ ·<br><img src="/assets/20201120-docker/img4.jpg"></p><p>æ„å»ºå®Œæˆåæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹æ„å»ºåçš„é•œåƒåˆ—è¡¨<br><img src="/assets/20201120-docker/img5.jpg"></p><p>ç„¶åæˆ‘ä»¬æ‰§è¡Œ run å‘½ä»¤å»å¯åŠ¨ä¸€ä¸ªå®¹å™¨<br>-d: åå°è¿è¡Œ<br>-p: æ˜ å°„å®¹å™¨å†…çš„ 8080 ç«¯å£åˆ°ä¸»æœºçš„ 8080 ç«¯å£<br>-i: äº¤äº’å¼æ“ä½œ<br>-t: ç»ˆç«¯<br>-v: æ–‡ä»¶æ˜ å°„ï¼Œå°†ä¸»æœºæœ¬åœ°çš„æ–‡ä»¶æ˜ å°„åˆ°å®¹å™¨ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬æœ¬åœ°ä¿®æ”¹æ–‡ä»¶å†…å®¹ï¼Œå¯ä»¥åŠ¨æ€çœ‹åˆ°é¡µé¢çš„å˜åŒ–äº†<br>vue-docker: è¿™æ˜¯æŒ‡ç”¨ vue-docker é•œåƒä¸ºåŸºç¡€æ¥å¯åŠ¨å®¹å™¨<br>/bin/bashï¼šæ”¾åœ¨é•œåƒååçš„æ˜¯å‘½ä»¤ï¼Œè¿™é‡Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸ªäº¤äº’å¼ Shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8080:8080 -v /src:/vue-docker/src vue-docker</span><br><span class="line"><span class="comment"># è¿›å…¥å‘½ä»¤è¡Œ</span></span><br><span class="line">docker run -it vue-docker /bin/bash</span><br></pre></td></tr></table></figure><p>ç„¶åçœ‹åˆ° af28efc278be5ae44f83511522cfb375a6f6811b573c33565c22ab087b415d90 è¿™ä¸ªè¯´æ˜å®¹å™¨å·²ç»å¯åŠ¨äº†</p><p><img src="/assets/20201120-docker/img6.jpg"></p><p>æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨è®¿é—®<code>http://localhost:8080</code>ï¼Œå°±èƒ½çœ‹åˆ°é¡µé¢å†…å®¹äº†ï¼Œæœ¬åœ°ä»£ç æ›´æ”¹ï¼Œé¡µé¢ä¹Ÿä¼šéšä¹‹æ”¹å˜</p><p><img src="/assets/20201120-docker/img7.jpg"></p><h3 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h3><p>ç›®å‰ä»…ä»…æ˜¯å¯åŠ¨äº†ä¸€ä¸ª vue çš„æœåŠ¡ï¼Œæˆ‘ä»¬å¦‚æœæƒ³ä½¿ç”¨å…¶ä»–æœåŠ¡æ€ä¹ˆå‘¢ï¼Ÿæ¯”å¦‚æˆ‘ä»¬æƒ³ä½¿ç”¨ node åšä¸­é—´å±‚ï¼Œä½¿ç”¨ nginx è½¬å‘çš„ä»£ç†æ€ä¹ˆåŠå‘¢ï¼ˆå½“ç„¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ webpackâ€”proxy å»åšä»£ç†ï¼‰ï¼Ÿ</p><p>æœ‰çš„åŒå­¦å¯èƒ½ä¼šè¿™æ ·å†™</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> nginx</span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> nginx.conf /home/work/app/nginx/conf/nginx.conf</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> /home/work/app/nginx/sbin/nginx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> node</span><br><span class="line"><span class="keyword">RUN</span><span class="bash">  mkdir -p  /vue-docker</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /vue-docker</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . .</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm i</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> npm run serve</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ä¸€ä¸ª Dockerfile æ–‡ä»¶ä¸­å¹¶ä¸ä¼šæŠŠä¸¤ä¸ª from ä¸€èµ·æ„å»ºï¼Œæœ€ç»ˆæ„å»ºçš„è¿˜æ˜¯å¸¦æœ‰ node ç¯å¢ƒçš„é•œåƒ;</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜æˆ‘ä»¬éœ€è¦å¼•å…¥ docker-composeï¼Œå»ä¸€èµ·æ„å»ºæˆ‘ä»¬æ‰€éœ€ç¯å¢ƒçš„ä¾èµ–çš„é•œåƒï¼›</p><p>å®‰è£…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L https:&#x2F;&#x2F;github.com&#x2F;docker&#x2F;compose&#x2F;releases&#x2F;download&#x2F;1.16.1&#x2F;docker-compose-&#96;uname -s&#96;-&#96;uname -m&#96; -o &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™ä¸ªè¯´æ˜å®‰è£…æˆåŠŸäº†</p><p><img src="/assets/20201120-docker/img8.png"></p><p>ç„¶åæˆ‘ä»¬éœ€è¦ç¼–å†™ docker-compose çš„é…ç½®æ–‡ä»¶äº†ï¼Œåœ¨é¡¹ç›®è·Ÿç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸º docker-compose.yml çš„æ–‡ä»¶</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span> <span class="comment"># æŒ‡å®šç‰ˆæœ¬(ä¸åŒçš„ç‰ˆæœ¬å­˜åœ¨è¯­æ³•å·®å¼‚ï¼Œè¿™è¾¹ä½¿ç”¨æœ€æ–°çš„ç‰ˆæœ¬)</span></span><br><span class="line"><span class="attr">services:</span> <span class="comment"># æœåŠ¡åç§°</span></span><br><span class="line">  <span class="attr">nginx:</span> <span class="comment"># ç”¨æˆ·è‡ªå®šä¹‰çš„æœåŠ¡åç§°</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span> <span class="comment"># ä½¿ç”¨çš„nginxæœ€æ–°çš„é•œåƒ</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/default.conf:/etc/nginx/conf.d/default.conf</span> <span class="comment"># æ‹·è´default.confç›®å½•åˆ°å®¹å™¨é‡Œçš„</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;80:80&quot;</span> <span class="comment"># æš´éœ²ç«¯å£ç”¨äºå¤–éƒ¨è®¿é—®</span></span><br><span class="line">  <span class="attr">vue:</span> <span class="comment"># ç”¨æˆ·è‡ªå®šä¹‰çš„æœåŠ¡åç§°</span></span><br><span class="line">    <span class="attr">build:</span> <span class="comment"># æ„å»ºç›¸å…³çš„é…ç½® ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨image:xxxå»æ„å»º</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">.</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">vue</span> <span class="comment"># ä½¿ç”¨dockerfileé…ç½®çš„æ–‡ä»¶å</span></span><br><span class="line">    <span class="attr">working_dir:</span> <span class="string">/vue-docker</span> <span class="comment"># è¿›å…¥å·¥ä½œçš„ç›®å½•ä¸­</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">serve</span> <span class="comment"># åœ¨å¯åŠ¨é•œåƒæ—¶æ‰§è¡Œå¯åŠ¨é¡¹ç›®çš„å‘½ä»¤</span></span><br><span class="line">    <span class="attr">volumes:</span> <span class="comment"># æŒ‡å®šæ˜ å°„çš„è·¯å¾„ï¼ˆå¯æŒ‡å®šå¤šä¸ªï¼‰</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./x&#x27;x&#x27;x:/xxx</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/src:/vue-docker/src</span></span><br><span class="line">    <span class="attr">ports:</span> <span class="comment"># æš´éœ²ç«¯å£ç”¨äºå¤–éƒ¨è®¿é—®ï¼ˆå¯æŒ‡å®šå¤šä¸ªï¼‰</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8080</span><span class="string">:8080</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8081</span><span class="string">:8081</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥åœ¨é¡¹ç›®è·Ÿç›®å½•ä¸­åˆ›å»º default.confï¼Œç”¨äº nginx ç›¸å…³çš„é…ç½®ï¼›</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server</span> <span class="string">&#123;</span></span><br><span class="line">    <span class="attr">listen</span>       <span class="string">80;</span></span><br><span class="line">    <span class="attr">server_name</span>  <span class="string">localhost;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">location</span> <span class="string">/ &#123;</span></span><br><span class="line">       <span class="attr">proxy_pass</span> <span class="string">http://vuedocker:8080; # è¿™é‡Œçš„vueDockerå°±æ˜¯docker-composeä¸­è‡ªå®šä¹‰çš„serviceså</span></span><br><span class="line">    <span class="attr">&#125;</span></span><br><span class="line">    <span class="attr">error_page</span>   <span class="string">500 502 503 504  /50x.html;</span></span><br><span class="line">    <span class="attr">location</span> = <span class="string">/50x.html &#123;</span></span><br><span class="line">        <span class="attr">root</span>   <span class="string">/usr/share/nginx/html;</span></span><br><span class="line">    <span class="attr">&#125;</span></span><br><span class="line"><span class="attr">&#125;</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥åœ¨é¡¹ç›®è·Ÿç›®å½•ä¸­åˆ›å»º vue æ–‡ä»¶ï¼Œç”¨äº Dockerfile ç›¸å…³çš„é…ç½®ï¼›</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è®¾ç½®æ„å»ºçš„åŸºç¡€é•œåƒ</span></span><br><span class="line"><span class="keyword">FROM</span> node</span><br><span class="line"><span class="comment">#åˆ›å»ºä¸€ä¸ªåä¸ºvue-dockerçš„æ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash">  mkdir -p  /vue-docker</span></span><br><span class="line"><span class="comment">#è¿›å…¥åˆ°è¿™ä¸ªç›®å½•ä¸­ï¼ˆå½“æˆ‘ä»¬æ‰“å¼€é•œåƒç»ˆç«¯çš„æ—¶å€™ä¼šè‡ªåŠ¨è¿›å…¥è¿™ä¸ªç›®å½•ä¸­å»ï¼‰</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /vue-docker</span></span><br><span class="line"><span class="comment">#æ‹·è´å½“å‰ç›®å½•ä¸‹æ‰€æœ‰ä¸œè¥¿åˆ°vue-dockerç›®å½•ä¸­</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . .</span></span><br><span class="line"><span class="comment">#è®¾ç½®npmä¸‹è½½ä¾èµ–æ¥æºä¸ºæ·˜å®æº</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org</span></span><br><span class="line"><span class="comment">#å®‰è£…é¡¹ç›®ä¾èµ–</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm i</span></span><br><span class="line"><span class="comment">#åœ¨å¯åŠ¨é•œåƒæ—¶æ‰§è¡Œå¯åŠ¨é¡¹ç›®çš„å‘½ä»¤</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> npm run serve</span></span><br><span class="line"><span class="comment">#æš´éœ²ç«¯å£ç”¨äºå¤–éƒ¨è®¿é—®</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure><p>ç„¶å vue.config.js ä¸­æ·»åŠ  disableHostCheckï¼Œä¸å»æ£€æµ‹åŸŸåï¼›</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    disableHostCheck: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ¥ç€æ‰§è¡Œ docker-compose -d up æŒ‡ä»¤å¯åŠ¨ docker-compose æ„å»º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -d: åå°æ‰§è¡Œ</span></span><br><span class="line">docker-compose -d up</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>çœ‹åˆ°ç»¿è‰²çš„ç®­å¤´è¯´æ˜æˆ‘ä»¬çš„å®¹å™¨å…¨éƒ½å¯åŠ¨äº†ï¼Œç„¶åè®¿é—®<code>http://localhost</code> å°±å¯ä»¥çœ‹åˆ°é¡µé¢äº†</p><p><img src="/assets/20201120-docker/img10.png"></p><p><img src="/assets/20201120-docker/img9.png"></p><h1 id="ä¸‹æœŸä¸»é¢˜â€”Dockerfile-çš„å¤šé˜¶æ®µæ„å»º"><a href="#ä¸‹æœŸä¸»é¢˜â€”Dockerfile-çš„å¤šé˜¶æ®µæ„å»º" class="headerlink" title="ä¸‹æœŸä¸»é¢˜â€”Dockerfile çš„å¤šé˜¶æ®µæ„å»º"></a>ä¸‹æœŸä¸»é¢˜â€”Dockerfile çš„å¤šé˜¶æ®µæ„å»º</h1>]]></content>
      
      
      <categories>
          
          <category> åšå®¢ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å°ç¨‹åºäº‘å¼€å‘åŸºç¡€å®æˆ˜</title>
      <link href="/2020/09/11/20200911-yun/"/>
      <url>/2020/09/11/20200911-yun/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>éšç€ serverless è¶Šæ¥è¶Šç«ï¼ŒåŸºæœ¬å¤§å‚éƒ½ä½¿ç”¨äº‘å¼€å‘çš„æŠ€æœ¯ï¼Œä½¿è‡ªå·±çš„ä¸šåŠ¡æ‰˜ç®¡ä¸Šäº‘ï¼Œå¼€å‘è€…åˆ™å¤§å¤šæŠŠé‡å¿ƒå…³æ³¨åœ¨ä¸šåŠ¡çš„å¼€å‘ä¸Šï¼Œæ— éœ€å…³æ³¨æ‰©å®¹ç­‰æ“ä½œï¼Œä¸€åˆ‡äº¤ç»™äº‘æœåŠ¡å•†å³å¯ï¼Œå¤§å¤§å‡å°‘äº†å¼€å‘éƒ¨ç½²ç­‰æ“ä½œï¼Œè€Œå¯¹äºå°ç¨‹åºäº‘å¼€å‘ï¼Œå¼€å‘è€…å®Œå…¨å¯ä»¥ä½œä¸ºå…¨æ ˆå·¥ç¨‹å¸ˆå»å¼€å‘é¡¹ç›®ï¼ˆåŒ…æ‹¬å‰ç«¯ã€åç«¯ã€æ•°æ®åº“-mongodb ç­‰ï¼‰ï¼Œæ— éœ€æ­å»ºæœåŠ¡å™¨ï¼Œå³å¯ä½¿ç”¨äº‘ç«¯èƒ½åŠ›ï¼›äº‘å¼€å‘ä¸ºå¼€å‘è€…æä¾›å®Œæ•´çš„åŸç”Ÿäº‘ç«¯æ”¯æŒå’Œå¾®ä¿¡æœåŠ¡æ”¯æŒï¼Œå¼±åŒ–åç«¯å’Œè¿ç»´æ¦‚å¿µï¼Œæ— éœ€æ­å»ºæœåŠ¡å™¨ï¼Œä½¿ç”¨å¹³å°æä¾›çš„ API è¿›è¡Œæ ¸å¿ƒä¸šåŠ¡å¼€å‘ï¼Œå³å¯å®ç°å¿«é€Ÿä¸Šçº¿å’Œè¿­ä»£ï¼ŒåŒæ—¶è¿™ä¸€èƒ½åŠ›ï¼ŒåŒå¼€å‘è€…å·²ç»ä½¿ç”¨çš„äº‘æœåŠ¡ç›¸äº’å…¼å®¹ï¼Œå¹¶ä¸äº’æ–¥ï¼›</p><table><thead><tr><th align="center">èƒ½åŠ›</th><th align="center">ä½œç”¨</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">äº‘å‡½æ•°</td><td align="center">æ— éœ€è‡ªå»ºæœåŠ¡å™¨</td><td align="center">åœ¨äº‘ç«¯è¿è¡Œçš„ä»£ç ï¼Œå¾®ä¿¡ç§æœ‰åè®®å¤©ç„¶é‰´æƒï¼Œå¼€å‘è€…åªéœ€ç¼–å†™è‡ªèº«ä¸šåŠ¡é€»è¾‘ä»£ç </td></tr><tr><td align="center">æ•°æ®åº“</td><td align="center">æ— éœ€è‡ªå»ºæ•°æ®åº“</td><td align="center">ä¸€ä¸ªæ—¢å¯åœ¨å°ç¨‹åºå‰ç«¯æ“ä½œï¼Œä¹Ÿèƒ½åœ¨äº‘å‡½æ•°ä¸­è¯»å†™çš„ JSON æ•°æ®åº“</td></tr><tr><td align="center">å­˜å‚¨</td><td align="center">æ— éœ€è‡ªå»ºå­˜å‚¨å’Œ CDN</td><td align="center">åœ¨å°ç¨‹åºå‰ç«¯ç›´æ¥ä¸Šä¼ /ä¸‹è½½äº‘ç«¯æ–‡ä»¶ï¼Œåœ¨äº‘å¼€å‘æ§åˆ¶å°å¯è§†åŒ–ç®¡ç†</td></tr><tr><td align="center">äº‘è°ƒç”¨</td><td align="center">åŸç”Ÿå¾®ä¿¡æœåŠ¡é›†æˆ</td><td align="center">åŸºäºäº‘å‡½æ•°å…é‰´æƒä½¿ç”¨å°ç¨‹åºå¼€æ”¾æ¥å£çš„èƒ½åŠ›ï¼ŒåŒ…æ‹¬æœåŠ¡ç«¯è°ƒç”¨ã€è·å–å¼€æ”¾æ•°æ®ç­‰èƒ½åŠ›</td></tr></tbody></table><h2 id="1-æ–°å»ºäº‘å¼€å‘æ¨¡æ¿"><a href="#1-æ–°å»ºäº‘å¼€å‘æ¨¡æ¿" class="headerlink" title="1. æ–°å»ºäº‘å¼€å‘æ¨¡æ¿"></a>1. æ–°å»ºäº‘å¼€å‘æ¨¡æ¿</h2><blockquote><p>ä¹Ÿå¯ä»¥çœç•¥æ­¤æ­¥éª¤ï¼Œç›´æ¥åœ¨å·²æœ‰é¡¹ç›®ä¸Šå¼€é€šå’Œä½¿ç”¨äº‘å¼€å‘ã€‚</p></blockquote><p>æ–°å»ºé¡¹ç›®é€‰æ‹©ä¸€ä¸ªç©ºç›®å½•ï¼Œå¡«å…¥ AppIDï¼ˆä½¿ç”¨äº‘å¼€å‘èƒ½åŠ›å¿…é¡»å¡«å†™ AppIDï¼‰ï¼Œå‹¾é€‰åˆ›å»º â€œäº‘å¼€å‘ QuickStart é¡¹ç›®â€ï¼Œç‚¹å‡»åˆ›å»ºå³å¯å¾—åˆ°ä¸€ä¸ªå±•ç¤ºäº‘å¼€å‘åŸºç¡€èƒ½åŠ›çš„ç¤ºä¾‹å°ç¨‹åºã€‚è¯¥å°ç¨‹åºä¸æ™®é€š QuickStart å°ç¨‹åºæœ‰ä»¥ä¸‹ä¸åŒéœ€æ³¨æ„ï¼š</p><ul><li>æ— æ¸¸å®¢æ¨¡å¼ã€ä¹Ÿä¸å¯ä»¥ä½¿ç”¨ <a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/sandbox.html">æµ‹è¯•å·</a></li><li><code>project.config.json</code> ä¸­å¢åŠ äº†å­—æ®µ <code>cloudfunctionRoot</code> ç”¨äºæŒ‡å®šå­˜æ”¾äº‘å‡½æ•°çš„ç›®å½•</li><li><code>cloudfunctionRoot</code> æŒ‡å®šçš„ç›®å½•æœ‰ç‰¹æ®Šçš„å›¾æ ‡</li><li>äº‘å¼€å‘èƒ½åŠ›ä»åŸºç¡€åº“ <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html">2.2.3</a> å¼€å§‹æ”¯æŒï¼ˆè¦†ç›–ç‡ 97.3%ï¼ŒæŸ¥çœ‹<a href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference/compatibility.html">å…¼å®¹æ€§é—®é¢˜</a>ï¼‰</li></ul><p>ä»åŸºç¡€åº“ <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html">2.4.1</a> å¼€å§‹ï¼Œåœ¨å°ç¨‹åºæ’ä»¶ä¸­å¯ä»¥ä½¿ç”¨äº‘å¼€å‘ï¼Œæ’ä»¶ä¸­ä½¿ç”¨äº‘å¼€å‘æ—¶ï¼Œä½¿ç”¨çš„æ˜¯æ’ä»¶æ–¹çš„äº‘èµ„æºè€Œéå®¿ä¸»çš„äº‘èµ„æºï¼Œåœ¨ä½¿ç”¨æ–¹å¼ä¸Šä¸åœ¨å°ç¨‹åºä¸­ä½¿ç”¨æ— å¼‚ã€‚</p><h2 id="2-å¼€é€šäº‘å¼€å‘ã€åˆ›å»ºç¯å¢ƒ"><a href="#2-å¼€é€šäº‘å¼€å‘ã€åˆ›å»ºç¯å¢ƒ" class="headerlink" title="2. å¼€é€šäº‘å¼€å‘ã€åˆ›å»ºç¯å¢ƒ"></a>2. å¼€é€šäº‘å¼€å‘ã€åˆ›å»ºç¯å¢ƒ</h2><p>åˆ›å»ºäº†ç¬¬ä¸€ä¸ªäº‘å¼€å‘å°ç¨‹åºåï¼Œåœ¨ä½¿ç”¨äº‘å¼€å‘èƒ½åŠ›ä¹‹å‰éœ€è¦å…ˆå¼€é€šäº‘å¼€å‘ã€‚åœ¨å¼€å‘è€…å·¥å…·å·¥å…·æ å·¦ä¾§ï¼Œç‚¹å‡» â€œäº‘å¼€å‘â€ æŒ‰é’®å³å¯æ‰“å¼€äº‘æ§åˆ¶å°ã€æ ¹æ®æç¤ºå¼€é€šäº‘å¼€å‘ã€åˆ›å»ºäº‘ç¯å¢ƒã€‚é»˜è®¤é…é¢ä¸‹å¯ä»¥åˆ›å»ºä¸¤ä¸ªç¯å¢ƒï¼Œå„ä¸ªç¯å¢ƒç›¸äº’éš”ç¦»ï¼Œæ¯ä¸ªç¯å¢ƒéƒ½åŒ…å«ç‹¬ç«‹çš„æ•°æ®åº“å®ä¾‹ã€å­˜å‚¨ç©ºé—´ã€äº‘å‡½æ•°é…ç½®ç­‰èµ„æºã€‚æ¯ä¸ªç¯å¢ƒéƒ½æœ‰å”¯ä¸€çš„ç¯å¢ƒ ID æ ‡è¯†ï¼Œåˆå§‹åˆ›å»ºçš„ç¯å¢ƒè‡ªåŠ¨æˆä¸ºé»˜è®¤ç¯å¢ƒã€‚</p><blockquote><p>æ³¨ï¼šAppID é¦–æ¬¡å¼€é€šäº‘ç¯å¢ƒåï¼Œéœ€ç­‰å¾…å¤§çº¦ 10 åˆ†é’Ÿæ–¹å¯æ­£å¸¸ä½¿ç”¨äº‘ APIï¼Œåœ¨æ­¤æœŸé—´å®˜æ–¹åå°æœåŠ¡æ­£åœ¨åšå‡†å¤‡æœåŠ¡ï¼Œå¦‚å°è¯•åœ¨å°ç¨‹åºä¸­è°ƒç”¨äº‘ API åˆ™ä¼šæŠ¥ <code>cloud init errorï¼š&#123; errMsg: &quot;invalid scope&quot; &#125;</code> çš„é”™è¯¯</p></blockquote><p>å®Œæˆåæˆ‘ä»¬å°±èƒ½çœ‹åˆ°æ§åˆ¶å°ä¿¡æ¯äº†<br><img src="/assets/20200911-yun/img1.png" alt="image-20200911172630511"></p><p>æ¥ç€åœ¨ project.config.json æ–‡ä»¶ä¸­é…ç½®äº‘å‡½æ•°å­˜æ”¾çš„ä½ç½®</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attr">&quot;cloudfunctionRoot&quot;</span>: <span class="string">&quot;cloudfunctions/&quot;</span> &#125;</span><br></pre></td></tr></table></figure><p>é…ç½®å®Œåï¼Œåœ¨å¼€å‘è€…å·¥å…·ä¸­ä¼šå‡ºç°å½“å‰ç¯å¢ƒçš„æ ‡ç¤ºï¼Œè¿™æ ·å°±é…ç½®æˆåŠŸäº†ï¼›<br><img src="/assets/20200911-yun/img2.png" alt="image-20200911172630511"></p><p>ç„¶ååœ¨ app.js ä¸­é…ç½®äº‘å¼€å‘çš„åˆå§‹åŒ–æ–¹æ³•:å…¶ä¸­ env ä¸ºå½“å‰äº‘å¼€å‘çš„ç¯å¢ƒï¼Œä¸æŒ‡å®šçš„è¯åˆ™é»˜è®¤ä¸ºç¬¬ä¸€ä¸ªåˆ›å»ºçš„ç¯å¢ƒ</p><ul><li>æ³¨ï¼š æˆ‘ä»¬å¯ä»¥æ ¹æ®å°ç¨‹åºå¼€å‘ç¯å¢ƒçš„ä¸åŒï¼Œå»åŠ¨æ€æ˜ å°„äº‘å¼€å‘çš„ç¯å¢ƒï¼›</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//app.js</span></span><br><span class="line">App(&#123;</span><br><span class="line">  onLaunch: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!wx.cloud) &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(<span class="string">&quot;è¯·ä½¿ç”¨ 2.2.3 æˆ–ä»¥ä¸Šçš„åŸºç¡€åº“ä»¥ä½¿ç”¨äº‘èƒ½åŠ›&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      wx.cloud.init(&#123;</span><br><span class="line">        <span class="comment">// env å‚æ•°è¯´æ˜ï¼š</span></span><br><span class="line">        <span class="comment">//   env å‚æ•°å†³å®šæ¥ä¸‹æ¥å°ç¨‹åºå‘èµ·çš„äº‘å¼€å‘è°ƒç”¨ï¼ˆwx.cloud.xxxï¼‰ä¼šé»˜è®¤è¯·æ±‚åˆ°å“ªä¸ªäº‘ç¯å¢ƒçš„èµ„æº</span></span><br><span class="line">        <span class="comment">//   æ­¤å¤„è¯·å¡«å…¥ç¯å¢ƒ ID, ç¯å¢ƒ ID å¯æ‰“å¼€äº‘æ§åˆ¶å°æŸ¥çœ‹</span></span><br><span class="line">        <span class="comment">//   å¦‚ä¸å¡«åˆ™ä½¿ç”¨é»˜è®¤ç¯å¢ƒï¼ˆç¬¬ä¸€ä¸ªåˆ›å»ºçš„ç¯å¢ƒï¼‰</span></span><br><span class="line">        <span class="comment">// env: &#x27;my-env-id&#x27;,</span></span><br><span class="line">        traceUser: <span class="literal">true</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="3-ä½“éªŒäº‘å¼€å‘"><a href="#3-ä½“éªŒäº‘å¼€å‘" class="headerlink" title="3. ä½“éªŒäº‘å¼€å‘"></a>3. ä½“éªŒäº‘å¼€å‘</h2><h3 id="3-1-å¸¸é‡-DYNAMIC-CURRENT-ENV"><a href="#3-1-å¸¸é‡-DYNAMIC-CURRENT-ENV" class="headerlink" title="3.1 å¸¸é‡ DYNAMIC_CURRENT_ENV"></a>3.1 å¸¸é‡ DYNAMIC_CURRENT_ENV</h3><blockquote><p>æ”¯æŒç«¯ï¼šäº‘å‡½æ•° <a href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference/changelog-server-sdk.html">1.1.0</a></p></blockquote><p>æ ‡å¿—å½“å‰æ‰€åœ¨ç¯å¢ƒï¼Œæ³¨æ„è¯¥å€¼ä¸æ˜¯å½“å‰æ‰€åœ¨ç¯å¢ƒ ID çš„å­—ç¬¦ä¸²ï¼Œå…¶å€¼ç­‰ä»·äº <code>Symbol.for(&#39;DYNAMIC_CURRENT_ENV&#39;)</code>ï¼Œæ˜¯ç”¨äºæ ‡å¿—å½“å‰æ‰€åœ¨ç¯å¢ƒçš„ã€‚å¦‚åœ¨ <code>init</code> ä¸­å¦‚æœç»™ <code>env</code> å‚æ•°ä¼ è¯¥å¸¸é‡å€¼ï¼Œåˆ™åç»­çš„ API è¯·æ±‚ä¼šè‡ªåŠ¨è¯·æ±‚å½“å‰æ‰€åœ¨ç¯å¢ƒçš„äº‘èµ„æºï¼Œå¦‚äº‘å‡½æ•° A å½“å‰æ‰€åœ¨ç¯å¢ƒæ˜¯ <code>test-123</code>ï¼Œåˆ™å…¶æ¥ä¸‹æ¥è¯·æ±‚æ•°æ®åº“ã€æ–‡ä»¶å­˜å‚¨ã€äº‘å‡½æ•°æ—¶éƒ½é»˜è®¤è¯·æ±‚ç¯å¢ƒ <code>test-123</code> çš„æ•°æ®åº“ã€æ–‡ä»¶å­˜å‚¨ã€äº‘å‡½æ•°ã€‚</p><p>å¸¸é‡å¯ç”¨äºï¼š</p><ul><li><code>cloud.init</code> çš„ <code>env</code> å‚æ•°</li><li><code>cloud.updateConfig</code> çš„ <code>env</code> å‚æ•°</li><li>å„ API çš„ <code>config</code> å‚æ•°ä¸­çš„ <code>env</code> å‚æ•°</li></ul><p>æ³¨æ„äº‹é¡¹ï¼š</p><ul><li><p>è‡ª <code>1.7.1</code> èµ·ï¼Œè¯¥å˜é‡æ”¯æŒåœ¨å®šæ—¶è§¦å‘å™¨ä¸­ä½¿ç”¨ï¼Œä¹‹å‰çš„ç‰ˆæœ¬ä¸æ”¯æŒã€‚<br><strong>cloud.database: è®¾ç½®æ–°æ•°æ®åº“å¯¹è±¡çš„è°ƒç”¨ç¯å¢ƒç­‰äºå½“å‰æ‰€åœ¨ç¯å¢ƒ</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cloud.init(&#123;</span><br><span class="line">  env: <span class="string">&quot;xxx&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸åŒäº init æ—¶è®¾ç½®çš„ç¯å¢ƒï¼Œdb å¯¹è±¡çš„è¯·æ±‚å°†ä¼šå»åˆ°å’Œå½“å‰äº‘å‡½æ•°æ‰€åœ¨ç¯å¢ƒç›¸åŒçš„ç¯å¢ƒ</span></span><br><span class="line"><span class="keyword">const</span> db = cloud.database(&#123;</span><br><span class="line">  env: cloud.DYNAMIC_CURRENT_ENV,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-2-äº‘æ•°æ®åº“"><a href="#3-2-äº‘æ•°æ®åº“" class="headerlink" title="3.2 äº‘æ•°æ®åº“"></a>3.2 äº‘æ•°æ®åº“</h3><p>äº‘æ•°æ®åº“åº•å±‚ä½¿ç”¨çš„æ˜¯ mongodbï¼Œå¯¹äºå‰ç«¯åŒå­¦ä¹Ÿä¸æ˜¯å¾ˆé™Œç”Ÿï¼›å°ç¨‹åºè°ƒç”¨æ•°æ®åº“æ¯”è¾ƒæ–¹ä¾¿ï¼Œå¯ä»¥ç›´æ¥åœ¨å°ç¨‹åº js æ–‡ä»¶ä¸­è°ƒç”¨ï¼ˆä¸åƒ uni-app ä¸­ï¼Œä¸€å®šè¦åœ¨äº‘å‡½æ•°ä¸­æ‰èƒ½ä½¿ç”¨ï¼Œæ¯”è¾ƒæ¶å¿ƒï¼ï¼‰ï¼›<br>é¦–å…ˆæŒ‰ç…§ä¸‹å›¾å…ˆåˆ›å»ºä¸€ä¸ªé›†åˆï¼Œä½œä¸ºæµ‹è¯•æˆ‘å·²ç»åˆ›å»ºäº†ä¸€ä¸ªåä¸º test çš„é›†åˆ<br><img src="/assets/20200911-yun/img3.png" alt="image-20200911172630511"></p><p>ä¸‹é¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬ onload å›è°ƒä¸­æˆ‘ä»¬å‘åˆšåˆšåˆ›å»ºçš„ test é›†åˆä¸­æ·»åŠ äº†ä¸€ä¸ªæ•°æ®</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">onLoad: <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> db =  wx.cloud.database()</span><br><span class="line">  <span class="keyword">await</span> db.collection(<span class="string">&#x27;test&#x27;</span>).add(&#123;</span><br><span class="line">      data: &#123;</span><br><span class="line">        a: <span class="number">1</span></span><br><span class="line">      &#125;,</span><br><span class="line">      config: &#123;</span><br><span class="line">        env: <span class="string">&#x27;test-123&#x27;</span> <span class="comment">// ç¯å¢ƒ IDï¼ŒæŒ‡å®šä½¿ç”¨å“ªä¸ªç¯å¢ƒä¸‹çš„å¯¹åº”çš„äº‘å‡½æ•°ï¼Œå¡«å†™åå°†å¿½ç•¥ init æ—¶æŒ‡å®šçš„ç¯å¢ƒ IDï¼Œè¿™é‡Œå°†è®¿é—®test-123äº‘ç©ºé—´çš„testé›†åˆï¼Œç„¶åæ·»åŠ ä¸€æ¡æ•°æ®</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éšåæˆ‘ä»¬åˆ·æ–°æ§åˆ¶å°å°±èƒ½çœ‹åˆ°åˆšåˆšæ·»åŠ çš„æ•°æ®å•¦<br><img src="/assets/20200911-yun/img4.png" alt="image-20200911172630511"></p><p>å…¶ä»–å¸¸ç”¨çš„æ–¹æ³•ï¼Œè§<a href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/Cloud.database.html">å®˜æ–¹æ–‡æ¡£</a></p><h3 id="3-2-äº‘å‡½æ•°"><a href="#3-2-äº‘å‡½æ•°" class="headerlink" title="3.2 äº‘å‡½æ•°"></a>3.2 äº‘å‡½æ•°</h3><p>åœ¨äº‘å‡½æ•°ä¸­ä½¿ç”¨ wx-server-sdkï¼Œéœ€å…ˆè°ƒç”¨åˆå§‹åŒ–æ–¹æ³• init ä¸€æ¬¡ï¼Œinit ç”¨äºè®¾ç½®æ¥ä¸‹æ¥åœ¨è¯¥äº‘å‡½æ•°å®ä¾‹ä¸­è°ƒç”¨äº‘å‡½æ•°ã€æ•°æ®åº“ã€æ–‡ä»¶å­˜å‚¨æ—¶è¦è®¿é—®çš„ç¯å¢ƒã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test</span></span><br><span class="line"><span class="keyword">const</span> cloud = <span class="built_in">require</span>(<span class="string">&quot;wx-server-sdk&quot;</span>);</span><br><span class="line">cloud.init(&#123;</span><br><span class="line">  env: <span class="string">&quot;test-x1dzi&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“æˆ‘ä»¬è°ƒç”¨äº‘å‡½æ•°testçš„æ—¶å€™ï¼Œè®¿é—®çš„å°±æ˜¯test-x1dziè¿™ä¸ªäº‘ç©ºé—´é‡Œçš„èµ„æºäº†</span></span><br><span class="line"><span class="keyword">let</span> msg = <span class="keyword">await</span> wx.cloud.callFunction(&#123;</span><br><span class="line">  name: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">  data: &#123;&#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="4-äº‘å¼€å‘å®æˆ˜-æ¨¡ç³Šå›¾åƒé«˜æ¸…å¤„ç†"><a href="#4-äº‘å¼€å‘å®æˆ˜-æ¨¡ç³Šå›¾åƒé«˜æ¸…å¤„ç†" class="headerlink" title="4 äº‘å¼€å‘å®æˆ˜-æ¨¡ç³Šå›¾åƒé«˜æ¸…å¤„ç†"></a>4 äº‘å¼€å‘å®æˆ˜-æ¨¡ç³Šå›¾åƒé«˜æ¸…å¤„ç†</h2><h3 id="4-1-ç›®çš„"><a href="#4-1-ç›®çš„" class="headerlink" title="4.1 ç›®çš„"></a>4.1 ç›®çš„</h3><p>è§£å†³æ¨¡ç³Šå›¾ç‰‡å¸¦æ¥çš„ä¸å¥½ä½“éªŒï¼Œåˆ©ç”¨ AI å›¾ç‰‡å¤„ç†ä½¿å…¶å˜é«˜æ¸…ï¼›</p><h3 id="4-2-æŠ€æœ¯æ ˆ"><a href="#4-2-æŠ€æœ¯æ ˆ" class="headerlink" title="4.2 æŠ€æœ¯æ ˆ"></a>4.2 æŠ€æœ¯æ ˆ</h3><p>è…¾è®¯äº‘ AI å›¾ç‰‡å¤„ç† APIã€äº‘è°ƒç”¨ã€äº‘å‡½æ•°ã€äº‘å‚¨å­˜</p><h3 id="4-3-å¼€å‘"><a href="#4-3-å¼€å‘" class="headerlink" title="4.3 å¼€å‘"></a>4.3 å¼€å‘</h3><p>1.ç”³è¯·å¼€é€šè…¾è®¯äº‘å›¾åƒå¤„ç†å·¥ä½œå°ï¼›<br><img src="/assets/20200911-yun/img5.png" alt="image-20200911172630511"></p><p>2.å¼€é€šå®Œï¼Œç­‰å‡ åˆ†é’Ÿå°±å¯ä»¥çœ‹åˆ°æ§åˆ¶å°äº†ï¼›</p><p><img src="/assets/20200911-yun/img6.png" alt="image-20200911172630511"></p><p>3.ç„¶åç‚¹å‡»åä¸Šè§’çš„<a href="https://console.cloud.tencent.com/api/explorer?Product=tiia&Version=2019-05-29&Action=EnhanceImage&SignVersion=">æ¥å£æ–‡æ¡£</a></p><p>4.å¯ä»¥çœ‹åˆ°ç³»ç»Ÿä¸ºä½ ç”Ÿæˆäº†ä¸€å¥—ä»£ç ï¼Œä¸è¿‡æˆ‘ä»¬éœ€è¦æ·»åŠ <a href="https://console.cloud.tencent.com/cam/capi">SecretIdã€SecretKey</a>ï¼ŒImageUrl ä¸ºå›¾ç‰‡åœ°å€å¯ä»¥æ¥å—çº¿ä¸Šåœ°å€æˆ–è€… Base64 åœ°å€ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¸€ä¼šåŠ¨æ€ä¼ é€’å³å¯ï¼Œè¿”å›çš„å€¼æ˜¯ä¸€ä¸ª base64 çš„åœ°å€ï¼›</p><p><img src="/assets/20200911-yun/img7.png" alt="image-20200911172630511"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> tencentcloud = <span class="built_in">require</span>(<span class="string">&quot;tencentcloud-sdk-nodejs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TiiaClient = tencentcloud.tiia.v20190529.Client;</span><br><span class="line"><span class="keyword">const</span> models = tencentcloud.tiia.v20190529.Models;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Credential = tencentcloud.common.Credential;</span><br><span class="line"><span class="keyword">const</span> ClientProfile = tencentcloud.common.ClientProfile;</span><br><span class="line"><span class="keyword">const</span> HttpProfile = tencentcloud.common.HttpProfile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> cred = <span class="keyword">new</span> Credential(<span class="string">&quot;AKIDrjxxxxxx&quot;</span>, <span class="string">&quot;iBRUIq5ssssss&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> httpProfile = <span class="keyword">new</span> HttpProfile();</span><br><span class="line">httpProfile.endpoint = <span class="string">&quot;tiia.tencentcloudapi.com&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> clientProfile = <span class="keyword">new</span> ClientProfile();</span><br><span class="line">clientProfile.httpProfile = httpProfile;</span><br><span class="line"><span class="keyword">let</span> client = <span class="keyword">new</span> TiiaClient(cred, <span class="string">&quot;ap-beijing&quot;</span>, clientProfile);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> req = <span class="keyword">new</span> models.EnhanceImageRequest();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> params = <span class="string">&quot;&#123;&#125;&quot;</span>;</span><br><span class="line">req.from_json_string(params);</span><br><span class="line"></span><br><span class="line">client.EnhanceImage(req, <span class="function"><span class="keyword">function</span>(<span class="params">errMsg, response</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (errMsg) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(errMsg);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(response.to_json_string());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>5.ç„¶åæˆ‘ä»¬éœ€è¦æŠŠä¸Šé¢çš„ä»£ç æ”¾åˆ°äº‘å‡½æ•°ä¸­ï¼Œæ‰˜ç®¡ä»£ç ï¼Œç„¶åå‰ç«¯å»è°ƒç”¨ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„äº‘å‡½æ•°ï¼›</p><p><img src="/assets/20200911-yun/img8.png" alt="image-20200911172630511"></p><p>6.æŠŠä»£ç ç²˜è´´åˆ° index.js ä¸­ï¼Œç¨åŠ ä¿®æ”¹ï¼Œç”¨äº‘å‡½æ•°åŒ…ä¸€ä¸‹å³å¯ï¼›</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// äº‘å‡½æ•°å…¥å£æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">const</span> tencentcloud = <span class="built_in">require</span>(<span class="string">&quot;tencentcloud-sdk-nodejs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cloud = <span class="built_in">require</span>(<span class="string">&quot;wx-server-sdk&quot;</span>);</span><br><span class="line">cloud.init(&#123;</span><br><span class="line">  <span class="comment">// API è°ƒç”¨éƒ½ä¿æŒå’Œäº‘å‡½æ•°å½“å‰æ‰€åœ¨ç¯å¢ƒä¸€è‡´</span></span><br><span class="line">  env: cloud.DYNAMIC_CURRENT_ENV,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// äº‘å‡½æ•°å…¥å£å‡½æ•°</span></span><br><span class="line"><span class="built_in">exports</span>.main = <span class="keyword">async</span> (event, context) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> TiiaClient = tencentcloud.tiia.v20190529.Client;</span><br><span class="line">  <span class="keyword">const</span> models = tencentcloud.tiia.v20190529.Models;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> Credential = tencentcloud.common.Credential;</span><br><span class="line">  <span class="keyword">const</span> ClientProfile = tencentcloud.common.ClientProfile;</span><br><span class="line">  <span class="keyword">const</span> HttpProfile = tencentcloud.common.HttpProfile;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> cred = <span class="keyword">new</span> Credential(<span class="string">&quot;AKIDrjxxxxxx&quot;</span>, <span class="string">&quot;iBRUIq5ssssss&quot;</span>);</span><br><span class="line">  <span class="keyword">let</span> httpProfile = <span class="keyword">new</span> HttpProfile();</span><br><span class="line">  httpProfile.endpoint = <span class="string">&quot;tiia.tencentcloudapi.com&quot;</span>;</span><br><span class="line">  <span class="keyword">let</span> clientProfile = <span class="keyword">new</span> ClientProfile();</span><br><span class="line">  clientProfile.httpProfile = httpProfile;</span><br><span class="line">  <span class="keyword">let</span> client = <span class="keyword">new</span> TiiaClient(cred, <span class="string">&quot;ap-beijing&quot;</span>, clientProfile);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> req = <span class="keyword">new</span> models.EnhanceImageRequest();</span><br><span class="line">  <span class="keyword">const</span> fileList = event.fileID; <span class="comment">// event=æ˜¯æˆ‘ä»¬ä¼ é€’çš„å‚æ•°çš„å¯¹è±¡é›†åˆï¼ŒfileIDæ˜¯æˆ‘ä»¬ä¼ é€’çš„å‚æ•°å</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> params = <span class="string">&#x27;&#123;&quot;ImageUrl&quot;:&quot;https://www.google.com/imgres?imgurl=https%3A%2F%2Fimg.iplaysoft.com%2Fwp-content%2Fuploads%2F2019%2Ffree-images%2Ffree_stock_photo.jpg&amp;imgrefurl=https%3A%2F%2Fwww.iplaysoft.com%2Ffree-images.html&amp;tbnid=vQjlM9KtkGsb_M&amp;vet=12ahUKEwiY9Zfn3-frAhVG15QKHeudABMQMygAegUIARCeAQ..i&amp;docid=JeaDEV9l4RQZhM&amp;w=680&amp;h=453&amp;q=%E5%9B%BE%E7%89%87&amp;ved=2ahUKEwiY9Zfn3-frAhVG15QKHeudABMQMygAegUIARCeAQ&quot;&#125;&#x27;</span>;</span><br><span class="line">  req.from_json_string(params);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">      client.EnhanceImage(req, <span class="function"><span class="keyword">function</span>(<span class="params">errMsg, response</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (errMsg) &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(errMsg);</span><br><span class="line">          resolve(errMsg);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">console</span>.log(response.to_json_string());</span><br><span class="line">        resolve(response.EnhancedImage);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    result: <span class="keyword">await</span> run(),</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>7.æˆ‘ä»¬æŠŠä»£ç ç²˜è´´åˆ° index.js ä¸­ï¼Œç„¶åå¼€å¯æœ¬åœ°è°ƒè¯•ï¼Œå¯ä»¥çœ‹åˆ°ç”Ÿæˆäº† base64 åœ°å€ï¼Œè¯´æ˜è½¬æ¢æˆåŠŸäº†<br><img src="/assets/20200911-yun/img9.png" alt="image-20200911172630511"></p><p>8.æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦æŠŠå†™æ­»çš„å›¾ç‰‡é€šè¿‡å‰ç«¯ä¼ é€’è¿‡å»ï¼Œè€Œä¸”å›¾ç‰‡éœ€è¦ä»æœ¬åœ°é€‰æ‹©ï¼Œåˆå›¾ç‰‡è½¬æ¢åŠŸèƒ½ä¸æ”¯æŒæœ¬åœ°å›¾ç‰‡è½¬æ¢ï¼Œéœ€è¦çº¿ä¸Šåœ°å€ï¼Œæ•…ç”¨åˆ°äº†å°ç¨‹åºç«¯-äº‘å‚¨å­˜ä¸Šä¼ ã€äº‘å‡½æ•°ç«¯-äº‘å‚¨å­˜ä¸‹è½½ï¼›</p><!-- // ç›®å‰å›¾ç‰‡åœ°å€æ˜¯å†™æ­»çš„ éœ€è¦åšæˆåŠ¨æ€è·å– --><p>æµç¨‹ï¼š å‰ç«¯é€‰æ‹©å›¾ç‰‡=&gt;æŠŠæœ¬åœ°å›¾ç‰‡ä¸Šä¼ åˆ°äº‘å‚¨å­˜=&gt;è°ƒç”¨äº‘å‡½æ•°ä¼ é€’äº‘å‚¨å­˜ä¼ é€’ fileID=&gt;äº‘å‡½æ•°è°ƒç”¨äº‘å‚¨å­˜æ‹¿åˆ°çœŸå®çº¿ä¸Šåœ°å€=&gt;è°ƒç”¨ AI æ¥å£=&gt;è¿”å›è½¬æ¢åçš„åœ°å€ç»™å‰ç«¯=&gt;å‰ç«¯å±•ç¤º</p><ol><li>å‰ç«¯é€‰æ‹©å›¾ç‰‡</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">wx.chooseImage(&#123;</span><br><span class="line">  count: <span class="number">1</span>,</span><br><span class="line">  sizeType: [<span class="string">&quot;compressed&quot;</span>],</span><br><span class="line">  sourceType: [<span class="string">&quot;album&quot;</span>],</span><br><span class="line">  success: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// tempFilePathå¯ä»¥ä½œä¸ºimgæ ‡ç­¾çš„srcå±æ€§æ˜¾ç¤ºå›¾ç‰‡</span></span><br><span class="line">    <span class="keyword">const</span> tempFilePaths = res.tempFilePaths;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      ImageUrl: tempFilePaths[<span class="number">0</span>],</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ol start="2"><li>æŠŠæœ¬åœ°å›¾ç‰‡ä¸Šä¼ åˆ°äº‘å‚¨å­˜&amp;è°ƒç”¨äº‘å‡½æ•°ä¼ é€’äº‘å‚¨å­˜ä¼ é€’ fileID</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">wx.cloud.uploadFile(&#123;</span><br><span class="line">  cloudPath: rdm + <span class="string">&quot;.png&quot;</span>, <span class="comment">//äº‘å‚¨å­˜çš„æ–‡ä»¶å</span></span><br><span class="line">  filePath: <span class="built_in">this</span>.data.ImageUrl, <span class="comment">// æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">  success: <span class="keyword">async</span> (res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> msg = <span class="keyword">await</span> wx.cloud.callFunction(&#123;</span><br><span class="line">      name: <span class="string">&quot;Upload&quot;</span>,</span><br><span class="line">      data: &#123;</span><br><span class="line">        fileID: [res.fileID],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      img: <span class="string">&quot;data:image/png;base64,&quot;</span> + msg.result.result,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ol start="3"><li>äº‘å‡½æ•°è°ƒç”¨äº‘å‚¨å­˜æ‹¿åˆ°çœŸå®çº¿ä¸Šåœ°å€=&gt;è°ƒç”¨ AI æ¥å£=&gt;è¿”å›è½¬æ¢åçš„åœ°å€ç»™å‰ç«¯</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fileList = event.fileID;</span><br><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> cloud.getTempFileURL(&#123;</span><br><span class="line">  fileList: fileList,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">let</span> params = <span class="string">&#x27;&#123;&quot;ImageUrl&quot;:&quot;&#x27;</span> + result.fileList[<span class="number">0</span>].tempFileURL + <span class="string">&#x27;&quot;&#125;&#x27;</span>;</span><br><span class="line">req.from_json_string(params);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    client.EnhanceImage(req, <span class="function"><span class="keyword">function</span>(<span class="params">errMsg, response</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (errMsg) &#123;</span><br><span class="line">        resolve(errMsg);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">console</span>.log(response.to_json_string());</span><br><span class="line">      resolve(response.EnhancedImage);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">  result: <span class="keyword">await</span> run(),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>æœ€ç»ˆå±•ç¤ºè§†é¢‘å¦‚ä¸‹</p><video id="video" controls="" preload>  <source id="mp4" src="/assets/20200911-yun/mp4.mp4" type="video/mp4" /></video></li></ul>]]></content>
      
      
      <categories>
          
          <category> å°ç¨‹åº </category>
          
          <category> serverless </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>web3.jsç¼–è¯‘Solidity</title>
      <link href="/2020/09/04/20200904-web3/"/>
      <url>/2020/09/04/20200904-web3/</url>
      
        <content type="html"><![CDATA[<h1 id="web3-js-ç¼–è¯‘-Solidityï¼Œå‘å¸ƒï¼Œè°ƒç”¨å…¨éƒ¨æµç¨‹ï¼ˆæ‰‹æŠŠæ‰‹æ•™ç¨‹ï¼‰"><a href="#web3-js-ç¼–è¯‘-Solidityï¼Œå‘å¸ƒï¼Œè°ƒç”¨å…¨éƒ¨æµç¨‹ï¼ˆæ‰‹æŠŠæ‰‹æ•™ç¨‹ï¼‰" class="headerlink" title="web3.js ç¼–è¯‘ Solidityï¼Œå‘å¸ƒï¼Œè°ƒç”¨å…¨éƒ¨æµç¨‹ï¼ˆæ‰‹æŠŠæ‰‹æ•™ç¨‹ï¼‰"></a>web3.js ç¼–è¯‘ Solidityï¼Œå‘å¸ƒï¼Œè°ƒç”¨å…¨éƒ¨æµç¨‹ï¼ˆæ‰‹æŠŠæ‰‹æ•™ç¨‹ï¼‰</h1><p>ä¸‹é¢æ•™ç¨‹æ˜¯æ‰“ç®—åœ¨å°½é‡ç‰µæ¶‰å¯èƒ½å°‘çš„ä»¥å¤ªåŠçš„ç›¸å…³å·¥å…·ï¼Œä¸»è¦ä½¿ç”¨ web3.js è¿™ä¸ªä»¥å¤ªåŠæä¾›çš„å·¥å…·åŒ…ï¼Œæ¥å®Œæˆåˆçº¦çš„ç¼–è¯‘ï¼Œå‘å¸ƒï¼Œåˆçº¦æ–¹æ³•è°ƒç”¨çš„ä¸€æ•´ä¸ªæµç¨‹ã€‚ä¸€æ–¹é¢æ¥äº†è§£ä»¥å¤ªåŠå¼€å‘åˆ°åº•éœ€è¦ä»€ä¹ˆï¼Œå¦ä¸€æ–¹é¢æ¥å¯¹ web3.js çš„ API æœ‰ä¸ªåŸºæœ¬çš„äº†è§£ã€‚ç”±äºæ‰€æœ‰å…¶å®ƒå·¥å…·éƒ½æˆ–å¤šæˆ–å°‘çš„æ˜¯å¯¹ web3.js çš„åº•å±‚å‡½æ•°çš„åŒ…è£…ï¼Œæ‰€ä»¥å¯¹ web3.js ä½¿ç”¨æµç¨‹æœ‰ä¸ªè®¤è¯†ä¹‹åï¼Œä¹Ÿèƒ½æ›´å¥½çš„å…¥é—¨ï¼Œä½¿ç”¨ç›¸å…³çš„å·¥å…·ã€‚</p><h2 id="1-å‡†å¤‡å·¥ä½œ"><a href="#1-å‡†å¤‡å·¥ä½œ" class="headerlink" title="1. å‡†å¤‡å·¥ä½œ"></a>1. å‡†å¤‡å·¥ä½œ</h2><h3 id="1-1-å®‰è£…-Node-js"><a href="#1-1-å®‰è£…-Node-js" class="headerlink" title="1.1 å®‰è£… Node.js"></a>1.1 å®‰è£… Node.js</h3><p>ç”±äºæˆ‘ä»¬è¦ä½¿ç”¨ web3.js<a href="https://web3.tryblockchain.org/web3-js-in-action.html#fn1">1</a>ã€‚è¿™é‡Œä½¿ç”¨ Node æ¥é›†æˆ web3.js æ¨¡å—ï¼ˆå½“ç„¶ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨å…¶å®ƒçš„æ–¹å¼ï¼‰ã€‚ä½ å¯ä»¥é€šè¿‡å‚è€ƒå®˜ç½‘æ–‡æ¡£å®‰è£…<a href="https://web3.tryblockchain.org/web3-js-in-action.html#fn2">2</a>ã€‚</p><h4 id="1-1-1-Ubuntu"><a href="#1-1-1-Ubuntu" class="headerlink" title="1.1.1 Ubuntu"></a>1.1.1 Ubuntu</h4><p>å¦‚æœä½ ä½¿ç”¨ ubuntuï¼Œå¯ä»¥ä½¿ç”¨ä¸‹è¿°å‘½ä»¤ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®‰è£…Node</span></span><br><span class="line">sudo apt-get install nodejs</span><br><span class="line"><span class="comment">//å®‰è£…Nodeçš„åŒ…ç®¡ç†å™¨</span></span><br><span class="line">sudo apt-get install npm</span><br></pre></td></tr></table></figure><h4 id="1-1-2-MAC"><a href="#1-1-2-MAC" class="headerlink" title="1.1.2 MAC"></a>1.1.2 MAC</h4><p>å¦‚æœä½ ä½¿ç”¨<code>Homebrew</code>ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹è¿°å‘½ä»¤ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®‰è£…Node</span></span><br><span class="line">brew install node</span><br><span class="line"><span class="comment">//å®‰è£…Nodeçš„åŒ…ç®¡ç†å™¨</span></span><br><span class="line">brew install npm</span><br></pre></td></tr></table></figure><h4 id="1-1-3-å®‰è£…æ£€æŸ¥"><a href="#1-1-3-å®‰è£…æ£€æŸ¥" class="headerlink" title="1.1.3 å®‰è£…æ£€æŸ¥"></a>1.1.3 å®‰è£…æ£€æŸ¥</h4><p>å®‰è£…æˆåŠŸåï¼Œå¯ä»¥æŸ¥çœ‹ä¸‹å½“å‰çš„ç‰ˆæœ¬ï¼Œç¡®è®¤æ­£å¸¸å®‰è£…ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ node -v</span><br><span class="line">v7<span class="number">.2</span><span class="number">.0</span></span><br></pre></td></tr></table></figure><h3 id="1-2-ä»¥å¤ªåŠçš„èŠ‚ç‚¹"><a href="#1-2-ä»¥å¤ªåŠçš„èŠ‚ç‚¹" class="headerlink" title="1.2 ä»¥å¤ªåŠçš„èŠ‚ç‚¹"></a>1.2 ä»¥å¤ªåŠçš„èŠ‚ç‚¹</h3><p>ç”±äºæ•´ä¸ªåˆçº¦ä»£ç çš„æ‰§è¡Œéœ€è¦ä¸€ä¸ªè™šæ‹Ÿæœºç¯å¢ƒï¼Œæ‰€ä»¥åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸å¾—ä¸å®‰è£…ä¸€ä¸ªå®ç°äº†ä»¥å¤ªåŠè™šæ‹Ÿæœºçš„èŠ‚ç‚¹ã€‚</p><p>å¯ä»¥é€‰æ‹©ä¸€ä¸ªè½»é‡çº§çš„èŠ‚ç‚¹ï¼Œæ¯”å¦‚<code>EtherumJS TestRPC</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªå®Œæ•´çš„åœ¨å†…å­˜ä¸­çš„åŒºå—é“¾ä»…ä»…å­˜åœ¨äºä½ å¼€å‘çš„è®¾å¤‡ä¸Šã€‚å®ƒåœ¨æ‰§è¡Œäº¤æ˜“æ—¶æ˜¯å®æ—¶è¿”å›ï¼Œè€Œä¸ç­‰å¾…é»˜è®¤çš„å‡ºå—æ—¶é—´ï¼Œè¿™æ ·ä½ å¯ä»¥å¿«é€ŸéªŒè¯ä½ æ–°å†™çš„ä»£ç ï¼Œå½“å‡ºç°é”™è¯¯æ—¶ï¼Œä¹Ÿèƒ½å³æ—¶åé¦ˆç»™ä½ ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g ethereumjs-testrpc</span><br></pre></td></tr></table></figure><p>å®‰è£…å¥½åï¼Œä½ å°±å¯ä»¥é€šè¿‡<code>testrpc</code>å‘½ä»¤æ¥å¯åŠ¨äº†ï¼Œå¯åŠ¨ä¸å¤§å¤šæ•°ä»¥å¤ªåŠèŠ‚ç‚¹ä¸€æ ·ï¼Œè¿è¡Œåœ¨<code>localhost:8545</code>ã€‚</p><p>å¦‚æœä½ å®‰è£…<code>geth</code>è¿™æ ·çš„å®¢æˆ·ç«¯ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p><h3 id="1-3-Web3-çš„æ”¯æŒ"><a href="#1-3-Web3-çš„æ”¯æŒ" class="headerlink" title="1.3 Web3 çš„æ”¯æŒ"></a>1.3 Web3 çš„æ”¯æŒ</h3><p>å®‰è£…<code>web3</code>çš„æ¨¡å—[web3]ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install web3</span><br></pre></td></tr></table></figure><h2 id="2-åˆçº¦ç¼–è¯‘"><a href="#2-åˆçº¦ç¼–è¯‘" class="headerlink" title="2. åˆçº¦ç¼–è¯‘"></a>2. åˆçº¦ç¼–è¯‘</h2><h3 id="2-1-ä¸€ä¸ªç®€å•çš„åˆçº¦"><a href="#2-1-ä¸€ä¸ªç®€å•çš„åˆçº¦" class="headerlink" title="2.1 ä¸€ä¸ªç®€å•çš„åˆçº¦"></a>2.1 ä¸€ä¸ªç®€å•çš„åˆçº¦</h3><p>æˆ‘ä»¬æ‰“ç®—ç”¨æ¥æµ‹è¯•çš„åˆçº¦å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">contract Calc&#123;</span><br><span class="line">  <span class="comment">/*åŒºå—é“¾å­˜å‚¨*/</span></span><br><span class="line">  uint count;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*æ‰§è¡Œä¼šå†™å…¥æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦`transaction`çš„æ–¹å¼æ‰§è¡Œã€‚*/</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">uint a, uint b</span>) <span class="title">returns</span>(<span class="params">uint</span>)</span>&#123;</span><br><span class="line">    count++;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*æ‰§è¡Œä¸ä¼šå†™å…¥æ•°æ®ï¼Œæ‰€ä»¥å…è®¸`call`çš„æ–¹å¼æ‰§è¡Œã€‚*/</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getCount</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">uint</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>add()</code>æ–¹æ³•ç”¨æ¥è¿”å›è¾“å…¥ä¸¤ä¸ªæ•°æ®çš„å’Œï¼Œå¹¶ä¼šå¯¹<code>add()</code>æ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°è¿›è¡Œè®¡æ•°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªè®¡æ•°æ˜¯å­˜åœ¨åŒºå—é“¾ä¸Šçš„ï¼Œå¯¹å®ƒçš„è°ƒç”¨éœ€è¦ä½¿ç”¨<code>transaction</code>ã€‚</p><p><code>getCount()</code>è¿”å›<code>add()</code>å‡½æ•°çš„è°ƒç”¨æ¬¡æ•°ã€‚ç”±äºè¿™ä¸ªå‡½æ•°ä¸ä¼šä¿®æ”¹åŒºå—é“¾çš„ä»»ä½•çŠ¶æ€ï¼Œå¯¹å®ƒçš„è°ƒç”¨ä½¿ç”¨<code>call</code>å°±å¯ä»¥äº†ã€‚</p><h3 id="2-2-ç¼–è¯‘åˆçº¦"><a href="#2-2-ç¼–è¯‘åˆçº¦" class="headerlink" title="2.2 ç¼–è¯‘åˆçº¦"></a>2.2 ç¼–è¯‘åˆçº¦</h3><p>ç”±äºåˆçº¦æ˜¯ä½¿ç”¨<code>Solidity</code>ç¼–å†™ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>web3.eth.compile.solidity</code>æ¥ç¼–è¯‘åˆçº¦<a href="https://web3.tryblockchain.org/web3-js-in-action.html#fn3">3</a>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¼–è¯‘åˆçº¦</span></span><br><span class="line"><span class="keyword">let</span> source = <span class="string">&quot;pragma solidity ^0.4.0;contract Calc&#123;  /*åŒºå—é“¾å­˜å‚¨*/  uint count;  /*æ‰§è¡Œä¼šå†™å…¥æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦`transaction`çš„æ–¹å¼æ‰§è¡Œã€‚*/  function add(uint a, uint b) returns(uint)&#123;    count++;    return a + b;  &#125;  /*æ‰§è¡Œä¸ä¼šå†™å…¥æ•°æ®ï¼Œæ‰€ä»¥å…è®¸`call`çš„æ–¹å¼æ‰§è¡Œã€‚*/  function getCount() returns (uint)&#123;    return count;  &#125;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> calc = web3.eth.compile.solidity(source);</span><br></pre></td></tr></table></figure><p>å¦‚æœç¼–è¯‘æˆåŠŸï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    code: <span class="string">&#x27;0x606060405234610000575b607e806100176000396000f3606060405260e060020a6000350463771602f781146026578063a87d942c146048575b6000565b3460005760366004356024356064565b60408051918252519081900360200190f35b3460005760366077565b60408051918252519081900360200190f35b6000805460010190558181015b92915050565b6000545b9056&#x27;</span>,</span><br><span class="line">    info: &#123;</span><br><span class="line">        source: <span class="string">&#x27;pragma solidity ^0.4.0;contract Calc&#123;  /*åŒºå—é“¾å­˜å‚¨*/  uint count;  /*æ‰§è¡Œä¼šå†™å…¥æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦`transaction`çš„æ–¹å¼æ‰§è¡Œã€‚*/  function add(uint a, uint b) returns(uint)&#123;    count++;    return a + b;  &#125;  /*æ‰§è¡Œä¸ä¼šå†™å…¥æ•°æ®ï¼Œæ‰€ä»¥å…è®¸`call`çš„æ–¹å¼æ‰§è¡Œã€‚*/  function getCount() returns (uint)&#123;    return count;  &#125;&#125;&#x27;</span>,</span><br><span class="line">        language: <span class="string">&#x27;Solidity&#x27;</span>,</span><br><span class="line">        languageVersion: <span class="string">&#x27;0.4.6+commit.2dabbdf0.Emscripten.clang&#x27;</span>,</span><br><span class="line">        compilerVersion: <span class="string">&#x27;0.4.6+commit.2dabbdf0.Emscripten.clang&#x27;</span>,</span><br><span class="line">        abiDefinition: [</span><br><span class="line">            [</span><br><span class="line">                <span class="built_in">Object</span></span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">                <span class="built_in">Object</span></span><br><span class="line">            ]</span><br><span class="line">        ],</span><br><span class="line">        userDoc: &#123;</span><br><span class="line">            methods: &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        developerDoc: &#123;</span><br><span class="line">            methods: &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-å‘å¸ƒåˆçº¦"><a href="#3-å‘å¸ƒåˆçº¦" class="headerlink" title="3. å‘å¸ƒåˆçº¦"></a>3. å‘å¸ƒåˆçº¦</h2><p><code>web3.js</code>å…¶å®ä¹Ÿåƒæ¡†æ¶ä¸€æ ·å¯¹åˆçº¦çš„æ“ä½œè¿›è¡Œäº†å°è£…ã€‚å‘å¸ƒåˆçº¦æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>web3.eth.contract</code>çš„<code>new</code>æ–¹æ³•<a href="https://web3.tryblockchain.org/web3-js-in-action.html#fn4">4</a>ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> myContractReturned = calcContract.new(&#123;</span><br><span class="line">    data: deployCode,</span><br><span class="line">    <span class="keyword">from</span>: deployeAddr</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, myContract</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">        <span class="comment">// æ³¨æ„ï¼šè¿™ä¸ªå›è°ƒä¼šè§¦å‘ä¸¤æ¬¡</span></span><br><span class="line">        <span class="comment">//ä¸€æ¬¡æ˜¯åˆçº¦çš„äº¤æ˜“å“ˆå¸Œå±æ€§å®Œæˆ</span></span><br><span class="line">        <span class="comment">//å¦ä¸€æ¬¡æ˜¯åœ¨æŸä¸ªåœ°å€ä¸Šå®Œæˆéƒ¨ç½²</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// é€šè¿‡åˆ¤æ–­æ˜¯å¦æœ‰åœ°å€ï¼Œæ¥ç¡®è®¤æ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œè¿˜æ˜¯ç¬¬äºŒæ¬¡è°ƒç”¨ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (!myContract.address) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;contract deploy transaction hash: &quot;</span> + myContract.transactionHash) <span class="comment">//éƒ¨ç½²åˆçº¦çš„äº¤æ˜“å“ˆå¸Œå€¼</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆçº¦å‘å¸ƒæˆåŠŸ</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>éƒ¨ç½²è¿‡ç¨‹ä¸­éœ€è¦ä¸»è¦çš„æ˜¯ï¼Œ<code>new</code>æ–¹æ³•çš„å›è°ƒä¼šæ‰§è¡Œä¸¤æ¬¡ï¼Œç¬¬ä¸€æ¬¡æ˜¯åˆçº¦çš„äº¤æ˜“åˆ›å»ºå®Œæˆï¼Œç¬¬äºŒæ¬¡æ˜¯åœ¨æŸä¸ªåœ°å€ä¸Šå®Œæˆéƒ¨ç½²ã€‚éœ€è¦æ³¨æ„çš„æ˜¯åªæœ‰åœ¨éƒ¨ç½²å®Œæˆåï¼Œæ‰èƒ½è¿›è¡Œæ–¹æ³•è¯¥ç”¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™<code>TypeError: myContractReturned.add is not a function</code>ã€‚</p><h2 id="4-è°ƒç”¨åˆçº¦"><a href="#4-è°ƒç”¨åˆçº¦" class="headerlink" title="4. è°ƒç”¨åˆçº¦"></a>4. è°ƒç”¨åˆçº¦</h2><p>ç”±äº<code>web3.js</code>å°è£…äº†åˆçº¦è°ƒç”¨çš„æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¯ä»¥ä½¿ç”¨<code>web3.eth.contract</code>çš„é‡Œçš„<code>sendTransaction</code>æ¥ä¿®æ”¹åŒºå—é“¾æ•°æ®ã€‚åœ¨è¿™é‡Œæœ‰ä¸ªå‘ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°<code>Error: invalid address</code>ï¼ŒåŸå› æ˜¯æ²¡æœ‰ä¼ <code>from</code>ï¼Œäº¤æ˜“å‘èµ·è€…çš„åœ°å€ã€‚åœ¨ä½¿ç”¨<code>web3.js</code>çš„ API éƒ½éœ€ç•™æ„ï¼Œå‡ºç°è¿™ç§æ‰¾ä¸åˆ°åœ°å€çš„ï¼Œéƒ½çœ‹çœ‹<code>fromå­—æ®µå§ã€‚</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨transactionæ–¹å¼è°ƒç”¨ï¼Œå†™å…¥åˆ°åŒºå—é“¾ä¸Š</span></span><br><span class="line">myContract.add.sendTransaction(<span class="number">1</span>, <span class="number">2</span>, &#123;</span><br><span class="line">  <span class="keyword">from</span>: deployeAddr,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;after contract deploy, call:&quot;</span> + myContract.getCount.call());</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¦ä¿®æ”¹åŒºå—é“¾ä¸Šçš„æ•°æ®ï¼Œä¸€å®šè¦ä½¿ç”¨<code>sendTransaction</code>ï¼Œè¿™ä¼šæ¶ˆè€—<code>gas</code>ã€‚å¦‚æœä¸ä¿®æ”¹åŒºå—é“¾ä¸Šçš„æ•°æ®ï¼Œä½¿ç”¨<code>call</code>ï¼Œè¿™æ ·ä¸ä¼šæ¶ˆè€—<code>gas</code>ã€‚</p><h2 id="5-ä½¿ç”¨-web3-js-ç¼–è¯‘ï¼Œå‘å¸ƒï¼Œè°ƒç”¨çš„å®Œæ•´æºç "><a href="#5-ä½¿ç”¨-web3-js-ç¼–è¯‘ï¼Œå‘å¸ƒï¼Œè°ƒç”¨çš„å®Œæ•´æºç " class="headerlink" title="5. ä½¿ç”¨ web3.js ç¼–è¯‘ï¼Œå‘å¸ƒï¼Œè°ƒç”¨çš„å®Œæ•´æºç "></a>5. ä½¿ç”¨ web3.js ç¼–è¯‘ï¼Œå‘å¸ƒï¼Œè°ƒç”¨çš„å®Œæ•´æºç </h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> Web3 = <span class="built_in">require</span>(<span class="string">&quot;web3&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> web3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> web3 !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">  web3 = <span class="keyword">new</span> Web3(web3.currentProvider);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// set the provider you want from Web3.providers</span></span><br><span class="line">  web3 = <span class="keyword">new</span> Web3(<span class="keyword">new</span> Web3.providers.HttpProvider(<span class="string">&quot;http://localhost:8545&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">from</span> = web3.eth.accounts[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¼–è¯‘åˆçº¦</span></span><br><span class="line"><span class="keyword">let</span> source = <span class="string">&quot;pragma solidity ^0.4.0;contract Calc&#123;  /*åŒºå—é“¾å­˜å‚¨*/  uint count;  /*æ‰§è¡Œä¼šå†™å…¥æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦`transaction`çš„æ–¹å¼æ‰§è¡Œã€‚*/  function add(uint a, uint b) returns(uint)&#123;    count++;    return a + b;  &#125;  /*æ‰§è¡Œä¸ä¼šå†™å…¥æ•°æ®ï¼Œæ‰€ä»¥å…è®¸`call`çš„æ–¹å¼æ‰§è¡Œã€‚*/  function getCount() constant returns (uint)&#123;    return count;  &#125;&#125;&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> calcCompiled = web3.eth.compile.solidity(source);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(calcCompiled);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;ABI definition:&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(calcCompiled[<span class="string">&quot;info&quot;</span>][<span class="string">&quot;abiDefinition&quot;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¾—åˆ°åˆçº¦å¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> abiDefinition = calcCompiled[<span class="string">&quot;info&quot;</span>][<span class="string">&quot;abiDefinition&quot;</span>];</span><br><span class="line"><span class="keyword">let</span> calcContract = web3.eth.contract(abiDefinition);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2. éƒ¨ç½²åˆçº¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2.1 è·å–åˆçº¦çš„ä»£ç ï¼Œéƒ¨ç½²æ—¶ä¼ é€’çš„å°±æ˜¯åˆçº¦ç¼–è¯‘åçš„äºŒè¿›åˆ¶ç </span></span><br><span class="line"><span class="keyword">let</span> deployCode = calcCompiled[<span class="string">&quot;code&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.2 éƒ¨ç½²è€…çš„åœ°å€ï¼Œå½“å‰å–é»˜è®¤è´¦æˆ·çš„ç¬¬ä¸€ä¸ªåœ°å€ã€‚</span></span><br><span class="line"><span class="keyword">let</span> deployeAddr = web3.eth.accounts[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.3 å¼‚æ­¥æ–¹å¼ï¼Œéƒ¨ç½²åˆçº¦</span></span><br><span class="line"><span class="keyword">let</span> myContractReturned = calcContract.new(</span><br><span class="line">  &#123;</span><br><span class="line">    data: deployCode,</span><br><span class="line">    <span class="keyword">from</span>: deployeAddr,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">err, myContract</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">      <span class="comment">// æ³¨æ„ï¼šè¿™ä¸ªå›è°ƒä¼šè§¦å‘ä¸¤æ¬¡</span></span><br><span class="line">      <span class="comment">//ä¸€æ¬¡æ˜¯åˆçº¦çš„äº¤æ˜“å“ˆå¸Œå±æ€§å®Œæˆ</span></span><br><span class="line">      <span class="comment">//å¦ä¸€æ¬¡æ˜¯åœ¨æŸä¸ªåœ°å€ä¸Šå®Œæˆéƒ¨ç½²</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// é€šè¿‡åˆ¤æ–­æ˜¯å¦æœ‰åœ°å€ï¼Œæ¥ç¡®è®¤æ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œè¿˜æ˜¯ç¬¬äºŒæ¬¡è°ƒç”¨ã€‚</span></span><br><span class="line">      <span class="keyword">if</span> (!myContract.address) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;contract deploy transaction hash: &quot;</span> + myContract.transactionHash); <span class="comment">//éƒ¨ç½²åˆçº¦çš„äº¤æ˜“å“ˆå¸Œå€¼</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆçº¦å‘å¸ƒæˆåŠŸåï¼Œæ‰èƒ½è°ƒç”¨åç»­çš„æ–¹æ³•</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;contract deploy address: &quot;</span> + myContract.address); <span class="comment">// åˆçº¦çš„éƒ¨ç½²åœ°å€</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä½¿ç”¨transactionæ–¹å¼è°ƒç”¨ï¼Œå†™å…¥åˆ°åŒºå—é“¾ä¸Š</span></span><br><span class="line">        myContract.add.sendTransaction(<span class="number">1</span>, <span class="number">2</span>, &#123;</span><br><span class="line">          <span class="keyword">from</span>: deployeAddr,</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;after contract deploy, call:&quot;</span> + myContract.getCount.call());</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å‡½æ•°è¿”å›å¯¹è±¡`myContractReturned`å’Œå›è°ƒå‡½æ•°å¯¹è±¡`myContract`æ˜¯ &quot;myContractReturned&quot; === &quot;myContract&quot;,</span></span><br><span class="line">      <span class="comment">// æ‰€ä»¥æœ€ç»ˆ`myContractReturned`è¿™ä¸ªå¯¹è±¡é‡Œé¢çš„åˆçº¦åœ°å€å±æ€§ä¹Ÿä¼šè¢«è®¾ç½®ã€‚</span></span><br><span class="line">      <span class="comment">// `myContractReturned`ä¸€å¼€å§‹è¿”å›çš„ç»“æœæ˜¯æ²¡æœ‰è®¾ç½®çš„ã€‚</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ³¨æ„ï¼Œå¼‚æ­¥æ‰§è¡Œï¼Œæ­¤æ—¶è¿˜æ˜¯æ²¡æœ‰åœ°å€çš„ã€‚</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;returned deployed didn&#x27;t have address now: &quot;</span> + myContractReturned.address);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨éå›è°ƒçš„æ–¹å¼æ¥æ‹¿åˆ°è¿”å›çš„åœ°å€ï¼Œä½†ä½ éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œç›´åˆ°æœ‰åœ°å€ï¼Œå»ºè®®ä½¿ç”¨ä¸Šé¢çš„å›è°ƒæ–¹å¼ã€‚</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">setTimeout(function()&#123;</span></span><br><span class="line"><span class="comment">  console.log(&quot;returned deployed wait to have address: &quot; + myContractReturned.address);</span></span><br><span class="line"><span class="comment">  console.log(myContractReturned.getCount.call());</span></span><br><span class="line"><span class="comment">&#125;, 20000);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¦‚æœä½ åœ¨å…¶å®ƒåœ°æ–¹å·²ç»éƒ¨ç½²äº†åˆçº¦ï¼Œä½ å¯ä»¥ä½¿ç”¨atæ¥æ‹¿åˆ°åˆçº¦å¯¹è±¡</span></span><br><span class="line"><span class="comment">//calcContract.at([&quot;0x50023f33f3a58adc2469fc46e67966b01d9105c4&quot;]);</span></span><br></pre></td></tr></table></figure><p><a href="https://me.tryblockchain.org/">åŸæ–‡</a></p>]]></content>
      
      
      <categories>
          
          <category> ä»¥å¤ªåŠ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å°ç¨‹åºé”™è¯¯ç»Ÿè®¡</title>
      <link href="/2020/09/03/20200903-feishu-bug-collection/"/>
      <url>/2020/09/03/20200903-feishu-bug-collection/</url>
      
        <content type="html"><![CDATA[<h2 id="ç›®çš„"><a href="#ç›®çš„" class="headerlink" title="ç›®çš„"></a>ç›®çš„</h2><p>è§£å†³çº¿ä¸ŠæŠ¥é”™éš¾ä»¥å½’ç±»ã€æŸ¥æ‰¾çš„é—®é¢˜ï¼Œæ ¹æ®æ¯ä½åŒå­¦è´Ÿè´£çš„é¡¹ç›®çš„ä¸åŒï¼Œå•ç‹¬åˆ†ç±»å¹¶è§£å†³ bugï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼Œä»¥åŠå°ç¨‹åºçš„è¯„åˆ†ç­‰ï¼›</p><h2 id="åŸºæœ¬æ€è·¯"><a href="#åŸºæœ¬æ€è·¯" class="headerlink" title="åŸºæœ¬æ€è·¯"></a>åŸºæœ¬æ€è·¯</h2><p>æŠ“å–å¾®ä¿¡åå°æŠ¥é”™=&gt;æ ¹æ®ä¸åŒçš„äººè´Ÿè´£é¡¹ç›®çš„ä¸åŒåˆ†åˆ«ç»Ÿè®¡=&gt;ç”Ÿæˆ excel=&gt;ä¸Šä¼ åˆ°é£ä¹¦æ–‡æ¡£</p><h2 id="æŠ€æœ¯æ ˆ"><a href="#æŠ€æœ¯æ ˆ" class="headerlink" title="æŠ€æœ¯æ ˆ"></a>æŠ€æœ¯æ ˆ</h2><p>nodeï¼ˆsuperagentã€xlsxï¼‰+ é£ä¹¦æ–‡æ¡£</p><h2 id="å¼€å‘æµç¨‹"><a href="#å¼€å‘æµç¨‹" class="headerlink" title="å¼€å‘æµç¨‹"></a>å¼€å‘æµç¨‹</h2><ul><li>é¦–å…ˆç™»é™†<a href="https://mp.weixin.qq.com/">å¾®ä¿¡å…¬ä¼—å¹³å°</a>ä¸­çš„å¼€å‘ä¸€æ ï¼›</li></ul><p><img src="/assets/20200903-feishu-bug-collection/img1.png"></p><ul><li>é€‰æ‹©é¡µé¢é‡Œé¢çš„è¿ç»´ä¸­å¿ƒ=&gt;é”™è¯¯æŸ¥è¯¢é€‰é¡¹ï¼›</li></ul><p><img src="/assets/20200903-feishu-bug-collection/img2.png"></p><ul><li>é¡µé¢é•¿è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©é‡Œé¢æ—¥æœŸï¼Œç‰ˆæœ¬ï¼Œç±»å‹ç­‰æ¡ä»¶è¿›è¡ŒæŸ¥è¯¢ï¼›</li></ul><p><img src="/assets/20200903-feishu-bug-collection/img3.png"></p><ul><li>ç„¶åæ‰“å¼€ chrome çš„æ§åˆ¶å°ï¼Œç‚¹å‡»æŸ¥è¯¢æŒ‰é’®, æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯·æ±‚äº†ä¸€ä¸ªæ¥å£ï¼Œè¿™ä¸ªæ¥å£å¾®ä¿¡ç”¨äºæŸ¥è¯¢é”™è¯¯çš„æ¥å£äº†ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬è¦ç”¨çš„æ¥å£</li></ul><p><img src="/assets/20200903-feishu-bug-collection/img4.png"></p><p><img src="/assets/20200903-feishu-bug-collection/img5.png"></p><p><img src="/assets/20200903-feishu-bug-collection/img6.png"></p><ul><li>ä¸‹é¢æˆ‘ä»¬è¦åšçš„å°±æ˜¯æŠŠä¸Šè¾¹æ‰€æœ‰çš„è¯·æ±‚å¤´å‚æ•°ç²˜è´´å‡ºæ¥æ‹Ÿå¾®ä¿¡è¯·æ±‚äº†</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> superagent = <span class="built_in">require</span>(<span class="string">&quot;superagent&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> configs = &#123;</span><br><span class="line">  Accept: <span class="string">&quot;application/json, text/plain,&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate, br&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">  Connection: <span class="string">&quot;keep-alive&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Content-Length&quot;</span>: <span class="string">&quot;96&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>,</span><br><span class="line">  Cookie: <span class="string">&quot;xxxxxxxxxxx&quot;</span>,</span><br><span class="line">  Host: <span class="string">&quot;mp.weixin.qq.com&quot;</span>,</span><br><span class="line">  Origin: <span class="string">&quot;https://mp.weixin.qq.com&quot;</span>,</span><br><span class="line">  Referer: <span class="string">&quot;https://mp.weixin.qq.com/wxamp/wxaalarm/get_jserr?token=730361255&amp;lang=zh_CN&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Sec-Fetch-Dest&quot;</span>: <span class="string">&quot;empty&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Sec-Fetch-Mode&quot;</span>: <span class="string">&quot;cors&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Sec-Fetch-Site&quot;</span>: <span class="string">&quot;same-origin&quot;</span>,</span><br><span class="line">  <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.113 Safari/537.36&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">runBug</span>(<span class="params">pageNum = <span class="number">1</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> superagent</span><br><span class="line">    .post(<span class="string">`https://mp.weixin.qq.com/wxamp/cgi/route?path=xxx&amp;token=xxx&amp;lang=zh_CN&amp;random=<span class="subst">$&#123;<span class="built_in">Math</span>.random()&#125;</span>`</span>)</span><br><span class="line">    <span class="comment">// è¯·æ±‚æ‰€æºå¸¦çš„å‚æ•°</span></span><br><span class="line">    <span class="comment">// start_time å¼€å§‹æ—¶é—´</span></span><br><span class="line">    <span class="comment">// end_time ç»“æŸæ—¶é—´</span></span><br><span class="line">    <span class="comment">// start é¡µæ•°æ—¶é—´</span></span><br><span class="line">    <span class="comment">// limit æ¯é¡µæ¡æ•°</span></span><br><span class="line">    .send(&#123; <span class="attr">errmsg_keyword</span>: <span class="string">&quot;&quot;</span>, <span class="attr">type</span>: <span class="number">1</span>, <span class="attr">client_version</span>: <span class="string">&quot;&quot;</span>, <span class="attr">start_time</span>: process.argv[<span class="number">2</span>], <span class="attr">end_time</span>: process.argv[<span class="number">3</span>], <span class="attr">start</span>: pageNum, <span class="attr">limit</span>: <span class="number">5</span> &#125;)</span><br><span class="line">    .set(<span class="string">&quot;Cookie&quot;</span>, configs[<span class="string">&quot;Cookie&quot;</span>])</span><br><span class="line">    .set(<span class="string">&quot;Host&quot;</span>, configs[<span class="string">&quot;Host&quot;</span>])</span><br><span class="line">    .set(<span class="string">&quot;Origin&quot;</span>, configs[<span class="string">&quot;Origin&quot;</span>])</span><br><span class="line">    .set(<span class="string">&quot;Sec-Fetch-Dest&quot;</span>, configs[<span class="string">&quot;Sec-Fetch-Dest&quot;</span>])</span><br><span class="line">    .set(<span class="string">&quot;Sec-Fetch-Mode&quot;</span>, configs[<span class="string">&quot;Sec-Fetch-Mode&quot;</span>])</span><br><span class="line">    .set(<span class="string">&quot;Sec-Fetch-Site&quot;</span>, configs[<span class="string">&quot;Sec-Fetch-Site&quot;</span>])</span><br><span class="line">    .set(<span class="string">&quot;User-Agent&quot;</span>, configs[<span class="string">&quot;User-Agent&quot;</span>])</span><br><span class="line">    .set(<span class="string">&quot;Accept&quot;</span>, configs[<span class="string">&quot;Accept&quot;</span>])</span><br><span class="line">    .set(<span class="string">&quot;Accept-Encoding&quot;</span>, configs[<span class="string">&quot;Accept-Encoding&quot;</span>])</span><br><span class="line">    .set(<span class="string">&quot;Accept-Language&quot;</span>, configs[<span class="string">&quot;Accept-Language&quot;</span>])</span><br><span class="line">    .set(<span class="string">&quot;Connection&quot;</span>, configs[<span class="string">&quot;Connection&quot;</span>])</span><br><span class="line">    .set(<span class="string">&quot;Content-Length&quot;</span>, configs[<span class="string">&quot;Content-Length&quot;</span>])</span><br><span class="line">    .set(<span class="string">&quot;Content-Type&quot;</span>, configs[<span class="string">&quot;Content-Type&quot;</span>])</span><br><span class="line">    .set(<span class="string">&quot;Referer&quot;</span>, configs[<span class="string">&quot;Referer&quot;</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç„¶åå¯ä»¥çœ‹åˆ°æ¥å£è¯·æ±‚æˆåŠŸäº†ï¼</li></ul><p><img src="/assets/20200903-feishu-bug-collection/img7.png"></p><ul><li>æ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯æ ¹æ®æ¯ä½åŒå­¦è´Ÿè´£çš„é¡¹ç›®å•ç‹¬æŸ¥æ‰¾æŠ¥é”™ä¿¡æ¯ï¼Œå¹¶ç”Ÿæˆ excelï¼ˆæ¯ä½åŒå­¦ä¸€ä¸ª sheet,å¦‚æœæŸä¸ªæŠ¥é”™ä¸å±äºä»»ä½•ä¸€ä¸ªäººçš„è¯ï¼Œç›´æ¥æ”¾åˆ°å…¶ä»–ä¸­ï¼‰,è¿™é‡Œå°±ä½¿ç”¨åˆ°äº†<a href="https://www.npmjs.com/package/xlsx">xlsx</a>äº†ï¼Œæ ¹ç»</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> XLSX = <span class="built_in">require</span>(<span class="string">&quot;xlsx&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//excelé‡Œçš„sheetç¬¬ä¸€è¡Œ</span></span><br><span class="line"><span class="keyword">const</span> basic = [<span class="string">&quot;æ—¶é—´&quot;</span>, <span class="string">&quot;å®¢æˆ·ç«¯ç‰ˆæœ¬&quot;</span>, <span class="string">&quot;å°ç¨‹åºç‰ˆæœ¬&quot;</span>, <span class="string">&quot;ç‰ˆæœ¬é”™è¯¯æ¬¡æ•°&quot;</span>, <span class="string">&quot;æ€»é”™è¯¯æ¬¡æ•°&quot;</span>, <span class="string">&quot;é”™è¯¯å†…å®¹&quot;</span>, <span class="string">&quot;å¤‡æ³¨ï¼ˆæœ‰ç‰¹æ®Šæƒ…å†µçš„ï¼Œè¯´æ˜å…·ä½“åŸå› ï¼ï¼‰&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> member = &#123;</span><br><span class="line">  a: &#123;</span><br><span class="line">    pages: [<span class="string">&quot;pages/a1&quot;</span>, <span class="string">&quot;pages/a2&quot;</span>], <span class="comment">// é¡µé¢è·¯ç”±</span></span><br><span class="line">    result: [basic], <span class="comment">// åŒ¹é…é›†åˆ</span></span><br><span class="line">  &#125;,</span><br><span class="line">  b: &#123;</span><br><span class="line">    pages: [<span class="string">&quot;pages/b1&quot;</span>, <span class="string">&quot;pages/b2&quot;</span>],</span><br><span class="line">    result: [basic]</span><br><span class="line">  &#125;</span><br><span class="line">  å…¶ä»–: &#123; <span class="attr">result</span>: [basic] &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">runBug</span>(<span class="params">pageNum = <span class="number">1</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> res = æ¥å£è¿”å›çš„æ•°æ®</span><br><span class="line">  <span class="keyword">if</span> (res.body.results &amp;&amp; res.body.results.length) &#123;</span><br><span class="line">    <span class="comment">// éå†æŠ¥é”™ä¿¡æ¯é›†åˆ</span></span><br><span class="line">    results: <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; res.body.results.length; i++) &#123;</span><br><span class="line">      <span class="comment">// éå†æˆå‘˜é›†åˆ</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> w = <span class="number">0</span>; w &lt; memberKey.length - <span class="number">1</span>; w++) &#123;</span><br><span class="line">        <span class="comment">// éå†æˆå‘˜çš„è·¯ç”±</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> v = <span class="number">0</span>; v &lt; member[memberKey[w]].pages.length; v++) &#123;</span><br><span class="line">          <span class="comment">// åˆ¤æ–­æŠ¥é”™ä¿¡æ¯ä¸æˆå‘˜è´Ÿè´£çš„é¡µé¢è·¯ç”±æ˜¯å¦åŒ¹é…</span></span><br><span class="line">          <span class="keyword">if</span> (res.body.results[i].errmsg.indexOf(member[memberKey[w]].pages[v]) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            member[memberKey[w]].result.push([format(res.body.results[i].time), res.body.results[i].client_version, res.body.results[i].app_version, res.body.results[i].version_error_cnt, res.body.results[i].total_error_cnt, res.body.results[i].errmsg]);</span><br><span class="line">            <span class="keyword">continue</span> results;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// æ²¡æœ‰åŒ¹é…ä¸Šä»»ä½•æˆå‘˜çš„è·¯ç”±ï¼Œåˆ™é»˜è®¤æ”¾åˆ°â€œå…¶ä»–â€sheetä¸‹é¢ï¼Œç»Ÿä¸€ç®¡ç†</span></span><br><span class="line">      member[<span class="string">&quot;å…¶ä»–&quot;</span>].result.push([format(res.body.results[i].time), res.body.results[i].client_version, res.body.results[i].app_version, res.body.results[i].version_error_cnt, res.body.results[i].total_error_cnt, res.body.results[i].errmsg], <span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    runBug(++pageNum); <span class="comment">// å½“å‰é¡µé¢æŸ¥è¯¢å®Œæ¯•ï¼Œæ¥ç€æŸ¥è¯¢ä¸‹ä¸€é¡µï¼Œç›´åˆ°æ²¡æœ‰å†…å®¹ä½ç½®</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> wb = XLSX.utils.book_new();</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; memberKey.length; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> ws = XLSX.utils.aoa_to_sheet(member[memberKey[i]].result);</span><br><span class="line">        XLSX.utils.book_append_sheet(wb, ws, memberKey[i]);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">await</span> XLSX.writeFile(wb, <span class="string">`<span class="subst">$&#123;format(+process.argv[<span class="number">2</span>]) + <span class="string">&quot;-&quot;</span> + format(+process.argv[<span class="number">3</span>]) + <span class="string">&quot;é”™è¯¯ç»Ÿè®¡&quot;</span>&#125;</span>.xlsx`</span>); <span class="comment">// ç”Ÿæˆexcelæ–‡ä»¶åˆ°å½“å‰ç›®å½•ä¸­</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç„¶åæˆ‘ä»¬æ‰“å¼€ excelï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„</li></ul><p><img src="/assets/20200903-feishu-bug-collection/img8.png"></p><h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><ul><li>ç›®å‰çš„å¼€å‘è®¾è®¡åœ¨æœ¬åœ°ï¼Œå‘ç»™æ¯ä¸ªäººå»æ›´æ”¹ï¼Œç„¶ååœ¨åé¦ˆç»Ÿè®¡ï¼Œæ˜¾ç„¶æ˜¯ä¸å¤ªåˆç†;æˆ‘æƒ³è¦çš„æ˜¯å¤šäººåœ¨çº¿åä½œæ›´æ”¹ï¼Œå®æ—¶åé¦ˆï¼Œç›®å‰æœ‰ä¸¤ä¸ªè§£å†³æ–¹æ¡ˆï¼›<ul><li><u> 1ã€é€šè¿‡é£ä¹¦å¼€æ”¾å¹³å°æä¾›çš„<a href="https://open.f.mioffice.cn/document/ukTMukTMukTM/uADN14CM0UjLwQTN">api</a>ä¸Šä¼ (ä¸è¿‡ç›®å‰å…¬å¸æ­å»ºçš„é£ä¹¦æœåŠ¡è¿™ä¸ªæ–¹æ³•ä¸èƒ½ä½¿ç”¨äº†ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºå•¥~~) </u></li><li><u> 2ã€é€šè¿‡é£ä¹¦å®¢æˆ·ç«¯æ‰‹åŠ¨ä¸Šä¼ ï¼Œæ­¤æ–¹æ³•ç®€å•ç›´æ¥ç‚¹å‡»é€‰æ‹©å°±è¡Œäº† </u></li></ul></li></ul><p><img src="/assets/20200903-feishu-bug-collection/img9.png"></p><p><img src="/assets/20200903-feishu-bug-collection/img10.png"></p><ul><li>ä¸Šä¼ åï¼Œç»“æ„æ˜¯ä¹±çš„ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è½¬ä¸ºåœ¨çº¿è¡¨æ ¼æ‰è¡Œ</li></ul><p><img src="/assets/20200903-feishu-bug-collection/img11.png"></p><ul><li>è¿™æ ·å°±æ˜¯æˆ‘ä»¬æœ€ç»ˆæƒ³è¦çš„æœ€ç»ˆç»“æœå•¦<del>~</del></li></ul><p><img src="/assets/20200903-feishu-bug-collection/img12.png"></p>]]></content>
      
      
      <categories>
          
          <category> node </category>
          
      </categories>
      
      
        <tags>
            
            <tag> çˆ¬è™« </tag>
            
            <tag> é£ä¹¦æ–‡æ¡£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é£ä¹¦æœºå™¨äºº--å‰ç«¯æ–‡ç« æ¨é€</title>
      <link href="/2020/09/02/20200902-feishu-robot/"/>
      <url>/2020/09/02/20200902-feishu-robot/</url>
      
        <content type="html"><![CDATA[<h2 id="ç›®çš„"><a href="#ç›®çš„" class="headerlink" title="ç›®çš„"></a>ç›®çš„</h2><p>æ¯æ—¥æ¨é€æ–°é²œçš„å‰ç«¯å­¦ä¹ èµ„æ–™ï¼Œä¾›å¤§å®¶é˜…è¯»ã€å­¦ä¹ ç­‰ï¼›</p><h2 id="æŠ€æœ¯æ ˆ"><a href="#æŠ€æœ¯æ ˆ" class="headerlink" title="æŠ€æœ¯æ ˆ"></a>æŠ€æœ¯æ ˆ</h2><p>nodeï¼ˆsuperagentã€cheerio ç­‰ï¼‰+ è…¾è®¯äº‘äº‘å‡½æ•°</p><h2 id="å¼€å‘æµç¨‹"><a href="#å¼€å‘æµç¨‹" class="headerlink" title="å¼€å‘æµç¨‹"></a>å¼€å‘æµç¨‹</h2><p><em>æ³¨ï¼šå¦‚æœæ˜¯è‡ªå·±å…¬å¸æ­å»ºçš„é£ä¹¦ç§æœçš„è¯ï¼Œåˆ™éœ€è¦æŒ‰ç…§ç§æœçš„æ–‡æ¡£è¿›è¡Œå¼€å‘å³å¯</em></p><ul><li>è¿›å…¥é£ä¹¦å¼€å‘å¹³å°<a href="https://open.feishu.cn/">æˆ‘çš„åº”ç”¨</a>ä¸­ç”³è¯·æ³¨å†Œä¸€ä¸ª APPï¼Œç„¶åç³»ç»Ÿä¼šç»™åˆ†é…ä¸€ä¸ª appid ä»¥åŠ appsecret ç”¨äºåç»­æ ¡éªŒã€è®¤è¯é€»è¾‘ï¼›</li></ul><p><img src="/assets/20200902-robot/img1.png"></p><ul><li>åœ¨é£ä¹¦ç¾¤èŠä¸­æ·»åŠ æ‰€åˆ›å»ºçš„æœºå™¨äººï¼›</li></ul><p><img src="/assets/20200902-robot/img2.png"></p><ul><li>æ‰“å¼€é£ä¹¦å¼€å‘å¹³å°<a href="https://open.feishu.cn/document/ukTMukTMukTM/uIjNz4iM2MjLyYzM">æœåŠ¡ç«¯ API</a>ï¼Œå»è·å–åº”ç”¨çš„ tenant_access_tokenï¼Œç”¨ä½œ APP çš„è®¤è¯æ ‡è¯†(æ‰€æœ‰è¯·æ±‚éƒ½éœ€è¦æ­¤æ ‡è¯†ä½œä¸ºè®¤è¯ä¾æ®)ï¼›</li></ul><p><img src="/assets/20200902-robot/img3.png"></p><ul><li>è·å–æ‰€æœ‰æ·»åŠ æœºå™¨äººçš„ç¾¤åˆ—è¡¨ï¼Œç”¨äºæŒ‡å®šç¾¤å‘é€ä¿¡æ¯ï¼›</li></ul><p><img src="/assets/20200902-robot/img4.png"></p><ul><li>å‡†å¤‡å·¥ä½œå®Œæˆåï¼Œå¯ä»¥å¼€å§‹å‘é€æ¶ˆæ¯æ¨é€äº†ï¼Œæˆ‘è¿™è¾¹é€‰æ‹©çš„æ˜¯å‘é€å¯Œæ–‡æœ¬æ¶ˆæ¯çš„æ¨¡å¼ï¼Œå› ä¸ºå‘é€ç§ç±»å¤šï¼ŒåŠŸèƒ½å¼ºå¤§ï¼›</li></ul><p><img src="/assets/20200902-robot/img5.png"></p><ul><li>å‘é€åˆ°ç¾¤é‡Œçš„æ¶ˆæ¯å¤§è‡´é•¿è¿™æ ·ï¼šå› ä¸ºç›®å‰æ˜¯æµ‹è¯•ï¼Œä¸æ˜¯çœŸå®æ•°æ®ï¼Œä¸‹é¢ä¼šç”¨åˆ°çœŸå®æ•°æ®ï¼›</li></ul><p><img src="/assets/20200902-robot/img6.png"></p><h2 id="çˆ¬è™«ï¼ˆæ¥å£ã€é¡µé¢ï¼‰"><a href="#çˆ¬è™«ï¼ˆæ¥å£ã€é¡µé¢ï¼‰" class="headerlink" title="çˆ¬è™«ï¼ˆæ¥å£ã€é¡µé¢ï¼‰"></a>çˆ¬è™«ï¼ˆæ¥å£ã€é¡µé¢ï¼‰</h2><p>ä¸Šé¢å·²ç»å®ç°äº†æ¶ˆæ¯çš„æ¨é€ï¼Œä½†æ˜¯æ•°æ®æ˜¯å‡çš„ï¼Œæ—¥å¸¸å·¥ä½œä¸­æˆ‘ä»¬è‚¯å®šæƒ³è¦é˜…è¯»é«˜è´¨é‡ã€æ ‡å‡†çš„æ–‡ç« ï¼Œæ‰€ä»¥è¦æ‹¿åˆ°å¥½çš„æ•°æ®æºï¼Œè¿™è¾¹é€‰æ‹©çš„æ˜¯<a href="https://web-api.juejin.im/query">æ˜é‡‘çš„ API</a>ä½œä¸ºæ•°æ®æºï¼›ä½¿ç”¨<a href="https://www.npmjs.com/package/superagent">superagent</a>çˆ¬å–æ¥å£æ•°æ®ï¼Œä½¿ç”¨<a href="https://www.npmjs.com/package/cheerio">cheerio</a>çˆ¬å–é¡µé¢æ•°æ®ï¼Œæœ€ç»ˆå±•ç¤ºçš„æ•ˆæœä¸ºï¼š</p><p><img src="/assets/20200902-robot/img7.png"></p><p><img src="/assets/20200902-robot/img8.png"></p><h2 id="éƒ¨ç½²ï¼ˆè…¾è®¯äº‘äº‘å‡½æ•°ï¼‰"><a href="#éƒ¨ç½²ï¼ˆè…¾è®¯äº‘äº‘å‡½æ•°ï¼‰" class="headerlink" title="éƒ¨ç½²ï¼ˆè…¾è®¯äº‘äº‘å‡½æ•°ï¼‰"></a>éƒ¨ç½²ï¼ˆè…¾è®¯äº‘äº‘å‡½æ•°ï¼‰</h2><p><u>ç›®å‰ä»£ç åªæ˜¯è¿è¡Œåœ¨æœ¬åœ°ï¼Œè¿™æ ·è‚¯å®šä¸è¡Œï¼Œéœ€è¦è·‘åœ¨æœåŠ¡å™¨ä¸­ï¼Œè€Œä¸”æˆ‘çš„éœ€æ±‚æ˜¯æ¯å¤©æ—©æ™šéœ€è¦æ¨é€ä¸€æ¬¡ï¼Œè¿™å°±è¦ç”¨åˆ°å®šæ—¶ä»»åŠ¡äº†ï¼Œæ‰€ä»¥æˆ‘è¿™è¾¹é€‰æ‹©äº†è…¾è®¯äº‘äº‘å‡½æ•°éƒ¨ç½²ï¼Œä¾æ‰˜äº†è…¾è®¯äº‘ï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨ä»£ç çš„å¼€å‘ï¼Œæ–¹ä¾¿ã€å¿«æ·ä¸”æ”¶è´¹å¾ˆä¾¿å®œ;</u></p><p><img src="/assets/20200902-robot/img9.png"></p><p><img src="/assets/20200902-robot/img10.png"></p><ul><li>æˆ‘è¿™è¾¹é€‰æ‹©çš„æ˜¯ node8.9ã€ç©ºç™½æ¨¡æ¿ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©æ›´é«˜çš„ç‰ˆæœ¬ä»¥åŠä¸åŒè¯­è¨€çš„æ¨¡æ¿å‡½æ•°ï¼›</li></ul><p><img src="/assets/20200902-robot/img11.png"></p><p><img src="/assets/20200902-robot/img12.png"></p><ul><li>ä¼ å»ºå®Œæˆåï¼š</li></ul><p><img src="/assets/20200902-robot/img13.png"></p><ul><li>æˆ‘ä»¬å¯ä»¥åœ¨çº¿ç¼–è¾‘ä»£ç æˆ–è€…é€‰æ‹© zip ä¸Šä¼ ä»£ç ï¼š</li></ul><p><img src="/assets/20200902-robot/img14.png"></p><p><u>æ³¨ï¼šè¿™è¾¹éœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬çš„ä»£ç æ‰§è¡Œé€»è¾‘å¿…é¡»åŒ…å«åœ¨ index.main_handler è¿™ä¸ªå‡½æ•°ä¸­ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå®šä¹‰å‡½æ•°åå“ˆï¼‰ï¼Œä¸”æœ€åæ‰§è¡Œçš„ç»“æœå¿…é¡»è¿”å›ä¸€ä¸ª promise å¯¹è±¡ï¼Œä¸ç„¶äº‘å‡½æ•°ä¸èƒ½è¯†åˆ«ï¼›</u></p><ul><li><p>ä¸Šä¼ å®Œåç‚¹å‡»ä¿å­˜ï¼Œå°±æå®šäº†ï¼›</p></li><li><p>æœ€åç‚¹å‡»è§¦å‘ä¿¡æ¯æ·»åŠ å®šæ—¶ä»»åŠ¡</p></li></ul><p><img src="/assets/20200902-robot/img15.png"></p><ul><li>æˆ‘é€‰æ‹©çš„æ˜¯è‡ªå®šä¹‰è§¦å‘ä»»åŠ¡ï¼Œå› ä¸ºæˆ‘æƒ³ 9 ç‚¹åŠè§¦å‘ä¸€æ¬¡ï¼Œå®šæ—¶ä»»åŠ¡çš„è¯­æ³•ä½¿ç”¨çš„æ˜¯ cron è¡¨è¾¾å¼ï¼Œæœ€åç‚¹å‡»æäº¤å³å¯ï¼›</li></ul><p><img src="/assets/20200902-robot/img16.png"></p><p><img src="/assets/20200902-robot/img17.png"></p><p>å¯ä»¥çœ‹åˆ°æ¯å¤© 9 ç‚¹åŠå‡†æ—¶æ¨é€äº†ï¼</p><p><img src="/assets/20200902-robot/img18.png"></p><p>åˆ°æ­¤æˆ‘ä»¬çš„å¼€å‘å°±å®Œæˆäº†ï¼</p><h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><p>é™¤äº†ä¸Šè¿°é€šè¿‡è°ƒç”¨æ¥å£çš„æ–¹å¼å‘é€æ¨é€å¤–ï¼Œé£ä¹¦è¿˜æä¾›äº† Webhookï¼ˆç½‘ç»œé’©å­ï¼‰çš„æ–¹å¼å‘é€æ¨é€ï¼Œä¸è¿‡åŠŸèƒ½è¿‡äºå•ä¸€ï¼Œä¸å¤ªå¥½ç”¨ï¼›</p><p><img src="/assets/20200902-robot/img19.png"></p>]]></content>
      
      
      <categories>
          
          <category> node </category>
          
      </categories>
      
      
        <tags>
            
            <tag> çˆ¬è™« </tag>
            
            <tag> serverless </tag>
            
            <tag> serverlessï¼ˆäº‘å‡½æ•°ï¼‰ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue Composition API é™·é˜±</title>
      <link href="/2020/09/01/20200901-Composition-API/"/>
      <url>/2020/09/01/20200901-Composition-API/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è‡ªä» React Hooks å‡ºç°ä¹‹åï¼Œæ‰¹è¯„çš„å£°éŸ³ä¸æ–­ï¼Œå¾ˆå¤šäººè¯´å®ƒå¸¦æ¥äº†å¿ƒæ™ºè´Ÿæ‹…ï¼Œå› ä¸ºç›¸æ¯”ä¼ ç»Ÿçš„ Class å†™æ³•ï¼ŒuseState/useEffect çš„ä¾èµ–äºæ‰§è¡Œé¡ºåºçš„ç‰¹ç‚¹è®©äººæ‰æ‘¸ä¸é€ã€‚ä¸æ­¤ç›¸å¯¹çš„ï¼Œåœ¨ Vue3 Composition API RFC ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ° Vue3 å®˜æ–¹æè¿° CompositionAPI æ˜¯ä¸€ä¸ªåŸºäºå·²æœ‰çš„â€å“åº”å¼â€å¿ƒæ™ºæ¨¡å‹çš„æ›´å¥½æ–¹æ¡ˆï¼Œè¿™è®©æˆ‘ä»¬è§‰å¾—å¥½åƒä¸éœ€è¦ä»»ä½•å¿ƒæ™ºæ¨¡å‹çš„åˆ‡æ¢å°±å¯ä»¥è¿…é€ŸæŠ•å…¥åˆ° Compositoin API çš„å¼€å‘ä¸­å»ã€‚ä½†åœ¨æˆ‘å°è¯•äº†ä¸€æ®µæ—¶é—´åï¼Œå‘ç°äº‹å®å¹¶éå¦‚æ­¤ï¼Œæˆ‘ä»¬ä¾ç„¶éœ€è¦ä¸€äº›æ€ç»´ä¸Šçš„å˜åŒ–æ¥é€‚åº”æ–°çš„ Compsition APIã€‚</p><h2 id="Setup-é™·é˜±"><a href="#Setup-é™·é˜±" class="headerlink" title="Setup é™·é˜±"></a>Setup é™·é˜±</h2><h3 id="ç®€å•é™·é˜±"><a href="#ç®€å•é™·é˜±" class="headerlink" title="ç®€å•é™·é˜±"></a>ç®€å•é™·é˜±</h3><p>å…ˆçœ‹ä¸€ä¸ª Vue2 ç®€å•ä¾‹å­ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">  &lt;div id=<span class="string">&quot;app&quot;</span>&gt;</span><br><span class="line">    &#123;&#123;count&#125;&#125;</span><br><span class="line">    &lt;button @click=<span class="string">&quot;addCount&quot;</span>&gt;&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt; <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">   <span class="keyword">return</span> &#123;</span><br><span class="line">     count: <span class="number">0</span></span><br><span class="line">   &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">   addCount() &#123;</span><br><span class="line">     <span class="built_in">this</span>.count += <span class="number">1</span></span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>åœ¨ Vue2 çš„å¿ƒæ™ºæ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬æ€»ä¼šåœ¨ data ä¸­è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬å¹¶ä¸å…³å¿ƒå¯¹è±¡çš„å€¼æ˜¯ç®€å•ç±»å‹è¿˜æ˜¯å¼•ç”¨ç±»å‹ï¼Œå› ä¸ºå®ƒä»¬éƒ½èƒ½å¾ˆå¥½çš„è¢«å“åº”å¼ç³»ç»Ÿå¤„ç†ï¼Œå°±åƒä¸Šé¢è¿™ä¸ªä¾‹å­ä¸€æ ·ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä¸ä½œä»»ä½•å¿ƒæ™ºæ¨¡å‹çš„å˜åŒ–ï¼Œå°±å¼€å§‹ä½¿ç”¨ Composition APIï¼Œæˆ‘ä»¬å°±å®¹æ˜“å†™å‡ºè¿™æ ·çš„ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"> &lt;div id=<span class="string">&quot;app&quot;</span>&gt;</span><br><span class="line">   &#123;&#123;count&#125;&#125;</span><br><span class="line">   &lt;button @click=<span class="string">&quot;addCount&quot;</span>&gt;&lt;/button&gt;</span><br><span class="line"> &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; reactive &#125; <span class="keyword">from</span> <span class="string">&#x27;@vue/runtime-dom&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"> setup() &#123;</span><br><span class="line">   <span class="keyword">const</span> data = reactive(&#123;</span><br><span class="line">     count: <span class="number">0</span></span><br><span class="line">   &#125;)</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">addCount</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">     data.count += <span class="number">1</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> &#123;</span><br><span class="line">     count: data.count,</span><br><span class="line">     addCount</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;; &lt;/script&gt;</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼Œè¿™æ®µä»£ç ä¸èƒ½æ­£å¸¸è¿ä½œï¼Œå½“ä½ ç‚¹å‡» button æ—¶ï¼Œè§†å›¾ä¸ä¼šå“åº”æ•°æ®å˜åŒ–ã€‚åŸå› æ˜¯ï¼Œæˆ‘ä»¬å…ˆå°† data ä¸­çš„ count å–äº†å‡ºæ¥ï¼Œå†åˆå¹¶åˆ° this.$data ä¸­ï¼Œä½†æ˜¯ä¸€æ—¦ count è¢«å–å‡ºæ¥ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå•çº¯çš„ç®€å•ç±»å‹æ•°æ®ï¼Œå“åº”å¼å°±ä¸¢äº†ã€‚</p><h3 id="å¤æ‚é™·é˜±"><a href="#å¤æ‚é™·é˜±" class="headerlink" title="å¤æ‚é™·é˜±"></a>å¤æ‚é™·é˜±</h3><p>æ•°æ®ç»“æ„è¶Šå¤æ‚ï¼Œæˆ‘ä»¬å°±è¶Šå®¹æ˜“è½å…¥é™·é˜±ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬æŠŠä¸€æ®µä¸šåŠ¡é€»è¾‘æŠ½ç¦»åˆ°è‡ªå®šä¹‰ hooks é‡Œï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reactive, onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;@vue/runtime-dom&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useSomeData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">const</span> data = reactive(&#123;</span><br><span class="line">   userInfo: &#123;</span><br><span class="line">     name: <span class="string">&#x27;default_name&#x27;</span>,</span><br><span class="line">     role: <span class="string">&#x27;default_role&#x27;</span></span><br><span class="line">   &#125;,</span><br><span class="line">   projectList: []</span><br><span class="line"> &#125;)</span><br><span class="line"></span><br><span class="line"> onMounted(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">   <span class="comment">// å¼‚æ­¥è·å–æ•°æ®</span></span><br><span class="line">   fetch(...).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">const</span> &#123; userInfo, projectList &#125; = result</span><br><span class="line">     data.userInfo = userInfo</span><br><span class="line">     data.projectList = projectList</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååƒå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬åœ¨ä¸šåŠ¡ç»„ä»¶ä¸­å»ä½¿ç”¨ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"> &lt;div&gt;</span><br><span class="line">   &#123;&#123;name&#125;&#125;</span><br><span class="line">   &#123;&#123;role&#125;&#125;</span><br><span class="line">   &#123;&#123;list&#125;&#125;</span><br><span class="line"> &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt; <span class="keyword">import</span> useSomeData <span class="keyword">from</span> <span class="string">&#x27;./useSomeData&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"> setup() &#123;</span><br><span class="line">   <span class="keyword">const</span> &#123; userInfo, projectList &#125; = useSomeData()</span><br><span class="line">   <span class="keyword">return</span> &#123;</span><br><span class="line">     name: userInfo.name <span class="comment">// å“åº”å¼æ–­æ‰</span></span><br><span class="line">     role: userInfo.role, <span class="comment">// å“åº”å¼æ–­æ‰</span></span><br><span class="line">     list: projectList <span class="comment">// å“åº”å¼è¿˜æ˜¯æ–­æ‰</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125; &lt;/script&gt;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œä¸ç®¡æˆ‘ä»¬ä»å“åº”å¼æ•°æ®é‡Œå–å‡ºä»€ä¹ˆï¼ˆç®€å•ç±»å‹ or å¼•ç”¨ç±»å‹ï¼‰ï¼Œéƒ½ä¼šå¯¼è‡´å“åº”å¼æ–­æ‰ï¼Œè¿›è€Œæ— æ³•æ›´æ–°è§†å›¾ã€‚</p><p>æ‰€æœ‰è¿™äº›é—®é¢˜çš„æ ¹æºéƒ½æ˜¯ï¼š<strong>setup åªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚</strong></p><h2 id="è¿ç§»åˆ°æ–°çš„å¿ƒæ™ºæ¨¡å‹"><a href="#è¿ç§»åˆ°æ–°çš„å¿ƒæ™ºæ¨¡å‹" class="headerlink" title="è¿ç§»åˆ°æ–°çš„å¿ƒæ™ºæ¨¡å‹"></a>è¿ç§»åˆ°æ–°çš„å¿ƒæ™ºæ¨¡å‹</h2><ol><li>æ—¶åˆ»è®°ä½ setup åªä¼šæ‰§è¡Œä¸€æ¬¡</li><li>æ°¸è¿œä¸è¦ç›´æ¥ä½¿ç”¨ç®€å•ç±»å‹</li><li>è§£æ„å¯èƒ½æœ‰é£é™©ï¼Œä¼˜å…ˆä½¿ç”¨å¼•ç”¨æœ¬èº«ï¼Œè€Œä¸æ˜¯è§£æ„å®ƒ</li><li>å¯ä»¥é€šè¿‡ä¸€äº›æ‰‹æ®µè®©è§£æ„å˜å¾—å®‰å…¨</li></ol><h3 id="ä½¿ç”¨æ–°å¿ƒæ™ºæ¨¡å‹æ¥è§£å†³é—®é¢˜"><a href="#ä½¿ç”¨æ–°å¿ƒæ™ºæ¨¡å‹æ¥è§£å†³é—®é¢˜" class="headerlink" title="ä½¿ç”¨æ–°å¿ƒæ™ºæ¨¡å‹æ¥è§£å†³é—®é¢˜"></a>ä½¿ç”¨æ–°å¿ƒæ™ºæ¨¡å‹æ¥è§£å†³é—®é¢˜</h3><p>ç®€å•é™·é˜±ï¼šæ°¸è¿œä¸è¦ç›´æ¥ä½¿ç”¨ç®€å•ç±»å‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"> &lt;div id=<span class="string">&quot;app&quot;</span>&gt;</span><br><span class="line">   &#123;&#123;count&#125;&#125;</span><br><span class="line">   &lt;button @click=<span class="string">&quot;addCount&quot;</span>&gt;&lt;/button&gt;</span><br><span class="line"> &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt; <span class="keyword">import</span> &#123; reactive, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;@vue/runtime-dom&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"> setup() &#123;</span><br><span class="line">   <span class="keyword">const</span> count = ref(<span class="number">0</span>) <span class="comment">// åœ¨è¿™é‡Œä½¿ç”¨refåŒ…è£¹ä¸€å±‚å¼•ç”¨å®¹å™¨</span></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">addCount</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">     count.value += <span class="number">1</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> &#123;</span><br><span class="line">     count,</span><br><span class="line">     addCount</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;; &lt;/script&gt;</span><br></pre></td></tr></table></figure><p>å¤æ‚é™·é˜±-æ–¹æ¡ˆ 1ï¼šè§£æ„å¯èƒ½æœ‰é£é™©ï¼Œä¼˜å…ˆä½¿ç”¨å¼•ç”¨æœ¬èº«ï¼Œè€Œä¸æ˜¯è§£æ„å®ƒ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"> &lt;div&gt;</span><br><span class="line">   &#123;&#123;someData.userInfo.name&#125;&#125;</span><br><span class="line">   &#123;&#123;someData.userInfo.role&#125;&#125;</span><br><span class="line">   &#123;&#123;someData.projectList&#125;&#125;</span><br><span class="line"> &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt; <span class="keyword">import</span> useSomeData <span class="keyword">from</span> <span class="string">&#x27;./useSomeData&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"> setup() &#123;</span><br><span class="line">   <span class="keyword">const</span> someData = useSomeData()</span><br><span class="line">   <span class="keyword">return</span> &#123;</span><br><span class="line">     someData</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125; &lt;/script&gt;</span><br></pre></td></tr></table></figure><p>å¤æ‚é™·é˜±-æ–¹æ¡ˆ 2ï¼šå¯ä»¥é€šè¿‡ computed è®©è§£æ„å˜å¾—å®‰å…¨</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reactive, onMounted, computed &#125; <span class="keyword">from</span> <span class="string">&#x27;@vue/runtime-dom&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useSomeData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">const</span> data = reactive(&#123;</span><br><span class="line">   userInfo: &#123;</span><br><span class="line">     name: <span class="string">&#x27;default_user&#x27;</span>,</span><br><span class="line">     role: <span class="string">&#x27;default_role&#x27;</span></span><br><span class="line">   &#125;,</span><br><span class="line">   projectList: []</span><br><span class="line"> &#125;)</span><br><span class="line"></span><br><span class="line"> onMounted(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">   <span class="comment">// å¼‚æ­¥è·å–æ•°æ®</span></span><br><span class="line">   fetch(...).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">const</span> &#123; userInfo, projectList &#125; = result</span><br><span class="line">     data.userInfo = userInfo</span><br><span class="line">     data.projectList = projectList</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">const</span> userName = computed(<span class="function">() =&gt;</span> data.userInfo.name)</span><br><span class="line"> <span class="keyword">const</span> userRole = computed(<span class="function">() =&gt;</span> data.userinfo.role)</span><br><span class="line"> <span class="keyword">const</span> projectList = computed(<span class="function">() =&gt;</span> data.projectList)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> &#123;</span><br><span class="line">   userName,</span><br><span class="line">   userRole,</span><br><span class="line">   projectList</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"> setup() &#123;</span><br><span class="line">   <span class="keyword">const</span> &#123; userName, userRole, projectList &#125; = useSomeData()</span><br><span class="line">   <span class="keyword">return</span> &#123;</span><br><span class="line">     name: userName <span class="comment">// æ˜¯è®¡ç®—å±æ€§ï¼Œå“åº”å¼ä¸ä¼šæ–­æ‰</span></span><br><span class="line">     role: userRole, <span class="comment">// æ˜¯è®¡ç®—å±æ€§ï¼Œå“åº”å¼ä¸ä¼šæ–­æ‰</span></span><br><span class="line">     list: projectList <span class="comment">// æ˜¯è®¡ç®—å±æ€§ï¼Œå“åº”å¼ä¸ä¼šæ–­æ‰</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤æ‚é™·é˜±-æ–¹æ¡ˆ 3ï¼šæ–¹æ¡ˆ 2 éœ€è¦é¢å¤–å†™ä¸€äº› computed å±æ€§ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ toRefs è®©è§£æ„å˜å¾—å®‰å…¨</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reactive, onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;@vue/runtime-dom&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useSomeData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">const</span> data = reactive(&#123;</span><br><span class="line">   userInfo: &#123;</span><br><span class="line">     name: <span class="string">&#x27;default_user&#x27;</span>,</span><br><span class="line">     role: <span class="string">&#x27;default_role&#x27;</span></span><br><span class="line">   &#125;,</span><br><span class="line">   projectList: []</span><br><span class="line"> &#125;)</span><br><span class="line"></span><br><span class="line"> onMounted(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">   <span class="comment">// å¼‚æ­¥è·å–æ•°æ®</span></span><br><span class="line">   fetch(...).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">const</span> &#123; userInfo, projectList &#125; = result</span><br><span class="line">     data.userInfo = userInfo</span><br><span class="line">     data.projectList = projectList</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;)</span><br><span class="line"> <span class="comment">// ä½¿ç”¨toRefs</span></span><br><span class="line"> <span class="keyword">return</span> toRefs(data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    <span class="comment">// ç°åœ¨userInfoå’ŒprojectListéƒ½å·²ç»è¢«refåŒ…è£¹äº†ä¸€å±‚</span></span><br><span class="line">    <span class="comment">// è¿™å±‚åŒ…è£¹ä¼šåœ¨templateä¸­è‡ªåŠ¨è§£å¼€</span></span><br><span class="line">    <span class="keyword">const</span> &#123; userInfo, projectList &#125; = useSomeData();</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      name: userInfo.value.name, <span class="comment">// ???å¥½äº†å—</span></span><br><span class="line">      role: userInfo.value.role, <span class="comment">// ???å¥½äº†å—</span></span><br><span class="line">      list: projectList, <span class="comment">// ???å¥½äº†å—</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä½ ä»¥ä¸ºè¿™æ ·å°±å¥½äº†å—ï¼Ÿå…¶å®è¿™é‡Œæœ‰ä¸€ä¸ª<strong>é™·é˜±ä¸­çš„é™·é˜±</strong>ï¼šprojectList å¥½äº†ï¼Œä½†æ˜¯ name å’Œ role ä¾ç„¶æ˜¯å“åº”å¼æ–­å¼€çš„çŠ¶æ€ï¼Œå› ä¸º toRefs åªä¼šâ€æµ…â€œåŒ…è£¹ï¼Œå®é™…ä¸Š useSomeData è¿”å›çš„ç»“æœæ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> someData = useSomeData()</span><br><span class="line">â†“</span><br><span class="line">&#123;</span><br><span class="line"> userInfo: &#123;</span><br><span class="line">   value: &#123;</span><br><span class="line">     name: <span class="string">&#x27;...&#x27;</span>, <span class="comment">// ä¾ç„¶æ˜¯ç®€å•ç±»å‹ï¼Œæ²¡æœ‰è¢«åŒ…è£¹</span></span><br><span class="line">     role: <span class="string">&#x27;...&#x27;</span> <span class="comment">// ä¾ç„¶æ˜¯ç®€å•ç±»å‹ï¼Œæ²¡æœ‰è¢«åŒ…è£¹</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;,</span><br><span class="line"> projectList: &#123;</span><br><span class="line">   value: [...]</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼Œæˆ‘ä»¬çš„ useSomeData å¦‚æœæƒ³è¦é€šè¿‡ toRefs å®ç°çœŸæ­£çš„è§£æ„å®‰å…¨ï¼Œéœ€è¦è¿™æ ·å†™ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reactive, onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;@vue/runtime-dom&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useSomeData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> ...</span><br><span class="line"> <span class="comment">// è®©æ¯ä¸€å±‚çº§éƒ½å¥—ä¸€å±‚ref</span></span><br><span class="line"> <span class="keyword">return</span> toRefs(&#123;</span><br><span class="line">   projectList: data.projectList,</span><br><span class="line">   userInfo: toRefs(data.userInfo)</span><br><span class="line"> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å»ºè®®ï¼šä½¿ç”¨è‡ªå®šä¹‰ hooks è¿”å›æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœæ•°æ®çš„å±‚çº§æ¯”è¾ƒç®€å•ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ toRefs åŒ…è£¹ï¼›å¦‚æœæ•°æ®çš„å±‚çº§æ¯”è¾ƒå¤æ‚ï¼Œå»ºè®®ä½¿ç”¨ computedã€‚</p></blockquote><h2 id="ç»•è¿‡é™·é˜±"><a href="#ç»•è¿‡é™·é˜±" class="headerlink" title="ç»•è¿‡é™·é˜±"></a>ç»•è¿‡é™·é˜±</h2><p>ä¸Šè¿°æ“ä½œå…¶å®æ˜¯ Vue å®˜æ–¹ä½¿ç”¨ CompositionAPI çš„æ ‡å‡†æ–¹å¼ï¼Œå› ä¸º CompositionAPI å®Œå…¨å°±æ˜¯æŒ‰ç…§ setup åªä¼šæ‰§è¡Œä¸€æ¬¡è¿›è¡Œè®¾è®¡çš„ã€‚ä½†æ˜¯ä¸å¯å¦è®¤çš„æ˜¯ï¼Œè¿™çš„ç¡®å¸¦æ¥äº†è®¸å¤šå¿ƒæ™ºè´Ÿæ‹…ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¾—ä¸æ—¶åˆ»å…³æ³¨å“åº”å¼æ•°æ®åˆ°åº•èƒ½ä¸èƒ½è§£æ„ï¼Œä¸ç„¶ä¸€ä¸å°å¿ƒå°±å®¹æ˜“è°ƒåˆ°å‘é‡Œã€‚</p><p>å…¶å®æ‰€æœ‰è¿™äº›é—®é¢˜éƒ½å‡ºåœ¨ setup åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰åŠæ³•è§£å†³å‘¢ï¼Ÿæœ‰çš„ï¼Œå¯ä»¥ä½¿ç”¨ JSX æˆ– h çš„å†™æ³•ï¼Œç»•è¿‡ setup åªä¼šæ‰§è¡Œä¸€æ¬¡çš„é—®é¢˜ï¼š</p><p>è¿˜æ˜¯è¿™ä¸ªå­˜åœ¨å®‰å…¨éšæ‚£çš„è‡ªå®šä¹‰ hooksï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reactive, onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;@vue/runtime-dom&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useSomeData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">const</span> data = reactive(&#123;</span><br><span class="line">   userInfo: &#123;</span><br><span class="line">     name: <span class="string">&#x27;default_name&#x27;</span>,</span><br><span class="line">     role: <span class="string">&#x27;default_role&#x27;</span></span><br><span class="line">   &#125;,</span><br><span class="line">   projectList: []</span><br><span class="line"> &#125;)</span><br><span class="line"></span><br><span class="line"> onMounted(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">   <span class="comment">// å¼‚æ­¥è·å–æ•°æ®</span></span><br><span class="line">   fetch(...).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">const</span> &#123; userInfo, projectList &#125; = result</span><br><span class="line">     data.userInfo = userInfo</span><br><span class="line">     data.projectList = projectList</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-JSX-æˆ–-h"><a href="#ä½¿ç”¨-JSX-æˆ–-h" class="headerlink" title="ä½¿ç”¨ JSX æˆ– h"></a>ä½¿ç”¨ JSX æˆ– h</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useSomeData <span class="keyword">from</span> <span class="string">&quot;./useSomeData&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    <span class="keyword">const</span> someData = useSomeData();</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;</span><br><span class="line">        userInfo: &#123; name, role &#125;,</span><br><span class="line">        projectList,</span><br><span class="line">      &#125; = someData;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &#123;name&#125;</span><br><span class="line">          &#123;role&#125;</span><br><span class="line">          &#123;projectList&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      );</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åœ¨ä½¿ç”¨ JSX æˆ– h çš„æ—¶å€™ï¼Œsetup éœ€è¦è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å…¶å®å°±æ˜¯ render å‡½æ•°ï¼Œå®ƒåœ¨æ•°æ®å˜åŒ–æ—¶ä¼šé‡æ–°æ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æŠŠè§£æ„çš„é€»è¾‘æ”¾åˆ° render å‡½æ•°é‡Œï¼Œé‚£ä¹ˆå°±è§£å†³äº† setup åªä¼šæ‰§è¡Œä¸€æ¬¡çš„é—®é¢˜ã€‚</p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>æˆ‘ä»¬å¯èƒ½éœ€è¦ä¸€äº›çº¦å®šï¼Œæ¥çº¦æŸè‡ªå®šä¹‰ hooks çš„ä½¿ç”¨æ–¹å¼ã€‚ä½†æ˜¯å®˜æ–¹å¹¶æ²¡æœ‰ç»™å‡ºï¼Œè¿™å°†å¯¼è‡´æˆ‘ä»¬ hooks ä¼šå†™çš„äº”èŠ±å…«é—¨ï¼Œå¹¶ä¸”æ¼æ´ç™¾å‡ºã€‚ç›®å‰æ¥çœ‹ï¼Œâ€ä¸è¦è§£æ„â€œæ˜¯æœ€å®‰å…¨çš„æ–¹å¼ã€‚</p><p>æˆ‘ä¸“é—¨å°±è¿™ä¸ªé—®é¢˜è¯·æ•™äº† yyx å¤§ä½¬ï¼Œå¤§ä½¬ç»™å‡ºäº†ä¸€ä¸ªâ€çº¦å®šâ€ï¼Œé‚£å°±æ˜¯å°½é‡å°‘ä½¿ç”¨â€œè§£æ„â€ã€‚è¿™æˆ‘ä¹Ÿå¾ˆæ— å¥ˆã€‚å…¶å®æˆ‘æ˜¯å¸Œæœ›å®˜æ–¹èƒ½å¤Ÿç»™å‡ºä¸€ä¸ªå·¥å…·ï¼Œè®©æˆ‘ä»¬å‡å°‘åœ¨è‡ªå®šä¹‰ hooks ä¸­çŠ¯é”™è¯¯çš„å¯èƒ½æ€§ã€‚ï¼ˆtoRefs å…¶å®å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªå·¥å…·ï¼Œä½†æ˜¯å®ƒå¹¶ä¸èƒ½è§£å†³æ‰€æœ‰é—®é¢˜ï¼‰</p><p><a href="https://juejin.im/post/6855473771013226503">åŸæ–‡è¿æ¥</a></p>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue3 </tag>
            
            <tag> Compsition API </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
