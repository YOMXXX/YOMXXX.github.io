<!DOCTYPE html>
<style>
  .s-sticker {
    width: 270px !important;
  }
  .cat-container {
    text-align: right;
  }
</style>
<html lang=zh>
<head><link rel=manifest href=/manifest.json>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="baidu-site-verification" content="code-VvT544WyCE" />
    <meta name="google-site-verification" content="ZRNXbi80HeKdx9200KLTWY1ZplSEg0xudkPXgjAAk0c" />
    <meta name="description" content="前言自从 React Hooks 出现之后，批评的声音不断，很多人说它带来了心智负担，因为相比传统的 Class 写法，useState&#x2F;useEffect 的依赖于执行顺序的特点让人捉摸不透。与此相对的，在 Vue3 Composition API RFC 中，我们看到 Vue3 官方描述 CompositionAPI 是一个基于已有的”响应式”心智模型的更好方案，这让我们觉得好像不需要任何心智">
<meta property="og:type" content="article">
<meta property="og:title" content="Vue Composition API 陷阱">
<meta property="og:url" content="https://yomxxx.github.io/2020/09/01/20200901-Composition-API/index.html">
<meta property="og:site_name" content="辰总的blog">
<meta property="og:description" content="前言自从 React Hooks 出现之后，批评的声音不断，很多人说它带来了心智负担，因为相比传统的 Class 写法，useState&#x2F;useEffect 的依赖于执行顺序的特点让人捉摸不透。与此相对的，在 Vue3 Composition API RFC 中，我们看到 Vue3 官方描述 CompositionAPI 是一个基于已有的”响应式”心智模型的更好方案，这让我们觉得好像不需要任何心智">
<meta property="og:locale">
<meta property="article:published_time" content="2020-09-01T06:25:10.359Z">
<meta property="article:modified_time" content="2020-09-02T02:03:47.614Z">
<meta property="article:author" content="lgc">
<meta property="article:tag" content="vue3">
<meta property="article:tag" content="Compsition API">
<meta name="twitter:card" content="summary">
    
    
        
          
              <link rel="shortcut icon" href="/assets/avatar.jpeg">
          
        
        
          
            <link rel="icon" type="image/png" href="/assets/avatar.jpeg" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/assets/avatar.jpeg">
          
        
    
    <!-- title -->
    <title>Vue Composition API 陷阱</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="辰总的blog" type="application/atom+xml" />
    
<meta name="generator" content="Hexo 5.1.1"></head>


<body class="max-width mx-auto px3 ltr">
  
    <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/YOMXXX">Projects</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2020/09/02/20200902-feishu-robot/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://yomxxx.github.io/2020/09/01/20200901-Composition-API/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://yomxxx.github.io/2020/09/01/20200901-Composition-API/&text=Vue Composition API 陷阱"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://yomxxx.github.io/2020/09/01/20200901-Composition-API/&title=Vue Composition API 陷阱"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://yomxxx.github.io/2020/09/01/20200901-Composition-API/&is_video=false&description=Vue Composition API 陷阱"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Vue Composition API 陷阱&body=Check out this article: https://yomxxx.github.io/2020/09/01/20200901-Composition-API/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://yomxxx.github.io/2020/09/01/20200901-Composition-API/&title=Vue Composition API 陷阱"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://yomxxx.github.io/2020/09/01/20200901-Composition-API/&title=Vue Composition API 陷阱"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://yomxxx.github.io/2020/09/01/20200901-Composition-API/&title=Vue Composition API 陷阱"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://yomxxx.github.io/2020/09/01/20200901-Composition-API/&title=Vue Composition API 陷阱"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://yomxxx.github.io/2020/09/01/20200901-Composition-API/&name=Vue Composition API 陷阱&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://yomxxx.github.io/2020/09/01/20200901-Composition-API/&t=Vue Composition API 陷阱"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Setup-%E9%99%B7%E9%98%B1"><span class="toc-number">2.</span> <span class="toc-text">Setup 陷阱</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E9%99%B7%E9%98%B1"><span class="toc-number">2.1.</span> <span class="toc-text">简单陷阱</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E6%9D%82%E9%99%B7%E9%98%B1"><span class="toc-number">2.2.</span> <span class="toc-text">复杂陷阱</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%81%E7%A7%BB%E5%88%B0%E6%96%B0%E7%9A%84%E5%BF%83%E6%99%BA%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.</span> <span class="toc-text">迁移到新的心智模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B0%E5%BF%83%E6%99%BA%E6%A8%A1%E5%9E%8B%E6%9D%A5%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98"><span class="toc-number">3.1.</span> <span class="toc-text">使用新心智模型来解决问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E9%99%B7%E9%98%B1"><span class="toc-number">4.</span> <span class="toc-text">绕过陷阱</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-JSX-%E6%88%96-h"><span class="toc-number">4.1.</span> <span class="toc-text">使用 JSX 或 h</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E8%AE%B0"><span class="toc-number">5.</span> <span class="toc-text">后记</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
      
        <style>
  #vuepress-cat {
    position: fixed;
    right: 0;
    bottom: 0;
  }
</style>
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="cat-container">
    <canvas id="vuepress-cat" width="200" height="200" class="live2d"></canvas>
  </div>
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Vue Composition API 陷阱
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">辰总的blog</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-09-01T06:25:10.359Z" itemprop="datePublished">2020-09-01</time>
        
      
    </div>

 
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a>
    </div>

 
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/Compsition-API/" rel="tag">Compsition API</a>, <a class="tag-link-link" href="/tags/vue3/" rel="tag">vue3</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>自从 React Hooks 出现之后，批评的声音不断，很多人说它带来了心智负担，因为相比传统的 Class 写法，useState/useEffect 的依赖于执行顺序的特点让人捉摸不透。与此相对的，在 Vue3 Composition API RFC 中，我们看到 Vue3 官方描述 CompositionAPI 是一个基于已有的”响应式”心智模型的更好方案，这让我们觉得好像不需要任何心智模型的切换就可以迅速投入到 Compositoin API 的开发中去。但在我尝试了一段时间后，发现事实并非如此，我们依然需要一些思维上的变化来适应新的 Compsition API。</p>
<h2 id="Setup-陷阱"><a href="#Setup-陷阱" class="headerlink" title="Setup 陷阱"></a>Setup 陷阱</h2><h3 id="简单陷阱"><a href="#简单陷阱" class="headerlink" title="简单陷阱"></a>简单陷阱</h3><p>先看一个 Vue2 简单例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">  &lt;div id=<span class="string">&quot;app&quot;</span>&gt;</span><br><span class="line">    &#123;&#123;count&#125;&#125;</span><br><span class="line">    &lt;button @click=<span class="string">&quot;addCount&quot;</span>&gt;&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt; <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">   <span class="keyword">return</span> &#123;</span><br><span class="line">     count: <span class="number">0</span></span><br><span class="line">   &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">   addCount() &#123;</span><br><span class="line">     <span class="built_in">this</span>.count += <span class="number">1</span></span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>在 Vue2 的心智模型中，我们总会在 data 中返回一个对象，我们并不关心对象的值是简单类型还是引用类型，因为它们都能很好的被响应式系统处理，就像上面这个例子一样。但是，如果我们不作任何心智模型的变化，就开始使用 Composition API，我们就容易写出这样的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"> &lt;div id=<span class="string">&quot;app&quot;</span>&gt;</span><br><span class="line">   &#123;&#123;count&#125;&#125;</span><br><span class="line">   &lt;button @click=<span class="string">&quot;addCount&quot;</span>&gt;&lt;/button&gt;</span><br><span class="line"> &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; reactive &#125; <span class="keyword">from</span> <span class="string">&#x27;@vue/runtime-dom&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"> setup() &#123;</span><br><span class="line">   <span class="keyword">const</span> data = reactive(&#123;</span><br><span class="line">     count: <span class="number">0</span></span><br><span class="line">   &#125;)</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">addCount</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">     data.count += <span class="number">1</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> &#123;</span><br><span class="line">     count: data.count,</span><br><span class="line">     addCount</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;; &lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>实际上，这段代码不能正常运作，当你点击 button 时，视图不会响应数据变化。原因是，我们先将 data 中的 count 取了出来，再合并到 this.$data 中，但是一旦 count 被取出来，它就是一个单纯的简单类型数据，响应式就丢了。</p>
<h3 id="复杂陷阱"><a href="#复杂陷阱" class="headerlink" title="复杂陷阱"></a>复杂陷阱</h3><p>数据结构越复杂，我们就越容易落入陷阱，在这里我们把一段业务逻辑抽离到自定义 hooks 里，如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reactive, onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;@vue/runtime-dom&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useSomeData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">const</span> data = reactive(&#123;</span><br><span class="line">   userInfo: &#123;</span><br><span class="line">     name: <span class="string">&#x27;default_name&#x27;</span>,</span><br><span class="line">     role: <span class="string">&#x27;default_role&#x27;</span></span><br><span class="line">   &#125;,</span><br><span class="line">   projectList: []</span><br><span class="line"> &#125;)</span><br><span class="line"></span><br><span class="line"> onMounted(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">   <span class="comment">// 异步获取数据</span></span><br><span class="line">   fetch(...).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">const</span> &#123; userInfo, projectList &#125; = result</span><br><span class="line">     data.userInfo = userInfo</span><br><span class="line">     data.projectList = projectList</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后像往常一样，我们在业务组件中去使用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"> &lt;div&gt;</span><br><span class="line">   &#123;&#123;name&#125;&#125;</span><br><span class="line">   &#123;&#123;role&#125;&#125;</span><br><span class="line">   &#123;&#123;list&#125;&#125;</span><br><span class="line"> &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt; <span class="keyword">import</span> useSomeData <span class="keyword">from</span> <span class="string">&#x27;./useSomeData&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"> setup() &#123;</span><br><span class="line">   <span class="keyword">const</span> &#123; userInfo, projectList &#125; = useSomeData()</span><br><span class="line">   <span class="keyword">return</span> &#123;</span><br><span class="line">     name: userInfo.name <span class="comment">// 响应式断掉</span></span><br><span class="line">     role: userInfo.role, <span class="comment">// 响应式断掉</span></span><br><span class="line">     list: projectList <span class="comment">// 响应式还是断掉</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125; &lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>我们看到，不管我们从响应式数据里取出什么（简单类型 or 引用类型），都会导致响应式断掉，进而无法更新视图。</p>
<p>所有这些问题的根源都是：<strong>setup 只会执行一次。</strong></p>
<h2 id="迁移到新的心智模型"><a href="#迁移到新的心智模型" class="headerlink" title="迁移到新的心智模型"></a>迁移到新的心智模型</h2><ol>
<li>时刻记住 setup 只会执行一次</li>
<li>永远不要直接使用简单类型</li>
<li>解构可能有风险，优先使用引用本身，而不是解构它</li>
<li>可以通过一些手段让解构变得安全</li>
</ol>
<h3 id="使用新心智模型来解决问题"><a href="#使用新心智模型来解决问题" class="headerlink" title="使用新心智模型来解决问题"></a>使用新心智模型来解决问题</h3><p>简单陷阱：永远不要直接使用简单类型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"> &lt;div id=<span class="string">&quot;app&quot;</span>&gt;</span><br><span class="line">   &#123;&#123;count&#125;&#125;</span><br><span class="line">   &lt;button @click=<span class="string">&quot;addCount&quot;</span>&gt;&lt;/button&gt;</span><br><span class="line"> &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt; <span class="keyword">import</span> &#123; reactive, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;@vue/runtime-dom&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"> setup() &#123;</span><br><span class="line">   <span class="keyword">const</span> count = ref(<span class="number">0</span>) <span class="comment">// 在这里使用ref包裹一层引用容器</span></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">addCount</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">     count.value += <span class="number">1</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> &#123;</span><br><span class="line">     count,</span><br><span class="line">     addCount</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;; &lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>复杂陷阱-方案 1：解构可能有风险，优先使用引用本身，而不是解构它</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"> &lt;div&gt;</span><br><span class="line">   &#123;&#123;someData.userInfo.name&#125;&#125;</span><br><span class="line">   &#123;&#123;someData.userInfo.role&#125;&#125;</span><br><span class="line">   &#123;&#123;someData.projectList&#125;&#125;</span><br><span class="line"> &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt; <span class="keyword">import</span> useSomeData <span class="keyword">from</span> <span class="string">&#x27;./useSomeData&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"> setup() &#123;</span><br><span class="line">   <span class="keyword">const</span> someData = useSomeData()</span><br><span class="line">   <span class="keyword">return</span> &#123;</span><br><span class="line">     someData</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125; &lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>复杂陷阱-方案 2：可以通过 computed 让解构变得安全</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reactive, onMounted, computed &#125; <span class="keyword">from</span> <span class="string">&#x27;@vue/runtime-dom&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useSomeData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">const</span> data = reactive(&#123;</span><br><span class="line">   userInfo: &#123;</span><br><span class="line">     name: <span class="string">&#x27;default_user&#x27;</span>,</span><br><span class="line">     role: <span class="string">&#x27;default_role&#x27;</span></span><br><span class="line">   &#125;,</span><br><span class="line">   projectList: []</span><br><span class="line"> &#125;)</span><br><span class="line"></span><br><span class="line"> onMounted(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">   <span class="comment">// 异步获取数据</span></span><br><span class="line">   fetch(...).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">const</span> &#123; userInfo, projectList &#125; = result</span><br><span class="line">     data.userInfo = userInfo</span><br><span class="line">     data.projectList = projectList</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">const</span> userName = computed(<span class="function">() =&gt;</span> data.userInfo.name)</span><br><span class="line"> <span class="keyword">const</span> userRole = computed(<span class="function">() =&gt;</span> data.userinfo.role)</span><br><span class="line"> <span class="keyword">const</span> projectList = computed(<span class="function">() =&gt;</span> data.projectList)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> &#123;</span><br><span class="line">   userName,</span><br><span class="line">   userRole,</span><br><span class="line">   projectList</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"> setup() &#123;</span><br><span class="line">   <span class="keyword">const</span> &#123; userName, userRole, projectList &#125; = useSomeData()</span><br><span class="line">   <span class="keyword">return</span> &#123;</span><br><span class="line">     name: userName <span class="comment">// 是计算属性，响应式不会断掉</span></span><br><span class="line">     role: userRole, <span class="comment">// 是计算属性，响应式不会断掉</span></span><br><span class="line">     list: projectList <span class="comment">// 是计算属性，响应式不会断掉</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>复杂陷阱-方案 3：方案 2 需要额外写一些 computed 属性，比较麻烦，我们还可以通过 toRefs 让解构变得安全</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reactive, onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;@vue/runtime-dom&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useSomeData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">const</span> data = reactive(&#123;</span><br><span class="line">   userInfo: &#123;</span><br><span class="line">     name: <span class="string">&#x27;default_user&#x27;</span>,</span><br><span class="line">     role: <span class="string">&#x27;default_role&#x27;</span></span><br><span class="line">   &#125;,</span><br><span class="line">   projectList: []</span><br><span class="line"> &#125;)</span><br><span class="line"></span><br><span class="line"> onMounted(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">   <span class="comment">// 异步获取数据</span></span><br><span class="line">   fetch(...).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">const</span> &#123; userInfo, projectList &#125; = result</span><br><span class="line">     data.userInfo = userInfo</span><br><span class="line">     data.projectList = projectList</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;)</span><br><span class="line"> <span class="comment">// 使用toRefs</span></span><br><span class="line"> <span class="keyword">return</span> toRefs(data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    <span class="comment">// 现在userInfo和projectList都已经被ref包裹了一层</span></span><br><span class="line">    <span class="comment">// 这层包裹会在template中自动解开</span></span><br><span class="line">    <span class="keyword">const</span> &#123; userInfo, projectList &#125; = useSomeData();</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      name: userInfo.value.name, <span class="comment">// ???好了吗</span></span><br><span class="line">      role: userInfo.value.role, <span class="comment">// ???好了吗</span></span><br><span class="line">      list: projectList, <span class="comment">// ???好了吗</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>你以为这样就好了吗？其实这里有一个<strong>陷阱中的陷阱</strong>：projectList 好了，但是 name 和 role 依然是响应式断开的状态，因为 toRefs 只会”浅“包裹，实际上 useSomeData 返回的结果是这样的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> someData = useSomeData()</span><br><span class="line">↓</span><br><span class="line">&#123;</span><br><span class="line"> userInfo: &#123;</span><br><span class="line">   value: &#123;</span><br><span class="line">     name: <span class="string">&#x27;...&#x27;</span>, <span class="comment">// 依然是简单类型，没有被包裹</span></span><br><span class="line">     role: <span class="string">&#x27;...&#x27;</span> <span class="comment">// 依然是简单类型，没有被包裹</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;,</span><br><span class="line"> projectList: &#123;</span><br><span class="line">   value: [...]</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因此，我们的 useSomeData 如果想要通过 toRefs 实现真正的解构安全，需要这样写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reactive, onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;@vue/runtime-dom&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useSomeData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> ...</span><br><span class="line"> <span class="comment">// 让每一层级都套一层ref</span></span><br><span class="line"> <span class="keyword">return</span> toRefs(&#123;</span><br><span class="line">   projectList: data.projectList,</span><br><span class="line">   userInfo: toRefs(data.userInfo)</span><br><span class="line"> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>建议：使用自定义 hooks 返回数据的时候，如果数据的层级比较简单，可以直接使用 toRefs 包裹；如果数据的层级比较复杂，建议使用 computed。</p>
</blockquote>
<h2 id="绕过陷阱"><a href="#绕过陷阱" class="headerlink" title="绕过陷阱"></a>绕过陷阱</h2><p>上述操作其实是 Vue 官方使用 CompositionAPI 的标准方式，因为 CompositionAPI 完全就是按照 setup 只会执行一次进行设计的。但是不可否认的是，这的确带来了许多心智负担，因为我们不得不时刻关注响应式数据到底能不能解构，不然一不小心就容易调到坑里。</p>
<p>其实所有这些问题都出在 setup 只会执行一次，那么有没有办法解决呢？有的，可以使用 JSX 或 h 的写法，绕过 setup 只会执行一次的问题：</p>
<p>还是这个存在安全隐患的自定义 hooks：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reactive, onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;@vue/runtime-dom&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useSomeData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">const</span> data = reactive(&#123;</span><br><span class="line">   userInfo: &#123;</span><br><span class="line">     name: <span class="string">&#x27;default_name&#x27;</span>,</span><br><span class="line">     role: <span class="string">&#x27;default_role&#x27;</span></span><br><span class="line">   &#125;,</span><br><span class="line">   projectList: []</span><br><span class="line"> &#125;)</span><br><span class="line"></span><br><span class="line"> onMounted(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">   <span class="comment">// 异步获取数据</span></span><br><span class="line">   fetch(...).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">const</span> &#123; userInfo, projectList &#125; = result</span><br><span class="line">     data.userInfo = userInfo</span><br><span class="line">     data.projectList = projectList</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用-JSX-或-h"><a href="#使用-JSX-或-h" class="headerlink" title="使用 JSX 或 h"></a>使用 JSX 或 h</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useSomeData <span class="keyword">from</span> <span class="string">&quot;./useSomeData&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    <span class="keyword">const</span> someData = useSomeData();</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;</span><br><span class="line">        userInfo: &#123; name, role &#125;,</span><br><span class="line">        projectList,</span><br><span class="line">      &#125; = someData;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &#123;name&#125;</span><br><span class="line">          &#123;role&#125;</span><br><span class="line">          &#123;projectList&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      );</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在使用 JSX 或 h 的时候，setup 需要返回一个函数，这个函数其实就是 render 函数，它在数据变化时会重新执行，所以我们只需要把解构的逻辑放到 render 函数里，那么就解决了 setup 只会执行一次的问题。</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>我们可能需要一些约定，来约束自定义 hooks 的使用方式。但是官方并没有给出，这将导致我们 hooks 会写的五花八门，并且漏洞百出。目前来看，”不要解构“是最安全的方式。</p>
<p>我专门就这个问题请教了 yyx 大佬，大佬给出了一个”约定”，那就是尽量少使用“解构”。这我也很无奈。其实我是希望官方能够给出一个工具，让我们减少在自定义 hooks 中犯错误的可能性。（toRefs 其实就是这样的一个工具，但是它并不能解决所有问题）</p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/6855473771013226503">原文连接</a></p>

  </div>
</article>
 
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>
<!--<script src="//cdn.jsdelivr.net/npm/leancloud-storage@latest/dist/av-min.js"></script>
<script src='//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js'></script>-->
<div id="vcomments"></div>
<script>
      var notify = false == true ? true : false;
      var verify = false == true ? true : false;
      var visitor = true == true ? true : false;
  new Valine({
    el: '#vcomments',
              notify: notify,
              verify: verify,
      app_id: '0AQiakktufEkOkBGRTG7OMOA-gzGzoHsz',
    app_key: 'K7A8Rj80r3C59gYyLjJ9Bw8f',
          lang: 'en',
          placeholder: 'ヾﾉ≧∀≦)o快来评论一下吧!',
          avatar: 'monsterid',
          pageSize: 10,
          visitor: visitor
      });
</script>



<script type="module">
  import live2dJSString from "/assets/2d.js";
  let model = {
    whiteCat: "https://cdn.jsdelivr.net/gh/QiShaoXuan/live2DModel@1.0.0/live2d-widget-model-tororo/assets/tororo.model.json",
  };
  function initCat() {
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ? true : false;
    if (isMobile) {
      isLoaded = false;
      return console.log("mobile do not load model");
    }
    if (!window.loadlive2d) {
      const script = document.createElement("script");
      script.innerHTML = live2dJSString;
      document.body.appendChild(script);
    }
    let style = {
      width: (150 / 1424) * document.body.clientWidth,
      height: ((150 / 1424) * document.body.clientWidth) / 0.8,
    };
    setTimeout(() => {
      window.loadlive2d("vuepress-cat", model.whiteCat);
    }, 1000);
  }
  initCat();
</script>

        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/YOMXXX">Projects</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Setup-%E9%99%B7%E9%98%B1"><span class="toc-number">2.</span> <span class="toc-text">Setup 陷阱</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E9%99%B7%E9%98%B1"><span class="toc-number">2.1.</span> <span class="toc-text">简单陷阱</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E6%9D%82%E9%99%B7%E9%98%B1"><span class="toc-number">2.2.</span> <span class="toc-text">复杂陷阱</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%81%E7%A7%BB%E5%88%B0%E6%96%B0%E7%9A%84%E5%BF%83%E6%99%BA%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.</span> <span class="toc-text">迁移到新的心智模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B0%E5%BF%83%E6%99%BA%E6%A8%A1%E5%9E%8B%E6%9D%A5%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98"><span class="toc-number">3.1.</span> <span class="toc-text">使用新心智模型来解决问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E9%99%B7%E9%98%B1"><span class="toc-number">4.</span> <span class="toc-text">绕过陷阱</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-JSX-%E6%88%96-h"><span class="toc-number">4.1.</span> <span class="toc-text">使用 JSX 或 h</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E8%AE%B0"><span class="toc-number">5.</span> <span class="toc-text">后记</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://yomxxx.github.io/2020/09/01/20200901-Composition-API/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://yomxxx.github.io/2020/09/01/20200901-Composition-API/&text=Vue Composition API 陷阱"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://yomxxx.github.io/2020/09/01/20200901-Composition-API/&title=Vue Composition API 陷阱"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://yomxxx.github.io/2020/09/01/20200901-Composition-API/&is_video=false&description=Vue Composition API 陷阱"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Vue Composition API 陷阱&body=Check out this article: https://yomxxx.github.io/2020/09/01/20200901-Composition-API/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://yomxxx.github.io/2020/09/01/20200901-Composition-API/&title=Vue Composition API 陷阱"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://yomxxx.github.io/2020/09/01/20200901-Composition-API/&title=Vue Composition API 陷阱"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://yomxxx.github.io/2020/09/01/20200901-Composition-API/&title=Vue Composition API 陷阱"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://yomxxx.github.io/2020/09/01/20200901-Composition-API/&title=Vue Composition API 陷阱"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://yomxxx.github.io/2020/09/01/20200901-Composition-API/&name=Vue Composition API 陷阱&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://yomxxx.github.io/2020/09/01/20200901-Composition-API/&t=Vue Composition API 陷阱"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2023
    lgc
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/YOMXXX">Projects</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

        <div class="cat-container">
          <canvas
            id="vuepress-cat"
            width="200"
           height="200"
            class="live2d"
          ></canvas>
    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

    <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?646453bbe5d0ca5216b2efd7d2d5b945";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

<!-- Disqus Comments -->


    </div>
<script>if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js?t=1697368351149')
    .then(function () {console.log('ServiceWorker Register Successfully.')})
    .catch(function (e) {console.error(e)});
}
</script></body>
<script>
WIDGET = {
  CONFIG: {
    "modules": "01234",
    "background": 1,
    "tmpColor": "FFFFFF",
    "tmpSize": 16,
    "cityColor": "FFFFFF",
    "citySize": 16,
    "aqiSize": 16,
    "weatherIconSize": 24,
    "alertIconSize": 18,
    "padding": "10px 10px 10px 10px",
    "shadow": "1",
    "language": "auto",
    "borderRadius": 5,
    "fixed": "false",
    "vertical": "middle",
    "horizontal": "center",
    "key": "a5b33f33732d4326966fec04550c3ead"
  }
}
  </script>
<script src="https://widget.heweather.net/simple/static/js/he-simple-common.js?v=1.1"></script>
<script type="module">
  import live2dJSString from "/assets/2d.js"
  let model = {
    whiteCat: "https://cdn.jsdelivr.net/gh/QiShaoXuan/live2DModel@1.0.0/live2d-widget-model-tororo/assets/tororo.model.json",
  };
  function initCat() {
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ? true : false;
    if (isMobile) {
      isLoaded = false;
      return console.log("mobile do not load model");
    }
    if (!window.loadlive2d) {
        const script = document.createElement("script");
        script.innerHTML = live2dJSString;
        document.body.appendChild(script);
      }
    let style = {
      width: (150 / 1424) * document.body.clientWidth,
      height: ((150 / 1424) * document.body.clientWidth) / 0.8,
    };
    setTimeout(() => {
      window.loadlive2d("vuepress-cat", model.whiteCat);
    },1000);
  }
  initCat();
</script>
</html>
