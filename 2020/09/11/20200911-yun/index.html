<!DOCTYPE html>
<style>
  .s-sticker {
    width: 270px !important;
  }
  .cat-container {
    text-align: right;
  }
</style>
<html lang=zh>
<head><link rel=manifest href=/manifest.json>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="baidu-site-verification" content="code-VvT544WyCE" />
    <meta name="google-site-verification" content="ZRNXbi80HeKdx9200KLTWY1ZplSEg0xudkPXgjAAk0c" />
    <meta name="description" content="前言随着 serverless 越来越火，基本大厂都使用云开发的技术，使自己的业务托管上云，开发者则大多把重心关注在业务的开发上，无需关注扩容等操作，一切交给云服务商即可，大大减少了开发部署等操作，而对于小程序云开发，开发者完全可以作为全栈工程师去开发项目（包括前端、后端、数据库-mongodb 等），无需搭建服务器，即可使用云端能力；云开发为开发者提供完整的原生云端支持和微信服务支持，弱化后端和">
<meta property="og:type" content="article">
<meta property="og:title" content="小程序云开发基础实战">
<meta property="og:url" content="https://yomxxx.github.io/2020/09/11/20200911-yun/index.html">
<meta property="og:site_name" content="辰总的blog">
<meta property="og:description" content="前言随着 serverless 越来越火，基本大厂都使用云开发的技术，使自己的业务托管上云，开发者则大多把重心关注在业务的开发上，无需关注扩容等操作，一切交给云服务商即可，大大减少了开发部署等操作，而对于小程序云开发，开发者完全可以作为全栈工程师去开发项目（包括前端、后端、数据库-mongodb 等），无需搭建服务器，即可使用云端能力；云开发为开发者提供完整的原生云端支持和微信服务支持，弱化后端和">
<meta property="og:locale">
<meta property="og:image" content="https://yomxxx.github.io/assets/20200911-yun/img1.png">
<meta property="og:image" content="https://yomxxx.github.io/assets/20200911-yun/img2.png">
<meta property="og:image" content="https://yomxxx.github.io/assets/20200911-yun/img3.png">
<meta property="og:image" content="https://yomxxx.github.io/assets/20200911-yun/img4.png">
<meta property="og:image" content="https://yomxxx.github.io/assets/20200911-yun/img5.png">
<meta property="og:image" content="https://yomxxx.github.io/assets/20200911-yun/img6.png">
<meta property="og:image" content="https://yomxxx.github.io/assets/20200911-yun/img7.png">
<meta property="og:image" content="https://yomxxx.github.io/assets/20200911-yun/img8.png">
<meta property="og:image" content="https://yomxxx.github.io/assets/20200911-yun/img9.png">
<meta property="article:published_time" content="2020-09-11T09:01:44.000Z">
<meta property="article:modified_time" content="2020-11-25T12:58:51.735Z">
<meta property="article:author" content="lgc">
<meta property="article:tag" content="JavaScript、Node、Vue、React、生活随笔、记录优秀的文章">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yomxxx.github.io/assets/20200911-yun/img1.png">
    
    
        
          
              <link rel="shortcut icon" href="/assets/avatar.jpeg">
          
        
        
          
            <link rel="icon" type="image/png" href="/assets/avatar.jpeg" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/assets/avatar.jpeg">
          
        
    
    <!-- title -->
    <title>小程序云开发基础实战</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="辰总的blog" type="application/atom+xml" />
    
<meta name="generator" content="Hexo 5.1.1"></head>


<body class="max-width mx-auto px3 ltr">
  
    <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/YOMXXX">Projects</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2020/11/20/20201120-docker-web/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2020/09/04/20200904-web3/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://yomxxx.github.io/2020/09/11/20200911-yun/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://yomxxx.github.io/2020/09/11/20200911-yun/&text=小程序云开发基础实战"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://yomxxx.github.io/2020/09/11/20200911-yun/&title=小程序云开发基础实战"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://yomxxx.github.io/2020/09/11/20200911-yun/&is_video=false&description=小程序云开发基础实战"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=小程序云开发基础实战&body=Check out this article: https://yomxxx.github.io/2020/09/11/20200911-yun/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://yomxxx.github.io/2020/09/11/20200911-yun/&title=小程序云开发基础实战"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://yomxxx.github.io/2020/09/11/20200911-yun/&title=小程序云开发基础实战"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://yomxxx.github.io/2020/09/11/20200911-yun/&title=小程序云开发基础实战"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://yomxxx.github.io/2020/09/11/20200911-yun/&title=小程序云开发基础实战"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://yomxxx.github.io/2020/09/11/20200911-yun/&name=小程序云开发基础实战&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://yomxxx.github.io/2020/09/11/20200911-yun/&t=小程序云开发基础实战"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%96%B0%E5%BB%BA%E4%BA%91%E5%BC%80%E5%8F%91%E6%A8%A1%E6%9D%BF"><span class="toc-number">2.</span> <span class="toc-text">1. 新建云开发模板</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%BC%80%E9%80%9A%E4%BA%91%E5%BC%80%E5%8F%91%E3%80%81%E5%88%9B%E5%BB%BA%E7%8E%AF%E5%A2%83"><span class="toc-number">3.</span> <span class="toc-text">2. 开通云开发、创建环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E4%BD%93%E9%AA%8C%E4%BA%91%E5%BC%80%E5%8F%91"><span class="toc-number">4.</span> <span class="toc-text">3. 体验云开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%B8%B8%E9%87%8F-DYNAMIC-CURRENT-ENV"><span class="toc-number">4.1.</span> <span class="toc-text">3.1 常量 DYNAMIC_CURRENT_ENV</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E4%BA%91%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">4.2.</span> <span class="toc-text">3.2 云数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E4%BA%91%E5%87%BD%E6%95%B0"><span class="toc-number">4.3.</span> <span class="toc-text">3.2 云函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E4%BA%91%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98-%E6%A8%A1%E7%B3%8A%E5%9B%BE%E5%83%8F%E9%AB%98%E6%B8%85%E5%A4%84%E7%90%86"><span class="toc-number">5.</span> <span class="toc-text">4 云开发实战-模糊图像高清处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E7%9B%AE%E7%9A%84"><span class="toc-number">5.1.</span> <span class="toc-text">4.1 目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="toc-number">5.2.</span> <span class="toc-text">4.2 技术栈</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E5%BC%80%E5%8F%91"><span class="toc-number">5.3.</span> <span class="toc-text">4.3 开发</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
      
        <style>
  #vuepress-cat {
    position: fixed;
    right: 0;
    bottom: 0;
  }
</style>
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="cat-container">
    <canvas id="vuepress-cat" width="200" height="200" class="live2d"></canvas>
  </div>
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        小程序云开发基础实战
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">辰总的blog</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-09-11T09:01:44.000Z" itemprop="datePublished">2020-09-11</time>
        
      
    </div>

 
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F/">小程序</a> › <a class="category-link" href="/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F/serverless/">serverless</a>
    </div>

 

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>随着 serverless 越来越火，基本大厂都使用云开发的技术，使自己的业务托管上云，开发者则大多把重心关注在业务的开发上，无需关注扩容等操作，一切交给云服务商即可，大大减少了开发部署等操作，而对于小程序云开发，开发者完全可以作为全栈工程师去开发项目（包括前端、后端、数据库-mongodb 等），无需搭建服务器，即可使用云端能力；云开发为开发者提供完整的原生云端支持和微信服务支持，弱化后端和运维概念，无需搭建服务器，使用平台提供的 API 进行核心业务开发，即可实现快速上线和迭代，同时这一能力，同开发者已经使用的云服务相互兼容，并不互斥；</p>
<table>
<thead>
<tr>
<th align="center">能力</th>
<th align="center">作用</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">云函数</td>
<td align="center">无需自建服务器</td>
<td align="center">在云端运行的代码，微信私有协议天然鉴权，开发者只需编写自身业务逻辑代码</td>
</tr>
<tr>
<td align="center">数据库</td>
<td align="center">无需自建数据库</td>
<td align="center">一个既可在小程序前端操作，也能在云函数中读写的 JSON 数据库</td>
</tr>
<tr>
<td align="center">存储</td>
<td align="center">无需自建存储和 CDN</td>
<td align="center">在小程序前端直接上传/下载云端文件，在云开发控制台可视化管理</td>
</tr>
<tr>
<td align="center">云调用</td>
<td align="center">原生微信服务集成</td>
<td align="center">基于云函数免鉴权使用小程序开放接口的能力，包括服务端调用、获取开放数据等能力</td>
</tr>
</tbody></table>
<h2 id="1-新建云开发模板"><a href="#1-新建云开发模板" class="headerlink" title="1. 新建云开发模板"></a>1. 新建云开发模板</h2><blockquote>
<p>也可以省略此步骤，直接在已有项目上开通和使用云开发。</p>
</blockquote>
<p>新建项目选择一个空目录，填入 AppID（使用云开发能力必须填写 AppID），勾选创建 “云开发 QuickStart 项目”，点击创建即可得到一个展示云开发基础能力的示例小程序。该小程序与普通 QuickStart 小程序有以下不同需注意：</p>
<ul>
<li>无游客模式、也不可以使用 <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/devtools/sandbox.html">测试号</a></li>
<li><code>project.config.json</code> 中增加了字段 <code>cloudfunctionRoot</code> 用于指定存放云函数的目录</li>
<li><code>cloudfunctionRoot</code> 指定的目录有特殊的图标</li>
<li>云开发能力从基础库 <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html">2.2.3</a> 开始支持（覆盖率 97.3%，查看<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference/compatibility.html">兼容性问题</a>）</li>
</ul>
<p>从基础库 <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html">2.4.1</a> 开始，在小程序插件中可以使用云开发，插件中使用云开发时，使用的是插件方的云资源而非宿主的云资源，在使用方式上与在小程序中使用无异。</p>
<h2 id="2-开通云开发、创建环境"><a href="#2-开通云开发、创建环境" class="headerlink" title="2. 开通云开发、创建环境"></a>2. 开通云开发、创建环境</h2><p>创建了第一个云开发小程序后，在使用云开发能力之前需要先开通云开发。在开发者工具工具栏左侧，点击 “云开发” 按钮即可打开云控制台、根据提示开通云开发、创建云环境。默认配额下可以创建两个环境，各个环境相互隔离，每个环境都包含独立的数据库实例、存储空间、云函数配置等资源。每个环境都有唯一的环境 ID 标识，初始创建的环境自动成为默认环境。</p>
<blockquote>
<p>注：AppID 首次开通云环境后，需等待大约 10 分钟方可正常使用云 API，在此期间官方后台服务正在做准备服务，如尝试在小程序中调用云 API 则会报 <code>cloud init error：&#123; errMsg: &quot;invalid scope&quot; &#125;</code> 的错误</p>
</blockquote>
<p>完成后我们就能看到控制台信息了<br><img src="/assets/20200911-yun/img1.png" alt="image-20200911172630511"></p>
<p>接着在 project.config.json 文件中配置云函数存放的位置</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attr">&quot;cloudfunctionRoot&quot;</span>: <span class="string">&quot;cloudfunctions/&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<p>配置完后，在开发者工具中会出现当前环境的标示，这样就配置成功了；<br><img src="/assets/20200911-yun/img2.png" alt="image-20200911172630511"></p>
<p>然后在 app.js 中配置云开发的初始化方法:其中 env 为当前云开发的环境，不指定的话则默认为第一个创建的环境</p>
<ul>
<li>注： 我们可以根据小程序开发环境的不同，去动态映射云开发的环境；</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//app.js</span></span><br><span class="line">App(&#123;</span><br><span class="line">  onLaunch: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!wx.cloud) &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(<span class="string">&quot;请使用 2.2.3 或以上的基础库以使用云能力&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      wx.cloud.init(&#123;</span><br><span class="line">        <span class="comment">// env 参数说明：</span></span><br><span class="line">        <span class="comment">//   env 参数决定接下来小程序发起的云开发调用（wx.cloud.xxx）会默认请求到哪个云环境的资源</span></span><br><span class="line">        <span class="comment">//   此处请填入环境 ID, 环境 ID 可打开云控制台查看</span></span><br><span class="line">        <span class="comment">//   如不填则使用默认环境（第一个创建的环境）</span></span><br><span class="line">        <span class="comment">// env: &#x27;my-env-id&#x27;,</span></span><br><span class="line">        traceUser: <span class="literal">true</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="3-体验云开发"><a href="#3-体验云开发" class="headerlink" title="3. 体验云开发"></a>3. 体验云开发</h2><h3 id="3-1-常量-DYNAMIC-CURRENT-ENV"><a href="#3-1-常量-DYNAMIC-CURRENT-ENV" class="headerlink" title="3.1 常量 DYNAMIC_CURRENT_ENV"></a>3.1 常量 DYNAMIC_CURRENT_ENV</h3><blockquote>
<p>支持端：云函数 <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference/changelog-server-sdk.html">1.1.0</a></p>
</blockquote>
<p>标志当前所在环境，注意该值不是当前所在环境 ID 的字符串，其值等价于 <code>Symbol.for(&#39;DYNAMIC_CURRENT_ENV&#39;)</code>，是用于标志当前所在环境的。如在 <code>init</code> 中如果给 <code>env</code> 参数传该常量值，则后续的 API 请求会自动请求当前所在环境的云资源，如云函数 A 当前所在环境是 <code>test-123</code>，则其接下来请求数据库、文件存储、云函数时都默认请求环境 <code>test-123</code> 的数据库、文件存储、云函数。</p>
<p>常量可用于：</p>
<ul>
<li><code>cloud.init</code> 的 <code>env</code> 参数</li>
<li><code>cloud.updateConfig</code> 的 <code>env</code> 参数</li>
<li>各 API 的 <code>config</code> 参数中的 <code>env</code> 参数</li>
</ul>
<p>注意事项：</p>
<ul>
<li><p>自 <code>1.7.1</code> 起，该变量支持在定时触发器中使用，之前的版本不支持。<br><strong>cloud.database: 设置新数据库对象的调用环境等于当前所在环境</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cloud.init(&#123;</span><br><span class="line">  env: <span class="string">&quot;xxx&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不同于 init 时设置的环境，db 对象的请求将会去到和当前云函数所在环境相同的环境</span></span><br><span class="line"><span class="keyword">const</span> db = cloud.database(&#123;</span><br><span class="line">  env: cloud.DYNAMIC_CURRENT_ENV,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="3-2-云数据库"><a href="#3-2-云数据库" class="headerlink" title="3.2 云数据库"></a>3.2 云数据库</h3><p>云数据库底层使用的是 mongodb，对于前端同学也不是很陌生；小程序调用数据库比较方便，可以直接在小程序 js 文件中调用（不像 uni-app 中，一定要在云函数中才能使用，比较恶心！）；<br>首先按照下图先创建一个集合，作为测试我已经创建了一个名为 test 的集合<br><img src="/assets/20200911-yun/img3.png" alt="image-20200911172630511"></p>
<p>下面代码中，我们 onload 回调中我们向刚刚创建的 test 集合中添加了一个数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">onLoad: <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> db =  wx.cloud.database()</span><br><span class="line">  <span class="keyword">await</span> db.collection(<span class="string">&#x27;test&#x27;</span>).add(&#123;</span><br><span class="line">      data: &#123;</span><br><span class="line">        a: <span class="number">1</span></span><br><span class="line">      &#125;,</span><br><span class="line">      config: &#123;</span><br><span class="line">        env: <span class="string">&#x27;test-123&#x27;</span> <span class="comment">// 环境 ID，指定使用哪个环境下的对应的云函数，填写后将忽略 init 时指定的环境 ID，这里将访问test-123云空间的test集合，然后添加一条数据</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>随后我们刷新控制台就能看到刚刚添加的数据啦<br><img src="/assets/20200911-yun/img4.png" alt="image-20200911172630511"></p>
<p>其他常用的方法，见<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/Cloud.database.html">官方文档</a></p>
<h3 id="3-2-云函数"><a href="#3-2-云函数" class="headerlink" title="3.2 云函数"></a>3.2 云函数</h3><p>在云函数中使用 wx-server-sdk，需先调用初始化方法 init 一次，init 用于设置接下来在该云函数实例中调用云函数、数据库、文件存储时要访问的环境。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test</span></span><br><span class="line"><span class="keyword">const</span> cloud = <span class="built_in">require</span>(<span class="string">&quot;wx-server-sdk&quot;</span>);</span><br><span class="line">cloud.init(&#123;</span><br><span class="line">  env: <span class="string">&quot;test-x1dzi&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当我们调用云函数test的时候，访问的就是test-x1dzi这个云空间里的资源了</span></span><br><span class="line"><span class="keyword">let</span> msg = <span class="keyword">await</span> wx.cloud.callFunction(&#123;</span><br><span class="line">  name: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">  data: &#123;&#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="4-云开发实战-模糊图像高清处理"><a href="#4-云开发实战-模糊图像高清处理" class="headerlink" title="4 云开发实战-模糊图像高清处理"></a>4 云开发实战-模糊图像高清处理</h2><h3 id="4-1-目的"><a href="#4-1-目的" class="headerlink" title="4.1 目的"></a>4.1 目的</h3><p>解决模糊图片带来的不好体验，利用 AI 图片处理使其变高清；</p>
<h3 id="4-2-技术栈"><a href="#4-2-技术栈" class="headerlink" title="4.2 技术栈"></a>4.2 技术栈</h3><p>腾讯云 AI 图片处理 API、云调用、云函数、云储存</p>
<h3 id="4-3-开发"><a href="#4-3-开发" class="headerlink" title="4.3 开发"></a>4.3 开发</h3><p>1.申请开通腾讯云图像处理工作台；<br><img src="/assets/20200911-yun/img5.png" alt="image-20200911172630511"></p>
<p>2.开通完，等几分钟就可以看到控制台了；</p>
<p><img src="/assets/20200911-yun/img6.png" alt="image-20200911172630511"></p>
<p>3.然后点击后上角的<a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/api/explorer?Product=tiia&Version=2019-05-29&Action=EnhanceImage&SignVersion=">接口文档</a></p>
<p>4.可以看到系统为你生成了一套代码，不过我们需要添加<a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/cam/capi">SecretId、SecretKey</a>，ImageUrl 为图片地址可以接受线上地址或者 Base64 地址，这个我们一会动态传递即可，返回的值是一个 base64 的地址；</p>
<p><img src="/assets/20200911-yun/img7.png" alt="image-20200911172630511"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> tencentcloud = <span class="built_in">require</span>(<span class="string">&quot;tencentcloud-sdk-nodejs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TiiaClient = tencentcloud.tiia.v20190529.Client;</span><br><span class="line"><span class="keyword">const</span> models = tencentcloud.tiia.v20190529.Models;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Credential = tencentcloud.common.Credential;</span><br><span class="line"><span class="keyword">const</span> ClientProfile = tencentcloud.common.ClientProfile;</span><br><span class="line"><span class="keyword">const</span> HttpProfile = tencentcloud.common.HttpProfile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> cred = <span class="keyword">new</span> Credential(<span class="string">&quot;AKIDrjxxxxxx&quot;</span>, <span class="string">&quot;iBRUIq5ssssss&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> httpProfile = <span class="keyword">new</span> HttpProfile();</span><br><span class="line">httpProfile.endpoint = <span class="string">&quot;tiia.tencentcloudapi.com&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> clientProfile = <span class="keyword">new</span> ClientProfile();</span><br><span class="line">clientProfile.httpProfile = httpProfile;</span><br><span class="line"><span class="keyword">let</span> client = <span class="keyword">new</span> TiiaClient(cred, <span class="string">&quot;ap-beijing&quot;</span>, clientProfile);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> req = <span class="keyword">new</span> models.EnhanceImageRequest();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> params = <span class="string">&quot;&#123;&#125;&quot;</span>;</span><br><span class="line">req.from_json_string(params);</span><br><span class="line"></span><br><span class="line">client.EnhanceImage(req, <span class="function"><span class="keyword">function</span>(<span class="params">errMsg, response</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (errMsg) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(errMsg);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(response.to_json_string());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>5.然后我们需要把上面的代码放到云函数中，托管代码，然后前端去调用，首先创建一个新的云函数；</p>
<p><img src="/assets/20200911-yun/img8.png" alt="image-20200911172630511"></p>
<p>6.把代码粘贴到 index.js 中，稍加修改，用云函数包一下即可；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 云函数入口文件</span></span><br><span class="line"><span class="keyword">const</span> tencentcloud = <span class="built_in">require</span>(<span class="string">&quot;tencentcloud-sdk-nodejs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cloud = <span class="built_in">require</span>(<span class="string">&quot;wx-server-sdk&quot;</span>);</span><br><span class="line">cloud.init(&#123;</span><br><span class="line">  <span class="comment">// API 调用都保持和云函数当前所在环境一致</span></span><br><span class="line">  env: cloud.DYNAMIC_CURRENT_ENV,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 云函数入口函数</span></span><br><span class="line"><span class="built_in">exports</span>.main = <span class="keyword">async</span> (event, context) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> TiiaClient = tencentcloud.tiia.v20190529.Client;</span><br><span class="line">  <span class="keyword">const</span> models = tencentcloud.tiia.v20190529.Models;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> Credential = tencentcloud.common.Credential;</span><br><span class="line">  <span class="keyword">const</span> ClientProfile = tencentcloud.common.ClientProfile;</span><br><span class="line">  <span class="keyword">const</span> HttpProfile = tencentcloud.common.HttpProfile;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> cred = <span class="keyword">new</span> Credential(<span class="string">&quot;AKIDrjxxxxxx&quot;</span>, <span class="string">&quot;iBRUIq5ssssss&quot;</span>);</span><br><span class="line">  <span class="keyword">let</span> httpProfile = <span class="keyword">new</span> HttpProfile();</span><br><span class="line">  httpProfile.endpoint = <span class="string">&quot;tiia.tencentcloudapi.com&quot;</span>;</span><br><span class="line">  <span class="keyword">let</span> clientProfile = <span class="keyword">new</span> ClientProfile();</span><br><span class="line">  clientProfile.httpProfile = httpProfile;</span><br><span class="line">  <span class="keyword">let</span> client = <span class="keyword">new</span> TiiaClient(cred, <span class="string">&quot;ap-beijing&quot;</span>, clientProfile);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> req = <span class="keyword">new</span> models.EnhanceImageRequest();</span><br><span class="line">  <span class="keyword">const</span> fileList = event.fileID; <span class="comment">// event=是我们传递的参数的对象集合，fileID是我们传递的参数名</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> params = <span class="string">&#x27;&#123;&quot;ImageUrl&quot;:&quot;https://www.google.com/imgres?imgurl=https%3A%2F%2Fimg.iplaysoft.com%2Fwp-content%2Fuploads%2F2019%2Ffree-images%2Ffree_stock_photo.jpg&amp;imgrefurl=https%3A%2F%2Fwww.iplaysoft.com%2Ffree-images.html&amp;tbnid=vQjlM9KtkGsb_M&amp;vet=12ahUKEwiY9Zfn3-frAhVG15QKHeudABMQMygAegUIARCeAQ..i&amp;docid=JeaDEV9l4RQZhM&amp;w=680&amp;h=453&amp;q=%E5%9B%BE%E7%89%87&amp;ved=2ahUKEwiY9Zfn3-frAhVG15QKHeudABMQMygAegUIARCeAQ&quot;&#125;&#x27;</span>;</span><br><span class="line">  req.from_json_string(params);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">      client.EnhanceImage(req, <span class="function"><span class="keyword">function</span>(<span class="params">errMsg, response</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (errMsg) &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(errMsg);</span><br><span class="line">          resolve(errMsg);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">console</span>.log(response.to_json_string());</span><br><span class="line">        resolve(response.EnhancedImage);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    result: <span class="keyword">await</span> run(),</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>7.我们把代码粘贴到 index.js 中，然后开启本地调试，可以看到生成了 base64 地址，说明转换成功了<br><img src="/assets/20200911-yun/img9.png" alt="image-20200911172630511"></p>
<p>8.接下来我们需要把写死的图片通过前端传递过去，而且图片需要从本地选择，又图片转换功能不支持本地图片转换，需要线上地址，故用到了小程序端-云储存上传、云函数端-云储存下载；</p>
<!-- // 目前图片地址是写死的 需要做成动态获取 -->

<p>流程： 前端选择图片=&gt;把本地图片上传到云储存=&gt;调用云函数传递云储存传递 fileID=&gt;云函数调用云储存拿到真实线上地址=&gt;调用 AI 接口=&gt;返回转换后的地址给前端=&gt;前端展示</p>
<ol>
<li>前端选择图片</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">wx.chooseImage(&#123;</span><br><span class="line">  count: <span class="number">1</span>,</span><br><span class="line">  sizeType: [<span class="string">&quot;compressed&quot;</span>],</span><br><span class="line">  sourceType: [<span class="string">&quot;album&quot;</span>],</span><br><span class="line">  success: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// tempFilePath可以作为img标签的src属性显示图片</span></span><br><span class="line">    <span class="keyword">const</span> tempFilePaths = res.tempFilePaths;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      ImageUrl: tempFilePaths[<span class="number">0</span>],</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>把本地图片上传到云储存&amp;调用云函数传递云储存传递 fileID</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">wx.cloud.uploadFile(&#123;</span><br><span class="line">  cloudPath: rdm + <span class="string">&quot;.png&quot;</span>, <span class="comment">//云储存的文件名</span></span><br><span class="line">  filePath: <span class="built_in">this</span>.data.ImageUrl, <span class="comment">// 文件路径</span></span><br><span class="line">  success: <span class="keyword">async</span> (res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> msg = <span class="keyword">await</span> wx.cloud.callFunction(&#123;</span><br><span class="line">      name: <span class="string">&quot;Upload&quot;</span>,</span><br><span class="line">      data: &#123;</span><br><span class="line">        fileID: [res.fileID],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      img: <span class="string">&quot;data:image/png;base64,&quot;</span> + msg.result.result,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>云函数调用云储存拿到真实线上地址=&gt;调用 AI 接口=&gt;返回转换后的地址给前端</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fileList = event.fileID;</span><br><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> cloud.getTempFileURL(&#123;</span><br><span class="line">  fileList: fileList,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">let</span> params = <span class="string">&#x27;&#123;&quot;ImageUrl&quot;:&quot;&#x27;</span> + result.fileList[<span class="number">0</span>].tempFileURL + <span class="string">&#x27;&quot;&#125;&#x27;</span>;</span><br><span class="line">req.from_json_string(params);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    client.EnhanceImage(req, <span class="function"><span class="keyword">function</span>(<span class="params">errMsg, response</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (errMsg) &#123;</span><br><span class="line">        resolve(errMsg);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">console</span>.log(response.to_json_string());</span><br><span class="line">      resolve(response.EnhancedImage);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">  result: <span class="keyword">await</span> run(),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>最终展示视频如下</p>
<video id="video" controls="" preload>
  <source id="mp4" src="/assets/20200911-yun/mp4.mp4" type="video/mp4" />
</video>
</li>
</ul>

  </div>
</article>
 
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>
<!--<script src="//cdn.jsdelivr.net/npm/leancloud-storage@latest/dist/av-min.js"></script>
<script src='//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js'></script>-->
<div id="vcomments"></div>
<script>
      var notify = false == true ? true : false;
      var verify = false == true ? true : false;
      var visitor = true == true ? true : false;
  new Valine({
    el: '#vcomments',
              notify: notify,
              verify: verify,
      app_id: '0AQiakktufEkOkBGRTG7OMOA-gzGzoHsz',
    app_key: 'K7A8Rj80r3C59gYyLjJ9Bw8f',
          lang: 'en',
          placeholder: 'ヾﾉ≧∀≦)o快来评论一下吧!',
          avatar: 'monsterid',
          pageSize: 10,
          visitor: visitor
      });
</script>



<script type="module">
  import live2dJSString from "/assets/2d.js";
  let model = {
    whiteCat: "https://cdn.jsdelivr.net/gh/QiShaoXuan/live2DModel@1.0.0/live2d-widget-model-tororo/assets/tororo.model.json",
  };
  function initCat() {
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ? true : false;
    if (isMobile) {
      isLoaded = false;
      return console.log("mobile do not load model");
    }
    if (!window.loadlive2d) {
      const script = document.createElement("script");
      script.innerHTML = live2dJSString;
      document.body.appendChild(script);
    }
    let style = {
      width: (150 / 1424) * document.body.clientWidth,
      height: ((150 / 1424) * document.body.clientWidth) / 0.8,
    };
    setTimeout(() => {
      window.loadlive2d("vuepress-cat", model.whiteCat);
    }, 1000);
  }
  initCat();
</script>

        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/YOMXXX">Projects</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%96%B0%E5%BB%BA%E4%BA%91%E5%BC%80%E5%8F%91%E6%A8%A1%E6%9D%BF"><span class="toc-number">2.</span> <span class="toc-text">1. 新建云开发模板</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%BC%80%E9%80%9A%E4%BA%91%E5%BC%80%E5%8F%91%E3%80%81%E5%88%9B%E5%BB%BA%E7%8E%AF%E5%A2%83"><span class="toc-number">3.</span> <span class="toc-text">2. 开通云开发、创建环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E4%BD%93%E9%AA%8C%E4%BA%91%E5%BC%80%E5%8F%91"><span class="toc-number">4.</span> <span class="toc-text">3. 体验云开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%B8%B8%E9%87%8F-DYNAMIC-CURRENT-ENV"><span class="toc-number">4.1.</span> <span class="toc-text">3.1 常量 DYNAMIC_CURRENT_ENV</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E4%BA%91%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">4.2.</span> <span class="toc-text">3.2 云数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E4%BA%91%E5%87%BD%E6%95%B0"><span class="toc-number">4.3.</span> <span class="toc-text">3.2 云函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E4%BA%91%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98-%E6%A8%A1%E7%B3%8A%E5%9B%BE%E5%83%8F%E9%AB%98%E6%B8%85%E5%A4%84%E7%90%86"><span class="toc-number">5.</span> <span class="toc-text">4 云开发实战-模糊图像高清处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E7%9B%AE%E7%9A%84"><span class="toc-number">5.1.</span> <span class="toc-text">4.1 目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="toc-number">5.2.</span> <span class="toc-text">4.2 技术栈</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E5%BC%80%E5%8F%91"><span class="toc-number">5.3.</span> <span class="toc-text">4.3 开发</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://yomxxx.github.io/2020/09/11/20200911-yun/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://yomxxx.github.io/2020/09/11/20200911-yun/&text=小程序云开发基础实战"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://yomxxx.github.io/2020/09/11/20200911-yun/&title=小程序云开发基础实战"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://yomxxx.github.io/2020/09/11/20200911-yun/&is_video=false&description=小程序云开发基础实战"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=小程序云开发基础实战&body=Check out this article: https://yomxxx.github.io/2020/09/11/20200911-yun/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://yomxxx.github.io/2020/09/11/20200911-yun/&title=小程序云开发基础实战"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://yomxxx.github.io/2020/09/11/20200911-yun/&title=小程序云开发基础实战"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://yomxxx.github.io/2020/09/11/20200911-yun/&title=小程序云开发基础实战"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://yomxxx.github.io/2020/09/11/20200911-yun/&title=小程序云开发基础实战"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://yomxxx.github.io/2020/09/11/20200911-yun/&name=小程序云开发基础实战&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://yomxxx.github.io/2020/09/11/20200911-yun/&t=小程序云开发基础实战"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2023
    lgc
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/YOMXXX">Projects</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

        <div class="cat-container">
          <canvas
            id="vuepress-cat"
            width="200"
           height="200"
            class="live2d"
          ></canvas>
    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

    <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?646453bbe5d0ca5216b2efd7d2d5b945";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

<!-- Disqus Comments -->


    </div>
<script>if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js?t=1697375020180')
    .then(function () {console.log('ServiceWorker Register Successfully.')})
    .catch(function (e) {console.error(e)});
}
</script></body>
<script>
WIDGET = {
  CONFIG: {
    "modules": "01234",
    "background": 1,
    "tmpColor": "FFFFFF",
    "tmpSize": 16,
    "cityColor": "FFFFFF",
    "citySize": 16,
    "aqiSize": 16,
    "weatherIconSize": 24,
    "alertIconSize": 18,
    "padding": "10px 10px 10px 10px",
    "shadow": "1",
    "language": "auto",
    "borderRadius": 5,
    "fixed": "false",
    "vertical": "middle",
    "horizontal": "center",
    "key": "a5b33f33732d4326966fec04550c3ead"
  }
}
  </script>
<script src="https://widget.heweather.net/simple/static/js/he-simple-common.js?v=1.1"></script>
<script type="module">
  import live2dJSString from "/assets/2d.js"
  let model = {
    whiteCat: "https://cdn.jsdelivr.net/gh/QiShaoXuan/live2DModel@1.0.0/live2d-widget-model-tororo/assets/tororo.model.json",
  };
  function initCat() {
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ? true : false;
    if (isMobile) {
      isLoaded = false;
      return console.log("mobile do not load model");
    }
    if (!window.loadlive2d) {
        const script = document.createElement("script");
        script.innerHTML = live2dJSString;
        document.body.appendChild(script);
      }
    let style = {
      width: (150 / 1424) * document.body.clientWidth,
      height: ((150 / 1424) * document.body.clientWidth) / 0.8,
    };
    setTimeout(() => {
      window.loadlive2d("vuepress-cat", model.whiteCat);
    },1000);
  }
  initCat();
</script>
</html>
